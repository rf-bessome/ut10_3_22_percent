Функция ЗначенияРеквизитовОбъекта(Объект, Реквизиты) Экспорт
	
	Возврат ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Объект, Реквизиты);
	
КонецФункции

Функция НазваниеИВерсияПрограммы() Экспорт
	
	Возврат ОбменСГИСЭПД.НазваниеИВерсияПрограммы();
	
КонецФункции

Функция ДанныеСертификатаУчетнойЗаписиЭДО(ИдентификаторУчетнойЗаписи, ОтборПодписанта = Неопределено) Экспорт
	
	Возврат ОбменСГИСЭПД.ДанныеСертификатаУчетнойЗаписиЭДО(ИдентификаторУчетнойЗаписи, ОтборПодписанта);
	
КонецФункции

Функция ПолучитьПрокси(Схема) Экспорт
	
	Прокси = Неопределено;
	
	Если ОбщегоНазначенияКлиентСервер.ПодсистемаСуществует("СтандартныеПодсистемы.ПолучениеФайловИзИнтернета") Тогда
		МодульПолучениеФайловИзИнтернета = ОбщегоНазначенияКлиентСервер.ОбщийМодуль("ПолучениеФайловИзИнтернетаПереопределенный");
		Прокси = МодульПолучениеФайловИзИнтернета.ПолучитьПрокси(Схема);
	КонецЕсли;
	
	Возврат Прокси;
	
КонецФункции

Функция ЗаписатьОшибкуВЖурнал(ИмяСобытия, ИнформацияОбОшибке) Экспорт
	
	Возврат ОбменСГИСЭПД.ЗаписатьОшибкуВЖурнал(ИмяСобытия, ИнформацияОбОшибке);
	
КонецФункции

Функция СведенияОбАдресе(РезультатЗначение, ДополнительныеПараметры) Экспорт
	
	Возврат РаботаСАдресами.СведенияОбАдресе(РезультатЗначение, ДополнительныеПараметры, Ложь);
	
КонецФункции

Функция КонтактнаяИнформацияВXML(КонтактнаяИнформацияВладелец, ОжидаемыйВид) Экспорт
	
	Возврат ОбменСГИСЭПД.КонтактнаяИнформацияВXML(КонтактнаяИнформацияВладелец, ОжидаемыйВид);
	
КонецФункции


Функция ПредставлениеКонтактнойИнформации(КонтактнаяИнформация) Экспорт
	
	Возврат ОбменСГИСЭПД.ПредставлениеКонтактнойИнформации(КонтактнаяИнформация);
	
КонецФункции

Функция ПолучитьРеквизитыУчастника(Участник, ДобавитьПлатежныеРеквизиты = Ложь) Экспорт
	
	Возврат ОбменСГИСЭПД.ПолучитьРеквизитыУчастника(Участник, ДобавитьПлатежныеРеквизиты);
	
КонецФункции

Функция ПолучитьРеквизитыФизЛица(ФизЛицо, Организация = Неопределено) Экспорт
	
	Возврат ОбменСГИСЭПД.ПолучитьРеквизитыФизЛица(ФизЛицо, Организация);
	
КонецФункции

Функция НайтиЭлектронныйДокументОбъектаУчета(ОбъектУчета) Экспорт
	
	Возврат ОбменСГИСЭПД.НайтиЭлектронныйДокументОбъектаУчета(ОбъектУчета);
	
КонецФункции

Функция ДвоичныеДанныеДокументаЭПД(Объект, АдресВоВременномХранилище) Экспорт
	
	Возврат ОбменСГИСЭПД.ДвоичныеДанныеДокументаЭПД(Объект,, АдресВоВременномХранилище);
	
КонецФункции


Функция ПолучитьТипОрганизация() Экспорт
	
	Возврат ОбменСГИСЭПДСерверПовтИсп.ПолучитьТипОрганизация();	
	
КонецФункции

Функция ПолучитьТипКонтрагент() Экспорт
	
	Возврат ОбменСГИСЭПДСерверПовтИсп.ПолучитьТипКонтрагент();	
	
КонецФункции

Функция ПолучитьИдентификаторЧерезСервисОператораЭДО(ИдентификаторАбонента, ЭтоВторойТитул = Ложь, ДокументСсылка = Неопределено) Экспорт
	
	Возврат ОбменСГИСЭПД.ПолучитьИдентификаторЧерезСервисОператораЭДО(ИдентификаторАбонента, ЭтоВторойТитул, ДокументСсылка);
	
КонецФункции

Функция ПолучитьОписаниеОшибки(ОбъектСсылка) Экспорт
	
	Возврат ОбменСГИСЭПД.ПолучитьОписаниеОшибки(ОбъектСсылка);
	
КонецФункции

Функция ПолучитьСообщениеТитула(Документ, ТипЭлементаРегламента, ВернутьЭД = Ложь) Экспорт
	
	Возврат ОбменСГИСЭПД.ПолучитьСообщениеТитула(Документ, ТипЭлементаРегламента, ВернутьЭД);
	
КонецФункции

Функция СостояниеДокументаПодробное(ЭлектронныйДокумент) Экспорт
	
	Состояние = Новый Структура;
	Состояние.Вставить("Значение", Перечисления.СостоянияВерсийЭД.ПустаяСсылка());
	Состояние.Вставить("Дополнение", "");
	Состояние.Вставить("ДатаИзменения", '00010101');
	Состояние.Вставить("Комментарий", "");    
	
	СостояниеВерсииЭД = ЭлектронныеДокументыСлужебный.ПолучитьСтруктуруВерсииЭД(ЭлектронныйДокумент);
	
	СостояниеВерсииЭД.Свойство("СостояниеВерсииЭД", Состояние.Значение);
	СостояниеВерсииЭД.Свойство("КомментарийРС", Состояние.Комментарий);;
	
	Возврат Состояние;
	
КонецФункции

Функция ПолучитьТитулыПоДокументу(Документ, ТолькоЗавершенныеОтправки = Ложь) Экспорт

	Возврат ОбменСГИСЭПД.ПолучитьТитулыПоДокументу(Документ, ТолькоЗавершенныеОтправки);

КонецФункции

Функция ПолучитьВерсииТитуловДокумента(Знач Документ, Знач Организация) Экспорт

	Возврат ОбменСГИСЭПД.ПолучитьВерсииТитуловДокумента(Документ, Организация);

КонецФункции

Функция ПолучитьАдресаДоставки(ЗначениеОтбора) Экспорт
	
	Возврат ОбменСГИСЭПД.ПолучитьАдресаДоставки(ЗначениеОтбора);
	
КонецФункции

Процедура ОтметитьИсправлениеДокумента(ОбъектУчета) Экспорт
	
	ОбменСГИСЭПД.ОтметитьИсправлениеДокумента(ОбъектУчета);
	
КонецПроцедуры

Функция ВидФактическийАдресКонтрагента() Экспорт

	Возврат ОбменСГИСЭПДПереопределяемый.ВидФактическийАдресКонтрагента();
	
КонецФункции

Функция ИмяТипаБанковскиеСчетаОрганизации() Экспорт
	
	Возврат ОбменСГИСЭПДПереопределяемый.ИмяТипаБанковскиеСчетаОрганизации();
	
КонецФункции

Функция ЭтоУОУ(ТипЭлементаРегламента) Экспорт
	
	Возврат ОбменСГИСЭПД.ЭтоУОУ(ТипЭлементаРегламента);
	
КонецФункции

// Возвращает полное имя основной формы объекта.
//
// Параметры:
//  Ссылка	 - 	ЛюбаяСсылка - ссылка на объект. Например, ДокументСсылка или СправочникСсылка.
// 
// Возвращаемое значение:
//  Строка - полное имя основной формы объекта.
//
Функция ПолноеИмяФормыОбъекта(Ссылка) Экспорт
	
	ИмяФормы = "";
	ОбъектМетаданных = Ссылка.Метаданные();
	
	Если ОбщегоНазначения.ЭтоДокумент(ОбъектМетаданных) Тогда
		ИмяФормы = ОбъектМетаданных.ПолноеИмя() + ".ФормаОбъекта";
	ИначеЕсли ОбщегоНазначения.ЭтоСправочник(ОбъектМетаданных) Тогда
		ИмяФормы = ОбъектМетаданных.Формы.ФормаЭлемента.ПолноеИмя();
	КонецЕсли;
		
	Возврат ИмяФормы;
	
КонецФункции

Процедура УстановитьПометкуУдаления(Ссылка) Экспорт
	
	Объект = Ссылка.ПолучитьОбъект();
	Объект.УстановитьПометкуУдаления(НЕ Объект.ПометкаУдаления);
	
КонецПроцедуры

Функция ПолучитьУИДМинтранса(КлючСинхронизации, ЭтоВторойТитул = Ложь, ДокументСсылка = Неопределено) Экспорт
	
	РезультатПоУмолчанию = "";
	
	Если КлючСинхронизации = Неопределено Тогда
		Возврат РезультатПоУмолчанию;	
	КонецЕсли;           
	
	Если Лев(КлючСинхронизации.ИдентификаторОрганизации, 3) = "2AE" Тогда
		СпособОбмена = Перечисления.СпособыОбменаЭД.ЧерезСервис1СЭДО;
	ИначеЕсли Лев(КлючСинхронизации.ИдентификаторОрганизации, 3) = "2AL" Тогда
		СпособОбмена = Перечисления.СпособыОбменаЭД.ЧерезОператораЭДОТакском;
	Иначе
		Шаблон = НСтр("ru='Оператор для абонента %1 не поддерживается.'");
		ТекстОшибки = СтрШаблон(Шаблон, КлючСинхронизации.ИдентификаторОрганизации);
		ВызватьИсключение(ТекстОшибки);
	КонецЕсли;
	
	HTTPСоединение = ЭлектронныеДокументыВнутренний.ПолучитьСоединение(СпособОбмена); 
	
	Если HTTPСоединение = Неопределено Тогда
		Возврат РезультатПоУмолчанию;
	КонецЕсли;
	
	АдресРесурса = "epd/v1/GetUID/" + КлючСинхронизации.ИдентификаторОрганизации;
	Если ЭтоВторойТитул = Истина И ДокументСсылка <> Неопределено Тогда
		ЭД = ОбменСГИСЭПД.ОсновнойЭлектронныйДокументОбъектаУчета(ДокументСсылка);
		Если ЗначениеЗаполнено(ЭД) Тогда
			ПерваяТранзакция = Неопределено;
			Если ТипЗнч(ДокументСсылка) = Тип("ДокументСсылка.ЭлектроннаяТранспортнаяНакладная") Тогда
				ПерваяТранзакция = "ShipperInformation";		
			ИначеЕсли ТипЗнч(ДокументСсылка) = Тип("ДокументСсылка.ЭлектронныйПутевойЛист") Тогда
				ПерваяТранзакция = "OwnerVehicleInfo";	
			КонецЕсли;
			АдресРесурса = АдресРесурса + "?docflow_id=" + ЭД.ИдентификаторДокументооборота;
			Если ПерваяТранзакция <> Неопределено Тогда	
				АдресРесурса = АдресРесурса + "&transaction=" + ПерваяТранзакция;
			КонецЕсли;
		КонецЕсли;	
	КонецЕсли;
	
	ЗапросHTTP = Новый HTTPЗапрос(АдресРесурса);
	
	ОтветHTTP = HTTPСоединение.Получить(ЗапросHTTP);
	Если ОтветHTTP.КодСостояния = 200 Тогда
		Возврат ОтветHTTP.ПолучитьТелоКакСтроку();
	Иначе
		Возврат РезультатПоУмолчанию;
	КонецЕсли;
					
КонецФункции

Функция ПолучитьПочтуВодителей(МассивВодители, ИмяРеквизита = "Почта") Экспорт
	
	Возврат ОбменСГИСЭПД.ПолучитьПочтуВодителей(МассивВодители, ИмяРеквизита);
	
КонецФункции

Функция ДанныеРеквизитовЭПД(Документ, Титул = Неопределено, ВсеВерсии = Ложь) Экспорт
	
	Возврат ОбменСГИСЭПД.ДанныеРеквизитовЭПД(Документ, Титул, ВсеВерсии);
		
КонецФункции

Функция ПолучитьОписаниеХранимыхДанныхЭПДПоСсылке(ХранимыеДанныеЭПДСсылка, ГруппаДанных, ИдентификаторСтроки = Неопределено) Экспорт
	
	Возврат ОбменСГИСЭПД.ПолучитьОписаниеХранимыхДанныхЭПДПоСсылке(ХранимыеДанныеЭПДСсылка, ГруппаДанных, ИдентификаторСтроки);
	
КонецФункции

Процедура АвтоПодборХранимыхДанныхЭПД(СтрокаПоиска, ДанныеВыбора, Отбор) Экспорт
	
	ОбменСГИСЭПД.АвтоПодборХранимыхДанныхЭПД(СтрокаПоиска, ДанныеВыбора, Отбор);
	
КонецПроцедуры

Функция ПроверитьЗаполнениеДокументаЭПД(ДанныеДляПроверки, ТекущийТитул, ВидДокумента) Экспорт
	
	Возврат ОбменСГИСЭПД.ПроверитьЗаполнениеДокументаЭПД(ДанныеДляПроверки, ТекущийТитул, ВидДокумента)
	
КонецФункции

Функция ВидФактическийАдресОрганизации() Экспорт

	Возврат ОбменСГИСЭПДПереопределяемый.ВидФактическийАдресОрганизации();
	
КонецФункции


// Область ХранимыеДанные

Функция ЗаписатьХранимыеДанныеЭПД(ГруппаДанных, Организация, Контрагент, ДополнительныйОтбор, ОписаниеДанных) Экспорт
										
	Возврат ОбменСГИСЭПД.ЗаписатьХранимыеДанныеЭПД(ГруппаДанных, Организация, Контрагент, ДополнительныйОтбор, ОписаниеДанных);
										
КонецФункции

Функция НастройкиОтправки(КлючНастроекОтправки, Направление = Неопределено) Экспорт
	
	Результат = ОбменСГИСЭПД.НастройкиОтправки(КлючНастроекОтправки, Направление);
	Если Результат = "" Тогда
		Результат = Неопределено;
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

// КонецОбласти

// Область СовместимостьСБЭД19

Функция ПодсистемаСуществует(ПолноеИмяПодсистемы) Экспорт
	
	Возврат ОбменСГИСЭПД.ПодсистемаСуществует(ПолноеИмяПодсистемы);
	
КонецФункции

Функция НовыеПараметрыПолученияСостоянияНеНачатогоЭДООбъектаУчета() Экспорт
	
	ДанныеСостояния = Новый ТаблицаЗначений;
	ДанныеСостояния.Колонки.Добавить("ОбъектУчета");
	ДанныеСостояния.Колонки.Добавить("Контрагент");
	ДанныеСостояния.Колонки.Добавить("ТипДокумента");
	ДанныеСостояния.Колонки.Добавить("ПрикладнойТипДокумента");
	ДанныеСостояния.Колонки.Добавить("Направление");
	ДанныеСостояния.Колонки.Добавить("Организация");
	ДанныеСостояния.Колонки.Добавить("Договор");
	
	Возврат ДанныеСостояния;
	
КонецФункции

// Возвращает наличие у пользователя прав на настройку ЭДО.
//
// Параметры:
//  ВыводитьСообщение - Булево - признак необходимости выводить сообщение о нарушении прав доступа.
//
// Возвращаемое значение:
//  Булево - Истина, если у пользователя есть необходимые права, иначе Ложь.
//
Функция ЕстьПравоНастройкиОбмена(ВыводитьСообщение = Ложь) Экспорт
	
	Если Пользователи.ЭтоПолноправныйПользователь() Тогда
		Возврат Истина;
	КонецЕсли;
	
	ЕстьПраво = Истина;
	
	// Основные объекты метаданных, доступ к которым определяет доступ к элементарной функции.
	ОбъектыЭлементарнойФункции = Новый Массив;
	ОбъектыЭлементарнойФункции.Добавить(Метаданные.Справочники.СоглашенияОбИспользованииЭД);
	
	Для каждого Объект Из ОбъектыЭлементарнойФункции Цикл
		
		Если Не ПравоДоступа("Изменение", Объект) Тогда
			ЕстьПраво = Ложь;
			Прервать;
		КонецЕсли;
		
	КонецЦикла;
	
	Возврат ЕстьПраво;
	
КонецФункции

// Возвращает имена подсистем для использования в см. ЗаписатьВЖурналРегистрации.
// 
// Возвращаемое значение:
// 	Структура:
// * ЭлектронноеВзаимодействие - Строка
// * ОбменСБанками - Строка
// * ОбменСКонтрагентами - Строка
// * ОбменССайтами - Строка
// * РегламентныеЗадания - Строка
// * БизнесСеть - Строка
// * ТорговыеПредложения - Строка
// * ИнтеграцияСЯндексКассой - Строка
// * СопоставлениеНоменклатурыКонтрагентов - Строка
// * Криптография - Строка
// * СервисДоставки - Строка
// * ЭлектронноеАктированиеЕИС - Строка
// * КоммерческиеПредложения - Строка
Функция ПодсистемыБЭД() Экспорт
	
	Подсистемы = Новый Структура;
	Подсистемы.Вставить("ЭлектронноеВзаимодействие", "ЭлектронноеВзаимодействие");
	Подсистемы.Вставить("ОбменСБанками", "ЭлектронноеВзаимодействие.ОбменСБанками");
	Подсистемы.Вставить("ОбменСКонтрагентами", "ЭлектронноеВзаимодействие.ОбменСКонтрагентами");
	Подсистемы.Вставить("ОбменССайтами", "ЭлектронноеВзаимодействие.ОбменССайтами");
	Подсистемы.Вставить("РегламентныеЗадания", "РегламентныеЗадания");
	Подсистемы.Вставить("БизнесСеть", "ЭлектронноеВзаимодействие.БизнесСеть");
	Подсистемы.Вставить("ТорговыеПредложения", "ЭлектронноеВзаимодействие.ТорговыеПредложения");
	Подсистемы.Вставить("ИнтеграцияСЯндексКассой", "ЭлектронноеВзаимодействие.ИнтеграцияСЯндексКассой");
	Подсистемы.Вставить("СопоставлениеНоменклатурыКонтрагентов",
		"ЭлектронноеВзаимодействие.СопоставлениеНоменклатурыКонтрагентов");
	Подсистемы.Вставить("Криптография", "ЭлектронноеВзаимодействие.БазоваяФункциональность.Криптография");
	Подсистемы.Вставить("ИнтернетСоединение", "ЭлектронноеВзаимодействие.БазоваяФункциональность.ИнтернетСоединение");
	Подсистемы.Вставить("РаботаСФайлами", "ЭлектронноеВзаимодействие.БазоваяФункциональность.РаботаСФайлами");
	Подсистемы.Вставить("СервисДоставки", "ЭлектронноеВзаимодействие.СервисДоставки");
	Подсистемы.Вставить("ЭлектронноеАктированиеЕИС", "ЭлектронноеАктированиеЕИС");	
	Подсистемы.Вставить("КоммерческиеПредложения", "ЭлектронноеВзаимодействие.КоммерческиеПредложения");
	
	Возврат Подсистемы;
	
КонецФункции

// Возвращает пустое описание объекта учета.
// 
// Возвращаемое значение:
//  ТаблицаЗначений:
// * ОбъектУчета - ОпределяемыйТип.ОснованияЭлектронныхДокументовЭДО
// * Направление - ПеречислениеСсылка.НаправленияЭД
// * ТипДокумента - ПеречислениеСсылка.ТипыЭД
// * ПрикладнойТипДокумента - ОпределяемыйТип.ПрикладныеТипыЭлектронныхДокументовЭДО
// * Организация - ОпределяемыйТип.Организация
// * Контрагент - ОпределяемыйТип.УчастникЭДО
// * Договор - ОпределяемыйТип.ДоговорСКонтрагентомЭДО
Функция НовоеОписаниеОбъектаУчета() Экспорт
	
	ОписаниеОбъектаУчета = Новый ТаблицаЗначений;
	
	ТипыОбъектУчета = Новый Массив;
	ТипыОбъектУчета.Добавить(Тип("ДокументСсылка.ЭлектроннаяТранспортнаяНакладная"));
	ТипыОбъектУчета.Добавить(Тип("ДокументСсылка.ЭлектронныйПутевойЛист"));
	ТипыОбъектУчета.Добавить(Тип("ДокументСсылка.ЭлектронныйДокументВходящий"));
	ТипыОбъектУчета.Добавить(Тип("ДокументСсылка.ЭлектронныйДокументИсходящий"));
	ТипыОбъектУчета_Организация = Новый Массив;
	ТипыОбъектУчета_Организация.Добавить(Тип("СправочникСсылка." + ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("Организации")));
	ОбщегоНазначенияКлиентСервер.ДополнитьМассив(ТипыОбъектУчета, ТипыОбъектУчета_Организация);
	
	ОписаниеОбъектаУчета.Колонки.Добавить("ОбъектУчета", Новый ОписаниеТипов(ТипыОбъектУчета));
	ОписаниеОбъектаУчета.Колонки.Добавить("Направление", Новый ОписаниеТипов("ПеречислениеСсылка.НаправленияЭД"));
	ОписаниеОбъектаУчета.Колонки.Добавить("ТипДокумента", Новый ОписаниеТипов("ПеречислениеСсылка.ВидыЭД"));
	ОписаниеОбъектаУчета.Колонки.Добавить("Организация", Новый ОписаниеТипов("СправочникСсылка." + ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("Организации")));
	ОписаниеОбъектаУчета.Колонки.Добавить("Контрагент", Новый ОписаниеТипов("СправочникСсылка." + ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("Контрагенты")));
	ОписаниеОбъектаУчета.Колонки.Добавить("Договор", Новый ОписаниеТипов("СправочникСсылка." + ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("ДоговорыКонтрагентов")));
	
	Возврат ОписаниеОбъектаУчета;
	
КонецФункции

// Возвращает описание полей ключа настроек отправки, см. ТекстЗапросаДополнениеНастройкамиВнутреннегоЭДО.
// 
// Возвращаемое значение:
// 	Структура:
// * Организация - Строка
// * ВидДокумента - Строка
Функция НовоеОписаниеПолейКлючаНастройкиВнутреннегоЭДО() Экспорт
	
	ПоляКлючаНастройки = Новый Структура;
	ПоляКлючаНастройки.Вставить("Организация", "");
	ПоляКлючаНастройки.Вставить("ВидВнутреннегоДокумента", "");
	
	Возврат ПоляКлючаНастройки;
	
КонецФункции

// Возвращает ссылку на основной электронный документ объекта учета.
// 
// Параметры:
//  ОбъектУчета - ОпределяемыеТипы.ОснованияЭлектронныхДокументовЭДО
//
// Возвращаемое значение:
//  ДокументСсылка.ЭлектронныйДокументВходящийЭДО, ДокументСсылка.ЭлектронныйДокументИсходящийЭДО, Неопределено - ссылка на электронный документ.
//  Неопределено - электронный документ не найден.
//
Функция ОсновнойЭлектронныйДокументОбъектаУчета(Знач ОбъектУчета) Экспорт
	
	Возврат ОбменСГИСЭПД.ОсновнойЭлектронныйДокументОбъектаУчета(ОбъектУчета);
	
КонецФункции

// Заполняет данные состояния не начатого ЭДО объекта учета.
// 
// Параметры:
//  Параметры - См. НовоеОписаниеОбъектаУчета
//  ДанныеСостояния - См. НовыеДанныеСостоянияЭДООбъектаУчета
Процедура ЗаполнитьСостояниеНеНачатогоЭДООбъектаУчета(Параметры, ДанныеСостояния) Экспорт
	
	Если ДанныеСостояния = Неопределено Тогда
		ДанныеСостояния = НовыеДанныеСостоянияЭДООбъектаУчета();
	КонецЕсли;
	
	ДанныеСостояния.ЭтоСостояниеНеНачатогоЭДО = Истина;
	КоличествоПараметров = Параметры.Количество();
	КоличествоНетНастройки = 0;
	КоличествоФормированиеЗапрещено = 0;
	
	Для каждого СтрокаПараметров Из Параметры Цикл
		
		КлючНастроек = ОбменСГИСЭПДКлиентСервер.НовыйКлючНастроекОтправки();
		ТипДокументаДляВида = ?(СтрокаПараметров.ТипДокумента = Перечисления.ВидыЭД.Прикладной,
			СтрокаПараметров.ПрикладнойТипДокумента, СтрокаПараметров.ТипДокумента);
		КлючНастроек.ВидДокумента = ОбменСГИСЭПД.ВидДокументаПоТипу(ТипДокументаДляВида);
		КлючНастроек.Отправитель = СтрокаПараметров.Организация;
		КлючНастроек.Получатель = СтрокаПараметров.Контрагент;
		КлючНастроек.Договор = СтрокаПараметров.Договор;
		
		НастройкиОтправки = ОбменСГИСЭПД.НастройкиОтправки(КлючНастроек);
		
		Если Не ЗначениеЗаполнено(НастройкиОтправки) Тогда
			КоличествоНетНастройки = КоличествоНетНастройки + 1;
		ИначеЕсли Не НастройкиОтправки.Формировать Тогда
			КоличествоФормированиеЗапрещено = КоличествоФормированиеЗапрещено + 1;
		КонецЕсли;
		
	КонецЦикла;
	
	Если КоличествоНетНастройки = КоличествоПараметров Тогда
		
		ДанныеСостояния.ПредставлениеСостояния = НСтр("ru = 'Требуется настройка'");
		ДанныеСостояния.НеобходимаНастройка = Истина;
		
		Если КоличествоПараметров = 1 Тогда
			Если Параметры[0].Направление = Перечисления.НаправленияЭД.Исходящий
				Или Параметры[0].Направление = Перечисления.НаправленияЭД.Интеркампани Тогда
				ДанныеСостояния.ПредставлениеСостояния = НСтр("ru = 'Не начат'");
			ИначеЕсли Параметры[0].Направление = Перечисления.НаправленияЭД.Входящий Тогда
				ШаблонТекстаНавигационнойСсылки = НСтр("ru = 'Пригласить %1 к обмену электронными документами в 1С-ЭДО'");
				ДанныеСостояния.ПредставлениеСостояния = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
					ШаблонТекстаНавигационнойСсылки, Параметры[0].Контрагент);
			КонецЕсли;
		КонецЕсли;
		
	ИначеЕсли КоличествоФормированиеЗапрещено = КоличествоПараметров Тогда
		
		ДанныеСостояния.ПредставлениеСостояния = НСтр("ru = 'Формирование документов запрещено'");
		ДанныеСостояния.НеобходимаНастройка = Истина;
		
	Иначе
		
		ДанныеСостояния.СуществуетАктуальныйДокумент =
			ЗначениеЗаполнено(ОсновнойЭлектронныйДокументОбъектаУчета(Параметры[0].ОбъектУчета));
		ДанныеСостояния.ПредставлениеСостояния = НСтр("ru = 'Не начат'");
		
	КонецЕсли;
	
КонецПроцедуры

// Возвращает описание набора электронных документов по основанию.
// 
// Параметры:
//  ИсточникДанных - ОпределяемыйТип.ОснованияЭлектронныхДокументовЭДО
// 
// Возвращаемое значение:
//  См. НовоеОписаниеОбъектаУчета
//
Функция ОписаниеОбъектаУчета(ИсточникДанных) Экспорт
	
	Описание = НовоеОписаниеОбъектаУчета();
	Если ОбщегоНазначения.ЗначениеСсылочногоТипа(ИсточникДанных) Тогда
		ИсточникДанныхСсылка = ИсточникДанных;
	Иначе // передан объект.
		ИсточникДанныхСсылка = ИсточникДанных.Ссылка;
	КонецЕсли;
	
	Если ОбщегоНазначенияКлиентСервер.ПодсистемаСуществует("ЭлектронноеВзаимодействие.ОбменСГИСЭПД") Тогда
		МодульПодсистемы = ОбщегоНазначенияКлиентСервер.ОбщийМодуль("ОбменСГИСЭПДСлужебный");
		ЭтоЭПД = МодульПодсистемы.ЭтоЭПД(ИсточникДанныхСсылка);
	Иначе
		ЭтоЭПД = Ложь;
	КонецЕсли;
	
	СправочникОрганизации = ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("Организации");
	ДоговорыКонтрагентов = ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("ДоговорыКонтрагентов");
	
	ОграничениеТипаДоговорКонтрагента = Новый ОписаниеТипов("СправочникСсылка." 
		+ ДоговорыКонтрагентов);
	ПараметрыИсточника = Новый Структура;
	ПараметрыИсточника.Вставить("Тип");
	ПараметрыИсточника.Вставить("ФормированиеУниверсальногоДокумента");
	ПараметрыИсточника.Вставить("Направление");
	ПараметрыИсточника.Вставить("Организация");
	ПараметрыИсточника.Вставить("Контрагент");
	ПараметрыИсточника.Вставить("ДоговорКонтрагента", ОграничениеТипаДоговорКонтрагента.ПривестиЗначение());
	ПараметрыИсточника.Вставить("СоглашениеЭД");
	ПараметрыИсточника.Вставить("Партнер");
	
	ТипИсточникаДанных = ТипЗнч(ИсточникДанныхСсылка);
	
	Если ЭтоЭПД = Истина Тогда
		
		МодульДокумента = ОбщегоНазначенияКлиентСервер.ОбщийМодуль("ОбменСГИСЭПД");
		МодульДокумента.ЗаполнитьПараметрыЭлектронногоДокумента(ИсточникДанных, ПараметрыИсточника);

		СтрокаОписания = Описание.Добавить();

		СтрокаОписания.ОбъектУчета = ИсточникДанныхСсылка;
		СтрокаОписания.ТипДокумента = ПараметрыИсточника.Тип;
		СтрокаОписания.Направление  = ПараметрыИсточника.Направление;
		СтрокаОписания.Организация  = ПараметрыИсточника.Организация;
		СтрокаОписания.Контрагент   = ПараметрыИсточника.Контрагент;
		СтрокаОписания.Договор      = ПараметрыИсточника.ДоговорКонтрагента;
		
	КонецЕсли;
	
	Возврат Описание;
	
КонецФункции

Функция СохраненноеПредставлениеСостоянияЭДООбъектаУчета(ОбъектУчета)
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	СостоянияЭД.ПредставлениеСостояния КАК ПредставлениеСостояния
	|ИЗ
	|	РегистрСведений.СостоянияЭД КАК СостоянияЭД
	|ГДЕ
	|	СостоянияЭД.СсылкаНаОбъект = &СсылкаНаОбъект";
	
	Запрос.УстановитьПараметр("СсылкаНаОбъект", ОбъектУчета);
	
	УстановитьПривилегированныйРежим(Истина);
	РезультатЗапроса = Запрос.Выполнить();
	УстановитьПривилегированныйРежим(Ложь);

	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Если ВыборкаДетальныеЗаписи.Следующий() Тогда
		
		Возврат ВыборкаДетальныеЗаписи.ПредставлениеСостояния;
		
	КонецЕсли;

	Возврат "";

КонецФункции

// Определяет, используется ли обмен электронными документами с контрагентами.
// 
// Параметры:
// 	КонтекстДиагностики - см. ОбработкаНеисправностейБЭД.НовыйКонтекстДиагностики
// Возвращаемое значение:
// 	Булево
Функция ИспользуетсяОбменЭлектроннымиДокументами(КонтекстДиагностики = Неопределено) Экспорт
	
	Если ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьЗначениеФункциональнойОпции("ИспользоватьОбменЭД") Тогда
		Возврат Истина;
	КонецЕсли;
	
	Возврат Ложь;
	
КонецФункции

// Возвращает новые данные состояния ЭДО объекта учета.
// 
// Параметры:
//  ВыполнитьНачальноеЗаполнение - Булево
// 
// Возвращаемое значение:
//  Структура:
// * ИспользуетсяОбменЭлектроннымиДокументами - Булево
// * ЕстьПравоНастройки - Булево
// * ПредставлениеСостояния - Строка
// * СуществуетАктуальныйДокумент - Булево
// * НеобходимаНастройка - Булево
// * ЭтоСостояниеНеНачатогоЭДО - Булево
Функция НовыеДанныеСостоянияЭДООбъектаУчета(ВыполнитьНачальноеЗаполнение = Истина)
	
	ДанныеСостояния = Новый Структура;
	ДанныеСостояния.Вставить("ИспользуетсяОбменЭлектроннымиДокументами", Ложь);
	ДанныеСостояния.Вставить("ЕстьПравоНастройки", Ложь);
	ДанныеСостояния.Вставить("ПредставлениеСостояния", "");
	ДанныеСостояния.Вставить("СуществуетАктуальныйДокумент", Ложь);
	ДанныеСостояния.Вставить("НеобходимаНастройка", Ложь);
	ДанныеСостояния.Вставить("ЭтоСостояниеНеНачатогоЭДО", Ложь);
	
	Если ВыполнитьНачальноеЗаполнение Тогда
		ДанныеСостояния.ИспользуетсяОбменЭлектроннымиДокументами = ИспользуетсяОбменЭлектроннымиДокументами();
		ДанныеСостояния.ЕстьПравоНастройки = ЕстьПравоНастройкиОбмена()
	КонецЕсли;

	Возврат ДанныеСостояния;

КонецФункции

// ИнтеграцияЭДОВызовСервера.ДанныеСостоянияЭДОДляФормыОбъектаУчета(Объект.Ссылка)
Функция ДанныеСостоянияЭДОДляФормыОбъектаУчета(ОбъектУчета) Экспорт
	
	Результат = НовыеДанныеСостоянияЭДООбъектаУчета();
	
	Если Результат.ИспользуетсяОбменЭлектроннымиДокументами Тогда
		Если ЗначениеЗаполнено(ОбъектУчета) Тогда	
			ПредставлениеСостояния = СохраненноеПредставлениеСостоянияЭДООбъектаУчета(ОбъектУчета);
			
			Если ПустаяСтрока(ПредставлениеСостояния) Тогда
				ОписаниеОбъектаУчета = ОписаниеОбъектаУчета(ОбъектУчета);
				
				ПараметрыПолученияСостояния = НовыеПараметрыПолученияСостоянияНеНачатогоЭДООбъектаУчета();
				Для каждого СтрокаОписания Из ОписаниеОбъектаУчета Цикл
					ЗаполнитьЗначенияСвойств(ПараметрыПолученияСостояния.Добавить(), СтрокаОписания);
				КонецЦикла;
				
				ЗаполнитьСостояниеНеНачатогоЭДООбъектаУчета(ПараметрыПолученияСостояния, Результат);
			Иначе
				Результат.ПредставлениеСостояния = ПредставлениеСостояния;
				Результат.СуществуетАктуальныйДокумент = ЗначениеЗаполнено(
					ОсновнойЭлектронныйДокументОбъектаУчета(ОбъектУчета));
				Результат.НеобходимаНастройка = Ложь;
			КонецЕсли;
		КонецЕсли;	
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции // ДанныеСостоянияЭДОДляФормыОбъектаУчета()

Функция СоответствиеПрофилейИД(МассивИдентификаторов) Экспорт
	
	ЗапросПрофиля = Новый Запрос;     
	ЗапросПрофиля.УстановитьПараметр("МассивИдентификаторов", МассивИдентификаторов);
	ЗапросПрофиля.Текст = "ВЫБРАТЬ
	                      |	ПрофилиНастроекЭДО.Ссылка,
	                      |	ПрофилиНастроекЭДО.ИдентификаторОрганизации
	                      |ИЗ
	                      |	Справочник.ПрофилиНастроекЭДО КАК ПрофилиНастроекЭДО
	                      |ГДЕ
	                      |	ПрофилиНастроекЭДО.ИдентификаторОрганизации В(&МассивИдентификаторов)"; 
	
	ВыборкаПрофиль = ЗапросПрофиля.Выполнить().Выбрать();            
	
	СоответствиеПрофилейИД = Новый Соответствие;
	Пока ВыборкаПрофиль.Следующий() Цикл
		СоответствиеПрофилейИД.Вставить(ВыборкаПрофиль.ИдентификаторОрганизации, ВыборкаПрофиль.Ссылка);
	КонецЦикла;     
	
	Возврат СоответствиеПрофилейИД;
	
КонецФункции

Функция ВариантыАвтоподбораАдреса(Текст) Экспорт
	
	Если ОбщегоНазначенияКлиентСервер.ПодсистемаСуществует("СтандартныеПодсистемы.АдресныйКлассификатор") Тогда
		МодульАдресныйКлассификаторСлужебный = ОбщегоНазначенияКлиентСервер.ОбщийМодуль("АдресныйКлассификаторСлужебный");
		ДополнительныеПараметры = Новый Структура;
		ДополнительныеПараметры.Вставить("ТолькоВебСервис", Истина);
		Возврат МодульАдресныйКлассификаторСлужебный.ВариантыАвтоподбора(Текст, ДополнительныеПараметры);
	КонецЕсли;
	
	Возврат Неопределено;
	
КонецФункции
