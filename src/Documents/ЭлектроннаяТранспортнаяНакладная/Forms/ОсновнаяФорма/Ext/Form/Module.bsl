&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.ЗначениеКопирования.Пустая() = Ложь 
		И Параметры.ЗначениеКопирования.ЭтоВходящий = Истина Тогда
        Отказ = Истина; 
        СтандартнаяОбработка = Ложь;
	КонецЕсли;
	
	Если НЕ Параметры.Свойство("ФормаБезОбработки") Тогда
		
		ОбменСГИСЭПД.ПриСозданииНаСервереПодчиненнойФормы(ЭтаФорма, Отказ, СтандартнаяОбработка);
		
		Если ЗначениеЗаполнено(Объект.Ссылка) Тогда
			ОбменСГИСЭПД.ЗаполнитьТаблицуВерсийТитулов(Объект.Ссылка, Объект.Организация, ВерсииТитулов);
			ОбменСГИСЭПД.ЗаполнитьТаблицуЗначенийРеквизитов(Объект.Ссылка, Объект.Организация, СтруктураРеквизитов);
		Иначе
			ОбменСГИСЭПД.ЗаполнитьТаблицуЗначенийРеквизитовПоПараметрамФормы(Параметры, СтруктураРеквизитов);	
		КонецЕсли;
		
		ОбменСГИСЭПДКлиентСервер.УстановитьДоступностьЭлементовЭТрН(ЭтаФорма);
				
		ОрганизацияОписаниеТипов = Новый ОписаниеТипов("СправочникСсылка." + ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("Организации"));
		КонтрагентОписаниеТипов = Новый ОписаниеТипов("СправочникСсылка." + ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("Контрагенты"));
		Если Объект.ЭтоВходящий = Ложь Тогда	
			Если ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяСоставитель) Тогда
				ВариантПоДоверенности = 1;
				Элементы.СсылкаТитулГрузоотправителяГрузоотправитель.ОграничениеТипа = КонтрагентОписаниеТипов;
				Элементы.СсылкаТитулГрузоотправителяСоставитель.ОграничениеТипа = ОрганизацияОписаниеТипов;
				Если ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяСоставитель) = Ложь Тогда
					Объект.СсылкаТитулГрузоотправителяСоставитель = ОбменСГИСЭПД.ОрганизацияПоУмолчанию();
				КонецЕсли;
			Иначе
				Элементы.СсылкаТитулГрузоотправителяГрузоотправитель.ОграничениеТипа = ОрганизацияОписаниеТипов;	
				Если ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяГрузоотправитель) = Ложь Тогда
					Объект.СсылкаТитулГрузоотправителяГрузоотправитель = ОбменСГИСЭПД.ОрганизацияПоУмолчанию();
					ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыПоСсылке(Элементы.СсылкаТитулГрузоотправителяГрузоотправитель, ЭтаФорма);
					ЗаполнитьСведенияОПереадресовке();
				КонецЕсли;
			КонецЕсли;		
			Элементы.СсылкаТитулГрузоотправителяЗаказчик.ОграничениеТипа = КонтрагентОписаниеТипов;
			Элементы.СсылкаТитулГрузоотправителяГрузополучатель.ОграничениеТипа = КонтрагентОписаниеТипов;
			Элементы.СсылкаТитулГрузоотправителяПеревозчик.ОграничениеТипа = КонтрагентОписаниеТипов;			
			
			Если Объект.ТекущийТитул = Перечисления.ТипыЭлементовВерсииЭД.ЭТрН_Титул1 Тогда
				ХранимыеДанныеТитулГрузоотправителяТранспортноеСредство = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма,
				"ХранимыеДанныеТитулГрузоотправителяТранспортноеСредство");
				Если ЗначениеЗаполнено(ХранимыеДанныеТитулГрузоотправителяТранспортноеСредство) = Ложь Тогда
					Элементы.ХранимыеДанныеТитулГрузоотправителяТранспортноеСредство.ОграничениеТипа = Новый ОписаниеТипов("СправочникСсылка.ХранимыеДанныеЭПД");
				КонецЕсли;
			КонецЕсли;
			
			МассивЭлементов = Новый Массив;
			МассивЭлементов.Добавить(Элементы.СсылкаТитулГрузоотправителяЗаказчик);
			МассивЭлементов.Добавить(Элементы.СсылкаТитулГрузоотправителяГрузоотправитель);
			Если ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяСоставитель) Тогда
				МассивЭлементов.Добавить(Элементы.СсылкаТитулГрузоотправителяСоставитель);
			КонецЕсли;
			МассивЭлементов.Добавить(Элементы.СсылкаТитулГрузоотправителяГрузополучатель);
			МассивЭлементов.Добавить(Элементы.СсылкаТитулГрузоотправителяПеревозчик);
			МассивЭлементов.Добавить(Элементы.СсылкаТитулПереадресовкаНовыйГрузополучатель);
			МассивЭлементов.Добавить(Элементы.СсылкаДопТитулПереадресовкаНовыйГрузополучатель);
			ОбменСГИСЭПДКлиентСервер.ПоказатьОшибкиПоКонтрагентам(ЭтаФорма, МассивЭлементов);
			
			Элементы.ГруппаРеквизитаТитулГрузоотправителяТранспортнаяНакладнаяНомер.Видимость = Ложь;
			Элементы.ЗаголовокНомер.Заголовок = "Номер";
		Иначе
			Элементы.ГруппаРеквизитаНомер.Видимость = Ложь;
		КонецЕсли;
		
		ЦветВыделенияУчастника = ЦветаСтиля.ЦветВыделенияУчастникаЭПД;
		Если Объект.РольУчастника = 1 Тогда
			Элементы.СсылкаТитулПереадресовкаНовыйГрузополучатель.ОграничениеТипа = КонтрагентОписаниеТипов;
			Элементы.СсылкаДопТитулПереадресовкаНовыйГрузополучатель.ОграничениеТипа = КонтрагентОписаниеТипов;
			Элементы.ГруппаРеквизитаСсылкаТитулГрузоотправителяПеревозчик.ЦветФона = ЦветВыделенияУчастника;
			Элементы.СсылкаТитулПеревозчикаФХЖВалютаСтоимости.ОграничениеТипа = Новый ОписаниеТипов("СправочникСсылка.Валюты");
		ИначеЕсли Объект.РольУчастника = 2
			И Объект.Организация = Объект.СсылкаТитулГрузоотправителяГрузополучатель Тогда
				Элементы.ГруппаРеквизитаСсылкаТитулГрузоотправителяГрузополучатель.ЦветФона = ЦветВыделенияУчастника;
		ИначеЕсли Объект.РольУчастника = 3 Тогда
			Элементы.ГруппаРеквизитаСсылкаТитулГрузоотправителяГрузоотправитель.ЦветФона = ЦветВыделенияУчастника;
			Элементы.СсылкаТитулГрузоотправителяФХЖБанковскиеРеквизиты.ОграничениеТипа = 
				Новый ОписаниеТипов(ОбменСГИСЭПДПереопределяемый.ИмяТипаБанковскиеСчетаОрганизации());
		КонецЕсли;
		
		Если Объект.Организация = Объект.СсылкаТитулПереадресовкаНовыйГрузополучатель Тогда
			Элементы.ГруппаРеквизитаСсылкаТитулПереадресовкаНовыйГрузополучатель.ЦветФона = ЦветВыделенияУчастника;
		ИначеЕсли Объект.Организация = Объект.СсылкаДопТитулПереадресовкаНовыйГрузополучатель Тогда 
			Элементы.ГруппаРеквизитаСсылкаДопТитулПереадресовкаНовыйГрузополучатель.ЦветФона = ЦветВыделенияУчастника;	
		КонецЕсли;
		
		ИзмененСоставУчастников = ЗначениеЗаполнено(Объект.ИдентификаторГрузоотправителя) = Ложь
									Или ЗначениеЗаполнено(Объект.ИдентификаторГрузополучателя) = Ложь
									Или ЗначениеЗаполнено(Объект.ИдентификаторПеревозчика) = Ложь
									Или ТекущийГрузополучатель(Объект) <> Объект.СсылкаТитулГрузоотправителяГрузополучатель;
									
		Если (ЗначениеЗаполнено(Объект.ИдентификаторГрузополучателя) 
				И Объект.ИдентификаторГрузоотправителя = Объект.ИдентификаторГрузополучателя)
			Или (ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяГрузополучатель) 
				И Объект.СсылкаТитулГрузоотправителяГрузополучатель = Объект.СсылкаТитулГрузоотправителяГрузоотправитель) Тогда
			ГрузоотправительЯвляетсяГрузополучателем = Истина;	
			Элементы.СсылкаТитулГрузоотправителяГрузополучатель.Доступность = Ложь;
			Элементы.СсылкаТитулГрузоотправителяГрузополучатель.ОграничениеТипа = Элементы.СсылкаТитулГрузоотправителяГрузоотправитель.ОграничениеТипа;	
		КонецЕсли;
									
		ЗаполнитьЗначенияПоУмолчаниюДляТекущегоТитула();	
		УстановитьТекущийШагПомощника();
		
		ОтображениеОтправкиQR();
	КонецЕсли;
			
КонецПроцедуры

&НаСервере
Процедура ОтображениеОтправкиQR(УстановитьФлагЕслиНужно = Ложь)
	
	Если Объект.РольУчастника = 3 Тогда
		ОшибкаОтправкиQR = ОшибкаОтправкиQR(УстановитьФлагЕслиНужно);
		Если ЗначениеЗаполнено(ОшибкаОтправкиQR) Тогда
			Элементы.ТитулГрузоотправителяВодители_Ошибка.Заголовок = ОшибкаОтправкиQR;
			Элементы.ТитулГрузоотправителяВодители_Ошибка.Видимость = Истина;
		Иначе
			Элементы.ТитулГрузоотправителяВодители_Ошибка.Видимость = Ложь;
		КонецЕсли; 
	Иначе
		Элементы.ТитулГрузоотправителяВодители_Ошибка.Видимость = Ложь;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузоотправителяВодители_ОшибкаОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	Если НавигационнаяСсылкаФорматированнойСтроки = "Водитель" Тогда
		МассивПереходов = Новый Массив;
		МассивПереходов.Добавить("ЗаполнитьТитулГрузоотправителяВодители");
		МассивПереходов.Добавить("ТитулГрузоотправителяВодители");
		МассивПереходов.Добавить(0);
		МассивПереходов.Добавить("ХранимыеДанныеВодитель");
		МассивПереходов.Добавить("Почта");
		ЭтаФорма.ПереходыПоОшибкам = Новый ФиксированныйМассив(МассивПереходов);
		ОбменСГИСЭПДКлиент.ПоказатьОшибкуЗаполнения(ЭтаФорма);	
	ИначеЕсли НавигационнаяСсылкаФорматированнойСтроки = "Водители" Тогда
		МассивПереходов = Новый Массив;
		МассивПереходов.Добавить("ЗаполнитьТитулГрузоотправителяВодители");
		МассивПереходов.Добавить("ТитулГрузоотправителяВодители");
		ЭтаФорма.ПереходыПоОшибкам = Новый ФиксированныйМассив(МассивПереходов);
		ОбменСГИСЭПДКлиент.ПоказатьОшибкуЗаполнения(ЭтаФорма);	
	ИначеЕсли НавигационнаяСсылкаФорматированнойСтроки = "УчетнаяЗаписьПочты" Тогда
		СистемнаяУчетнаяЗаписьПочты = СистемнаяУчетнаяЗаписьПочты();
		Если ЗначениеЗаполнено(СистемнаяУчетнаяЗаписьПочты) Тогда
			ПараметрыФормы = Новый Структура("Ключ", СистемнаяУчетнаяЗаписьПочты);
			ОткрытьФорму("Справочник.УчетныеЗаписиЭлектроннойПочты.ФормаОбъекта", ПараметрыФормы);
		КонецЕсли;	
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция СистемнаяУчетнаяЗаписьПочты()

	Если ОбменСГИСЭПД.ПодсистемаСуществует("СтандартныеПодсистемы.РаботаСПочтовымиСообщениями") Тогда
		МодульРаботаСПочтовымиСообщениями = ОбщегоНазначенияКлиентСервер.ОбщийМодуль("РаботаСПочтовымиСообщениями");
		Если МодульРаботаСПочтовымиСообщениями.ПроверитьСистемнаяУчетнаяЗаписьДоступна() Тогда	
			Возврат МодульРаботаСПочтовымиСообщениями.СистемнаяУчетнаяЗапись();
		КонецЕсли;
	КонецЕсли;	
	
	Возврат Неопределено;
		
КонецФункции


&НаСервере
Функция ОшибкаОтправкиQR(УстановитьФлагЕслиНужно = Ложь)
		
	ОтправлятьQR = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
						"ТитулГрузоотправителяОтправлятьQR");
												
	Если УстановитьФлагЕслиНужно = Ложь 
		И ОтправлятьQR <> Истина Тогда
		Возврат "";
	КонецЕсли;
	
	Если ОбменСГИСЭПД.ПодсистемаСуществует("СтандартныеПодсистемы.РаботаСПочтовымиСообщениями") Тогда
		МодульРаботаСПочтовымиСообщениями = ОбщегоНазначенияКлиентСервер.ОбщийМодуль("РаботаСПочтовымиСообщениями");
		Если МодульРаботаСПочтовымиСообщениями.ПроверитьСистемнаяУчетнаяЗаписьДоступна() Тогда
			Если МодульРаботаСПочтовымиСообщениями.ПроверитьСистемнаяУчетнаяЗаписьДоступна() Тогда
				ОшибкаПодключения = Истина;
			КонецЕсли;
		КонецЕсли;
	Иначе
		Возврат "";
	КонецЕсли;
	
	МассивВодителей = ОбменСГИСЭПДКлиентСервер.МассивЗначенийПоСтрокамТаблицыИзСтруктурыФормы(ЭтаФорма, 
							"ТитулГрузоотправителяВодители", "ХранимыеДанныеВодитель");
							
	Если МассивВодителей.Количество() = 0 Тогда
		Возврат "";
	КонецЕсли;
							
	Получатели = ПолучитьПочтуВодителей(МассивВодителей);
	
	МассивСтрок = Новый Массив;
	
	Если Получатели.Количество() = 0 Тогда
		МассивСтрок.Добавить("Для отправки QR-кода нужно ");
		Если МассивВодителей.Количество() > 1 Тогда
			ТекстВодители = "водителей";
			СсылкаВодители = "Водители";
		Иначе
			ТекстВодители = "водителя";	
			СсылкаВодители = "Водитель";
		КонецЕсли;
		МассивСтрок.Добавить("указать почту ");
		МассивСтрок.Добавить(ОбменСГИСЭПДСовместимость.ФорматированнаяСтрока(ТекстВодители, , , , СсылкаВодители));
	ИначеЕсли УстановитьФлагЕслиНужно = Истина
	 	И ОтправлятьQR = Ложь Тогда
	 	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузоотправителяОтправлятьQR");
	КонецЕсли;
									
	Если ОшибкаПодключения = Истина Тогда
		Если МассивСтрок.Количество() = 0 Тогда
			МассивСтрок.Добавить("Для автоматической отправки QR-кода нужно ");	
		Иначе
			МассивСтрок.Добавить("и ");		
		КонецЕсли;
		МассивСтрок.Добавить("настроить служебную ");
		МассивСтрок.Добавить(ОбменСГИСЭПДСовместимость.ФорматированнаяСтрока("учетную запись почты", , , , "УчетнаяЗаписьПочты"));
	КонецЕсли;
	
	СтрокаОшибки = ОбменСГИСЭПДСовместимость.ФорматированнаяСтрока(МассивСтрок);
	
	Возврат СтрокаОшибки;
	
КонецФункции

&НаКлиенте
Процедура ОтправитьQR(Команда)
	
	ЧастичнаяРазгрузкаОткрыта = Ложь;
	Если ЗначениеЗаполнено(Объект.ДопТитулПереадресовкаИдентификаторФайла) Тогда
		КоличествоПереадресовок = 0;
		КоличествоПриемок = 0;
		Для Каждого СтрокаВерсии Из ВерсииТитулов Цикл
			Если СтрокаВерсии.Титул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7") Тогда
				КоличествоПереадресовок = КоличествоПереадресовок + 1;	
			ИначеЕсли СтрокаВерсии.Титул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул3") Тогда
				КоличествоПриемок = КоличествоПриемок + 1;
			КонецЕсли;
		КонецЦикла;	
		ЧастичнаяРазгрузкаОткрыта = КоличествоПереадресовок > КоличествоПриемок;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.ТитулГрузополучателяИдентификаторФайла)
		И ЧастичнаяРазгрузкаОткрыта = Ложь Тогда
		ПоказатьПредупреждение(, НСтр("ru='Приемка груза уже совершена, QR-код можно получить только по незавершенной перевозке.'"));
	Иначе
		Если Объект.РольУчастника = 1 Тогда
			Отправитель = Объект.ИдентификаторПеревозчика;
		ИначеЕсли Объект.РольУчастника = 2 Тогда
			Отправитель = Объект.ИдентификаторГрузополучателя;
		ИначеЕсли Объект.РольУчастника = 3 Тогда
			Отправитель = Объект.ИдентификаторГрузоотправителя;	
		КонецЕсли;
		ПараметрыФормы = Новый Структура;	
		ПараметрыФормы.Вставить("УИДМинтранс", Объект.УИДМинтранс);
		ПараметрыФормы.Вставить("Отправитель", Отправитель);
		ПараметрыФормы.Вставить("НомерДокумента", Объект.ТитулГрузоотправителяТранспортнаяНакладнаяНомер);
		ПараметрыФормы.Вставить("ДатаДокумента", Объект.ТитулГрузоотправителяТранспортнаяНакладнаяДата); 
		
		МассивВодителей = ОбменСГИСЭПДКлиентСервер.МассивЗначенийПоСтрокамТаблицыИзСтруктурыФормы(ЭтаФорма, 
							"ТитулГрузоотправителяВодители", "ХранимыеДанныеВодитель");
							
		ПараметрыФормы.Вставить("Получатели", ПолучитьПочтуВодителей(МассивВодителей));
		
		ОткрытьФорму("ОбщаяФорма.ОтправкаQR", 
						ПараметрыФормы, 
						ЭтаФорма, 
						УникальныйИдентификатор, , , , РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ВариантПоДоверенностиПриИзменении(Элемент)
	
	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма, Элемент.Имя);
	
	ВариантПоДоверенностиПриИзмененииСервер();

КонецПроцедуры


&НаСервере
Процедура ВариантПоДоверенностиПриИзмененииСервер()
	
	ОрганизацияОписаниеТипов = Новый ОписаниеТипов("СправочникСсылка." + ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("Организации"));
	КонтрагентОписаниеТипов = Новый ОписаниеТипов("СправочникСсылка." + ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("Контрагенты"));
	Если Объект.ЭтоВходящий = Ложь Тогда	
		Если ВариантПоДоверенности = 1 Тогда
			Элементы.СсылкаТитулГрузоотправителяГрузоотправитель.ОграничениеТипа = КонтрагентОписаниеТипов;
			Элементы.СсылкаТитулГрузоотправителяСоставитель.ОграничениеТипа = ОрганизацияОписаниеТипов;
		Иначе
			Элементы.СсылкаТитулГрузоотправителяГрузоотправитель.ОграничениеТипа = ОрганизацияОписаниеТипов;
			Элементы.СсылкаТитулГрузоотправителяСоставитель.ОграничениеТипа = Новый ОписаниеТипов("Неопределено");	
			Объект.СсылкаТитулГрузоотправителяСоставитель = Неопределено;
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
				"ТитулГрузоотправителяПредставительГрузоотправителя");
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура Проверить(Команда)
	
	Если ЗначениеЗаполнено(Объект.ТекущийТитул) = Ложь Тогда
		Возврат;	
	КонецЕсли;
	
	ЗаполнитьУчастников();
	
	ИнформацияПоПрефиксамТитула = ОбменСГИСЭПДКлиентСервер.ПрефиксТитулаПоЭлементуРегламентаЭДО(Объект.ТекущийТитул);
	ЗаполнитьИдентификациюФайлаОбмена(ИнформацияПоПрефиксамТитула, ИдентификаторОтправителя());
		
КонецПроцедуры


&НаКлиенте
Процедура НадписьОшибкиЗакрытьОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	Если НавигационнаяСсылкаФорматированнойСтроки = "ЗакрытьОшибки" Тогда
		СтандартнаяОбработка = Ложь;
		Элементы.ГруппаОшибки.Видимость = Ложь;
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура СледующаяОшибка(Команда)
	
	ОбменСГИСЭПДКлиент.НавигацияПоОшибкамЗаполнения(ЭтаФорма, 
													ОшибкиЗаполнения, 
													Элементы.ОшибкиЗаполнения.ТекущаяСтрока);

КонецПроцедуры

&НаКлиенте
Процедура ПредыдущаяОшибка(Команда)
	
	ОбменСГИСЭПДКлиент.НавигацияПоОшибкамЗаполнения(ЭтаФорма, 
													ОшибкиЗаполнения, 
													Элементы.ОшибкиЗаполнения.ТекущаяСтрока,
													Истина);
	
КонецПроцедуры


&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	Если ЗначениеЗаполнено(ТекущийОбъект.ТекущийТитул) = Ложь Тогда
		Возврат;
	КонецЕсли;
	
	ИнформацияПоПрефиксамТитула = ОбменСГИСЭПДКлиентСервер.ПрефиксТитулаПоЭлементуРегламентаЭДО(Объект.ТекущийТитул);
	
	Если ИнформацияПоПрефиксамТитула.ВПрограмме = Неопределено Тогда
		Возврат;
	КонецЕсли;
		
	НомерВерсии = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
		ИнформацияПоПрефиксамТитула.ВПрограмме + "НомерИсправления", 0);		
	
	Если ПараметрыЗаписи.Свойство("НеДобавлятьВерсию") = Ложь Тогда
		// Запишем версию при необходимости
		ТекущийОбъект.ДополнительныеСвойства.Вставить("НомерВерсии", НомерВерсии);
		
		ИдентификаторФайлаВерсии = Объект[ИнформацияПоПрефиксамТитула.ВПрограмме + "ИдентификаторФайла"];
		
		ДатаВерсии = Объект[ИнформацияПоПрефиксамТитула.ВПрограмме + "ДатаФормированияФайла"]
						+ 60 * 60 * Час(Объект[ИнформацияПоПрефиксамТитула.ВПрограмме + "ВремяФормированияФайла"]) 
						+ 60 * Минута(Объект[ИнформацияПоПрефиксамТитула.ВПрограмме + "ВремяФормированияФайла"]) 
						+ Секунда(Объект[ИнформацияПоПрефиксамТитула.ВПрограмме + "ВремяФормированияФайла"]);
		
		ЭтоНоваяВерсия = Истина;
		Для Каждого СтрокаВерсии Из ВерсииТитулов Цикл
			Если СтрокаВерсии.Титул = ТекущийОбъект.ТекущийТитул 
			И СтрокаВерсии.НомерВерсии = НомерВерсии Тогда
				СтрокаВерсии.ИдентификаторФайла = ИдентификаторФайлаВерсии;	
				ЭтоНоваяВерсия = Ложь;
			КонецЕсли;	
		КонецЦикла;
	
		Если ЭтоНоваяВерсия = Истина Тогда
			НовСтрокаВерсии = ВерсииТитулов.Добавить();
			НовСтрокаВерсии.ДатаВерсии = ДатаВерсии;
			Если НовСтрокаВерсии.ДатаВерсии = Дата(1,1,1) Тогда
				НовСтрокаВерсии.ДатаВерсии = ТекущаяДатаСеанса();
			КонецЕсли;
			НовСтрокаВерсии.ИдентификаторФайла = ИдентификаторФайлаВерсии;
			НовСтрокаВерсии.НомерВерсии = НомерВерсии;
			НовСтрокаВерсии.Титул = ТекущийОбъект.ТекущийТитул;		
		КонецЕсли;
			
		ВерсияТитула = Новый Структура;
		ВерсияТитула.Вставить("НомерВерсии", НомерВерсии);
		ВерсияТитула.Вставить("ИдентификаторФайла", ИдентификаторФайлаВерсии);
		ВерсияТитула.Вставить("Титул", ТекущийОбъект.ТекущийТитул);
		ВерсияТитула.Вставить("ДатаВерсии", ДатаВерсии);
		ТекущийОбъект.ДополнительныеСвойства.Вставить("ВерсияТитула", ВерсияТитула);
	КонецЕсли;
	
	МассивВерсийТитула = Неопределено;
	СтруктураРеквизитов.Свойство(ИнформацияПоПрефиксамТитула.ВПрограмме, МассивВерсийТитула);
	Если МассивВерсийТитула <> Неопределено Тогда
		ТекущийОбъект.ДополнительныеСвойства.Вставить("СтруктураРеквизитов", МассивВерсийТитула[Мин(НомерВерсии, МассивВерсийТитула.ВГраница())]);
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура ТитулГрузоотправителяЗаказНомерПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузоотправителяЗаказДатаПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
КонецПроцедуры


&НаКлиенте
Процедура ПриИзмененииДанныхНаФорме(ИмяЭлемента)
	
	СтруктураРеквизитовФормы = Новый Структура(ЭтаФорма.ОписаниеРеквизитовФормы.ПараметрыФормы);
	СтруктураРеквизитовОбъекта = Новый Структура(ЭтаФорма.ОписаниеРеквизитовФормы.РеквизитыОбъекта);
	
	Если СтруктураРеквизитовФормы.Свойство(ИмяЭлемента) Тогда
		ЗначениеРеквизита = ЭтаФорма[ИмяЭлемента];
	ИначеЕсли СтруктураРеквизитовОбъекта.Свойство(ИмяЭлемента) Тогда
		ЗначениеРеквизита = Объект[ИмяЭлемента];
	КонецЕсли;
	
	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, ИмяЭлемента, ЗначениеРеквизита);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузоотправителяТранспортнаяНакладнаяНомерПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузоотправителяТранспортнаяНакладнаяДатаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
	
	Оповестить("Запись_ДокументыЭПД", Объект.Ссылка);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	ОбменСГИСЭПДКлиент.ПриОткрытииПодчиненнойФормы(ЭтаФорма);
	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма);
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьЗначенияПоУмолчаниюДляТекущегоТитула()
	
	КонтейнерОтображаемойВерсии = Неопределено;    
	
	ИнициализироватьИсправительнуюВерсиюТитулаПриНеобходимости();
	
	Если (ЗначениеЗаполнено(Объект.Ссылка) = Ложь 
		Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул1")) Тогда
			
		Если ЗначениеЗаполнено(Объект.ТитулГрузоотправителяТранспортнаяНакладнаяДата) = Ложь Тогда
			Объект.ТитулГрузоотправителяТранспортнаяНакладнаяДата = ТекущаяДатаСеанса();	
		КонецЕсли;
				
		Если ЗначениеЗаполнено(Объект.ВидДокумента) = Ложь Тогда
			Объект.ВидДокумента = ПредопределенноеЗначение("Перечисление.ВидыЭД.ЭТрН");
		КонецЕсли;
		
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузоотправителяКодМетодаОпределенияМассыГруза", 
			"03", 
			Ложь, КонтейнерОтображаемойВерсии);

		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузоотправителяКодВалюты", "643", Ложь, КонтейнерОтображаемойВерсии);
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузоотправителяНаименованиеВалюты", 
			"Российский рубль", 
			Ложь, КонтейнерОтображаемойВерсии);	

		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузоотправителяВладелецПунктаПогрузкиЯвляетсяГрузоотправителем", 
			"1", 
			Ложь, КонтейнерОтображаемойВерсии);	
		
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
				"ТитулГрузоотправителяЭкспедитор", 
				"0", 
				Ложь, КонтейнерОтображаемойВерсии);	
				
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
				"ТитулГрузоотправителяСпособПередачиУказанияНаПереадресовку", 
				"Электронное уведомление перевозчика о переадресовке", 
				Ложь, КонтейнерОтображаемойВерсии);
		
	ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2") Тогда 
		
		ИнформацияПоПрефиксамТитула = ОбменСГИСЭПДКлиентСервер.ПрефиксТитулаПоЭлементуРегламентаЭДО(Объект.ТекущийТитул);
		
		Если ЗначениеЗаполнено(Объект[ИнформацияПоПрефиксамТитула.ВПрограмме + "ИдентификаторФайла"])
			И ЗначениеЗаполнено(ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, ИнформацияПоПрефиксамТитула.ПолеУИД)) Тогда
			Модифицированность = Истина;
		КонецЕсли;
		
	ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул3") Тогда
		
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузополучателяКодМетодаОпределенияМассыГруза", 
			"03", 
			Ложь, КонтейнерОтображаемойВерсии);
	
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузополучателяФактическиеДатаВремяПрибытия", 
			ОбменСГИСЭПДКлиентСервер.ОкруглениеДатыПриИзменении(ТекущаяДатаСеанса()), 
			Ложь, КонтейнерОтображаемойВерсии);
	
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузополучателяФактическиеДатаВремяУбытия", 
			ОбменСГИСЭПДКлиентСервер.ОкруглениеДатыПриИзменении(ТекущаяДатаСеанса()), 
			Ложь, КонтейнерОтображаемойВерсии);
			
		ТитулГрузоотправителяДатаИВремяДоставки = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма,
														"ТитулГрузоотправителяДатаИВремяДоставки",
														ТекущаяДатаСеанса(),
														КонтейнерОтображаемойВерсии);

		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузополучателяЗаявленныеДатаВремяПрибытия", 
			ТитулГрузоотправителяДатаИВремяДоставки, 
			Ложь, КонтейнерОтображаемойВерсии);
		
		ТекущийГрузополучатель = ТекущийГрузополучатель(Объект);
		
		Если НЕ ОбменСГИСЭПДКлиентСервер.СкопироватьРеквизитыВСтруктуреФормы(ЭтаФорма, 
			"ТитулПереадресовкаАдресВыгрузки", "ТитулГрузополучателяАдресВыгрузки") Тогда
			ОбменСГИСЭПДКлиентСервер.СкопироватьРеквизитыВСтруктуреФормы(ЭтаФорма, 
				"ТитулГрузоотправителяГрузополучательАдресДоставки", "ТитулГрузополучателяАдресВыгрузки");
		КонецЕсли;
		ОбменСГИСЭПДКлиентСервер.ЗаполнитьПредставлениеАдреса("ПредставлениеТитулГрузополучателяАдресВыгрузки", ЭтаФорма);
		
		ОбменСГИСЭПДКлиентСервер.ЗаполнениеСпискаСохраненныхАдресов(ЭтаФорма, 
					ТекущийГрузополучатель,
					Элементы.ПредставлениеТитулГрузополучателяАдресВыгрузки,
					Элементы.ПредставлениеТитулГрузополучателяАдресВыгрузки.СписокВыбора);	
		
	ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул4") Тогда 
		
		ИнформацияПоПрефиксамТитула = ОбменСГИСЭПДКлиентСервер.ПрефиксТитулаПоЭлементуРегламентаЭДО(Объект.ТекущийТитул);
		
		Если ЗначениеЗаполнено(Объект[ИнформацияПоПрефиксамТитула.ВПрограмме + "ИдентификаторФайла"])
			И ЗначениеЗаполнено(ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, ИнформацияПоПрефиксамТитула.ПолеУИД)) Тогда
			Модифицированность = Истина;
		КонецЕсли;
		
	ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул7") Тогда
		
		ТекущийГрузополучатель = ТекущийГрузополучатель(Объект);
		
		ОбменСГИСЭПДКлиентСервер.ЗаполнениеСпискаСохраненныхАдресов(ЭтаФорма, 
					ТекущийГрузополучатель,
					Элементы.ПредставлениеТитулПереадресовкаАдресВыгрузки,
					Элементы.ПредставлениеТитулПереадресовкаАдресВыгрузки.СписокВыбора, Истина);
					
	ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7") Тогда
		
		ТекущийГрузополучатель = ТекущийГрузополучатель(Объект);
		
		ОбменСГИСЭПДКлиентСервер.ЗаполнениеСпискаСохраненныхАдресов(ЭтаФорма, 
					ТекущийГрузополучатель,
					Элементы.ПредставлениеДопТитулПереадресовкаАдресВыгрузки,
					Элементы.ПредставлениеДопТитулПереадресовкаАдресВыгрузки.СписокВыбора, Истина);
		
	КонецЕсли;
	
	// ЗИТ ответили, что иные получатели должны копироваться из Т1
	// для переадресовки в иных получателях старый или новый ГП 
	Если ЗначениеЗаполнено(Объект.Ссылка) 
		И Объект.ТекущийТитул <> ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул1")
		И Объект.ТекущийТитул <> ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул7")
		И Объект.ТекущийТитул <> ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7") Тогда
			СкопироватьИныхПолучателейИзТитулаГрузоотправителя();	
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяОбщееКоличествоПринятыхГрузовыхМестПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяФактическоеСостояниеГрузаПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяМассаБруттоПринятогоГрузаПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяМассаНеттоПринятогоГрузаПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяОбъемГрузовыхМестПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры






&НаСервере
Процедура СкопироватьИныхПолучателейИзТитулаГрузоотправителя()
	
	Если ЗначениеЗаполнено(Объект.ТекущийТитул) Тогда
		ИнформацияПоПрефиксамТитула = ОбменСГИСЭПДКлиентСервер.ПрефиксТитулаПоЭлементуРегламентаЭДО(Объект.ТекущийТитул);	
		К = 1;
		КлючОткуда = "ТитулГрузоотправителяИдентификаторыИныхПолучателейФайла__" + К + "__" + "ИдентификаторИногоПолучателя";
		ЗначениеОткуда = Неопределено;
		КонтейнерОтображаемойВерсии = ОбменСГИСЭПДКлиентСервер.КонтейнерОтображаемойВерсииРеквизита(ЭтаФорма, КлючОткуда);
		СтруктураВерсииТитула = КонтейнерОтображаемойВерсии.СтруктураРеквизитовЗаполнение[КонтейнерОтображаемойВерсии.ПрефиксТитула][КонтейнерОтображаемойВерсии.НомерВерсии];
		Пока СтруктураВерсииТитула.Свойство(КлючОткуда, ЗначениеОткуда) Цикл
			Если ЗначениеОткуда <> Объект.ИдентификаторГрузоотправителя
			И ЗначениеОткуда <> Объект.ИдентификаторГрузополучателя
			И ЗначениеОткуда <> Объект.ИдентификаторПеревозчика Тогда
				КлючКуда = ИнформацияПоПрефиксамТитула.ВПрограмме 
								+ "ИдентификаторыИныхПолучателейФайла__" + К + "__" + "ИдентификаторИногоПолучателя";
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, КлючКуда, ЗначениеОткуда, , КонтейнерОтображаемойВерсии);	
				К = К + 1;
				КлючОткуда = "ТитулГрузоотправителяИдентификаторыИныхПолучателейФайла__" + К + "__" + "ИдентификаторИногоПолучателя";
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяФактическиеДатаВремяПрибытияРегулирование(Элемент, Направление, СтандартнаяОбработка)
	
	ТитулГрузополучателяФактическиеДатаВремяПрибытия = 
		ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
			"ТитулГрузополучателяФактическиеДатаВремяПрибытия");
	
	ОбменСГИСЭПДКлиентСервер.ОкруглениеДатыПриРегулировании(ТитулГрузополучателяФактическиеДатаВремяПрибытия, Направление, СтандартнаяОбработка);
	
	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
		"ТитулГрузополучателяФактическиеДатаВремяПрибытия", ТитулГрузополучателяФактическиеДатаВремяПрибытия);

КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяФактическиеДатаВремяУбытияРегулирование(Элемент, Направление, СтандартнаяОбработка)
	
	ТитулГрузополучателяФактическиеДатаВремяУбытия = 
		ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
			"ТитулГрузополучателяФактическиеДатаВремяУбытия");
	
	ОбменСГИСЭПДКлиентСервер.ОкруглениеДатыПриРегулировании(ТитулГрузополучателяФактическиеДатаВремяУбытия, Направление, СтандартнаяОбработка);
	
	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
		"ТитулГрузополучателяФактическиеДатаВремяУбытия", ТитулГрузополучателяФактическиеДатаВремяУбытия);

КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяЗаявленныеДатаВремяПрибытияРегулирование(Элемент, Направление, СтандартнаяОбработка)
	
	ТитулГрузополучателяЗаявленныеДатаВремяПрибытия = 
		ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
			"ТитулГрузополучателяЗаявленныеДатаВремяПрибытия");
	
	ОбменСГИСЭПДКлиентСервер.ОкруглениеДатыПриРегулировании(ТитулГрузополучателяЗаявленныеДатаВремяПрибытия, Направление, СтандартнаяОбработка);
	
	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
		"ТитулГрузополучателяЗаявленныеДатаВремяПрибытия", ТитулГрузополучателяЗаявленныеДатаВремяПрибытия);
	
КонецПроцедуры


&НаКлиенте
Процедура ДопТитулГрузополучателяФактическиеДатаВремяПрибытияРегулирование(Элемент, Направление, СтандартнаяОбработка)
	
	ДопТитулГрузополучателяФактическиеДатаВремяПрибытия = 
		ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
			"ДопТитулГрузополучателяФактическиеДатаВремяПрибытия");
	
	ОбменСГИСЭПДКлиентСервер.ОкруглениеДатыПриРегулировании(ДопТитулГрузополучателяФактическиеДатаВремяПрибытия, Направление, СтандартнаяОбработка);
	
	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
		"ДопТитулГрузополучателяФактическиеДатаВремяПрибытия", ДопТитулГрузополучателяФактическиеДатаВремяПрибытия);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяФактическиеДатаВремяУбытияРегулирование(Элемент, Направление, СтандартнаяОбработка)
	
	ДопТитулГрузополучателяФактическиеДатаВремяУбытия = 
		ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
			"ДопТитулГрузополучателяФактическиеДатаВремяУбытия");
			
	ОбменСГИСЭПДКлиентСервер.ОкруглениеДатыПриРегулировании(ДопТитулГрузополучателяФактическиеДатаВремяУбытия, Направление, СтандартнаяОбработка);
	
	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
		"ДопТитулГрузополучателяФактическиеДатаВремяУбытия", ДопТитулГрузополучателяФактическиеДатаВремяУбытия);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяЗаявленныеДатаВремяПрибытияРегулирование(Элемент, Направление, СтандартнаяОбработка)
	
	ДопТитулГрузополучателяЗаявленныеДатаВремяПрибытия = 
		ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
			"ДопТитулГрузополучателяЗаявленныеДатаВремяПрибытия");
			
	ОбменСГИСЭПДКлиентСервер.ОкруглениеДатыПриРегулировании(ДопТитулГрузополучателяЗаявленныеДатаВремяПрибытия, Направление, СтандартнаяОбработка);
	
	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
		"ДопТитулГрузополучателяЗаявленныеДатаВремяПрибытия", ДопТитулГрузополучателяЗаявленныеДатаВремяПрибытия);
	
КонецПроцедуры




&НаСервере
Процедура ЗаполнитьСведенияОПереадресовке()

	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
		"ТитулГрузоотправителяЛицоИмеющееПолномочияПереадресовки", "Грузоотправитель", Ложь);

	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
		"ТитулГрузоотправителяСпособПередачиУказанияНаПереадресовку", "Электронное уведомление перевозчика о переадресовке", Ложь);
	
	Если ОбменСГИСЭПДКлиентСервер.ПолучитьКоличествоСтрокТаблицыИзСтруктурыФормы(ЭтаФорма, 
		"ТитулГрузоотправителяОтветственныйЗаПереадресовкуНомераТелефонов") = 0 Тогда
		ЛицоОсуществляющееПереадресацию = Неопределено;
		ТитулГрузоотправителяЛицоИмеющееПолномочияПереадресовки = 
			ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, "ТитулГрузоотправителяЛицоИмеющееПолномочияПереадресовки");
		Если ТитулГрузоотправителяЛицоИмеющееПолномочияПереадресовки = "Грузоотправитель" И ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяГрузоотправитель) Тогда
			ЛицоОсуществляющееПереадресацию = Объект.СсылкаТитулГрузоотправителяГрузоотправитель;		
		ИначеЕсли ТитулГрузоотправителяЛицоИмеющееПолномочияПереадресовки = "Грузополучатель" И ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяГрузополучатель) Тогда
			ЛицоОсуществляющееПереадресацию = Объект.СсылкаТитулГрузоотправителяГрузополучатель;	
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ЛицоОсуществляющееПереадресацию) Тогда
			ОрганизацияТип = Новый ОписаниеТипов("СправочникСсылка." + ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("Организации"));
			КонтрагентТип = Новый ОписаниеТипов("СправочникСсылка." + ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьИмяПрикладногоСправочника("Контрагенты"));
			ДатаОпределенияКонтактов = ТекущаяДатаСеанса();
			Телефон = Неопределено;
			Если ТипЗнч(ЛицоОсуществляющееПереадресацию) = ОрганизацияТип Тогда
				Телефон = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(ЛицоОсуществляющееПереадресацию, 
																Справочники.ВидыКонтактнойИнформации.ТелефонОрганизации, 
																ДатаОпределенияКонтактов, Истина);
			ИначеЕсли ТипЗнч(ЛицоОсуществляющееПереадресацию) = КонтрагентТип Тогда
				Телефон = УправлениеКонтактнойИнформацией.КонтактнаяИнформацияОбъекта(ЛицоОсуществляющееПереадресацию, 
																Справочники.ВидыКонтактнойИнформации.ТелефонКонтрагента, 
																ДатаОпределенияКонтактов, Истина);
			КонецЕсли;
			Если ЗначениеЗаполнено(Телефон) Тогда
				КлючКуда = "ТитулГрузоотправителяОтветственныйЗаПереадресовкуНомераТелефонов__1__Телефон";
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, КлючКуда, Телефон);
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОтменаВводаДопТитула(Команда)
	
	ЗаполнитьРеквизитыПоследнейВерсии(Объект.ТекущийТитул);
	
	Объект.ТекущийТитул = Неопределено;
	ВводимТитулКорректировкиСтоимости = Ложь;
	ВводимТитулКорректировкиЭстафета = Ложь;
	ВводимТитулПереадресовки = Ложь;
	ВводимДопТитулПереадресовки = Ложь;
	ВводимДопТитулКорректировкиЭстафета = Ложь;
	ОбменСГИСЭПДКлиентСервер.УстановитьДоступностьЭлементовЭТрН(ЭтаФорма);
	УстановитьТекущийШагПомощника();

КонецПроцедуры

&НаКлиенте
Процедура НадписьСтатусаОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	Если НавигационнаяСсылкаФорматированнойСтроки = "ТекущиеДелаПоЭДО" Тогда
		СтандартнаяОбработка = Ложь;
		ОбменСГИСЭПДКлиент.ОткрытьЭлектронныйДокументОбъектаУчета(Объект.Ссылка);
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ОткрытьЭлектронныйДокумент(Команда)
	
	ОбменСГИСЭПДКлиент.ОткрытьЭлектронныйДокументОбъектаУчета(Объект.Ссылка);
	
КонецПроцедуры


&НаКлиенте
Процедура НадписьСтатусаОшибкаОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	Если НавигационнаяСсылкаФорматированнойСтроки = "ОписаниеОшибки" Тогда
		СтандартнаяОбработка = Ложь;
		ОбменСГИСЭПДКлиент.ОткрытьОписаниеОшибки(Объект.Ссылка, ЭтаФорма);
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура СоздатьПереадресовку(Команда)
	
	Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул7");
	УстановитьВидимостьСтраницыТитулПереадресовки();
	ОбменСГИСЭПДКлиентСервер.УстановитьДоступностьЭлементовЭТрН(ЭтаФорма);
	ЗаполнитьЗначенияПоУмолчаниюДляТекущегоТитула();

КонецПроцедуры

&НаКлиенте
Процедура СоздатьПереадресовкуДоп(Команда)
	
	Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7");
	УстановитьВидимостьСтраницыНачалоДоп();
	ОбменСГИСЭПДКлиентСервер.УстановитьДоступностьЭлементовЭТрН(ЭтаФорма);
	ЗаполнитьЗначенияПоУмолчаниюДляТекущегоТитула();
	
КонецПроцедуры

&НаКлиенте
Процедура СоздатьЭстафету(Команда)
	
	Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул8");
	УстановитьВидимостьСтраницыТитулКорректировкиЭстафета();
	ОбменСГИСЭПДКлиентСервер.УстановитьДоступностьЭлементовЭТрН(ЭтаФорма);
	ЗаполнитьЗначенияПоУмолчаниюДляТекущегоТитула();
	
КонецПроцедуры

&НаКлиенте
Процедура СоздатьЭстафетуДоп(Команда)
	
	Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул8");
	УстановитьВидимостьСтраницыТитулКорректировкиЭстафетаДоп();
	ОбменСГИСЭПДКлиентСервер.УстановитьДоступностьЭлементовЭТрН(ЭтаФорма);
	ЗаполнитьЗначенияПоУмолчаниюДляТекущегоТитула();
	
КонецПроцедуры

&НаКлиенте
Процедура СоздатьКорректировкуСтоимости(Команда)
	
	Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул5");
	УстановитьВидимостьСтраницыТитулПлатеж();
	ОбменСГИСЭПДКлиентСервер.УстановитьДоступностьЭлементовЭТрН(ЭтаФорма);
	ЗаполнитьЗначенияПоУмолчаниюДляТекущегоТитула();
	
КонецПроцедуры


&НаСервере
Процедура ЗаполнитьПредставленияАдресов(Знач Титул = Неопределено)
	
	Если Титул = Неопределено Тогда
		ПрефиксТитула = ОбменСГИСЭПДКлиентСервер.ПолучитьПрефиксТитулаПоСтраницеОсновнойФормы(Элементы.Страницы.ТекущаяСтраница.Имя, 
			ОбменСГИСЭПДКлиентСервер.ТипДокументаТранспортнаяНакладная());	
		Титул = ОбменСГИСЭПДКлиентСервер.ТитулПоПрефиксу("Документ.ЭлектроннаяТранспортнаяНакладная", ПрефиксТитула);
	КонецЕсли;
	
	Если Титул = Неопределено Или Титул = Перечисления.ТипыЭлементовВерсииЭД.ЭТрН_Титул1 Тогда
		ОбменСГИСЭПДКлиентСервер.ЗаполнитьПредставлениеАдреса("ПредставлениеТитулГрузоотправителяГрузополучательАдресДоставки", ЭтаФорма);
	КонецЕсли;
		
	Если Титул = Неопределено Или Титул = Перечисления.ТипыЭлементовВерсииЭД.ЭТрН_Титул7 Тогда
		ОбменСГИСЭПДКлиентСервер.ЗаполнитьПредставлениеАдреса("ПредставлениеТитулПереадресовкаАдресВыгрузки", ЭтаФорма);
		ОбменСГИСЭПДКлиентСервер.ЗаполнитьПредставлениеАдреса("ПредставлениеТитулПереадресовкаНовыйГрузополучательАдрес", ЭтаФорма);
	КонецЕсли;
	
	Если Титул = Неопределено Или Титул = Перечисления.ТипыЭлементовВерсииЭД.ЭТрН_Титул3 Тогда
		ОбменСГИСЭПДКлиентСервер.ЗаполнитьПредставлениеАдреса("ПредставлениеТитулГрузополучателяАдресВыгрузки", ЭтаФорма);
	КонецЕсли;
	
	Если Титул = Неопределено Или Титул = Перечисления.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7 Тогда
		ОбменСГИСЭПДКлиентСервер.ЗаполнитьПредставлениеАдреса("ПредставлениеДопТитулПереадресовкаАдресВыгрузки", ЭтаФорма);
		ОбменСГИСЭПДКлиентСервер.ЗаполнитьПредставлениеАдреса("ПредставлениеДопТитулПереадресовкаНовыйГрузополучательАдрес", ЭтаФорма);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Функция ОписаниеРеквизитовФормы() Экспорт
	
	Возврат ОписаниеРеквизитовФормыСервер();
	
КонецФункции

&НаСервере
Функция ОписаниеРеквизитовФормыСервер()
	
	Возврат ОбменСГИСЭПД.ОписаниеРеквизитовФормы(ЭтаФорма);
		
КонецФункции

&НаКлиенте
Процедура ЗаполнитьТитулГрузоотправителяОснованиеРасчетовИнымЛицом(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулГрузоотправителяДоговорНаУсловияПеревозки(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулГрузоотправителяГрузы(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулГрузоотправителяСопроводительныеДокументы(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулГрузоотправителяУказанияГрузоотправителя(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулГрузоотправителяВодители(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулГрузоотправителяПогрузка(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулГрузоотправителяОтметкиГрузоотправителя(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулПеревозчикаПриемкаОтметкиПеревозчикаПриПриемеГруза(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулГрузополучателяСведенияОПринятыхГрузах(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулГрузополучателяОтметкиГрузополучателя(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулПеревозчикаВыдачаОтметкиПриВыдачеГруза(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулПереадресовкаОснованиеРеквизитыСторон(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДопТитулПереадресовкаОснованиеРеквизитыСторон(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулПереадресовкаКонтактныеДанныеНовогоГрузополучателя(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулПереадресовкаСведенияОбОтметках(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДопТитулПереадресовкаКонтактныеДанныеНовогоГрузополучателя(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДопТитулПереадресовкаСведенияОбОтметках(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулПеревозчикаЗаменыДокументРеквизитыСторон(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДопТитулПеревозчикаЗаменыДокументРеквизитыСторон(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулПеревозчикаЗаменыЗаменыВодителей(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДопТитулПеревозчикаЗаменыЗаменыВодителей(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулПеревозчикаЗаменыТранспортныеСредства(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДопТитулПеревозчикаЗаменыТранспортныеСредства(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулПеревозчикаЗаменыОтметкиОЗаменах(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьДопТитулПеревозчикаЗаменыОтметкиОЗаменах(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулПеревозчикаФХЖПеревозчик(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТитулГрузоотправителяДоверенность(Команда)
	
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Команда.Имя);
	
КонецПроцедуры



&НаКлиенте
Процедура СсылкаТитулГрузоотправителяГрузоотправительПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыПоСсылке(Элемент, ЭтаФорма);
	
	Если ГрузоотправительЯвляетсяГрузополучателем Тогда
		Объект.СсылкаТитулГрузоотправителяГрузополучатель = Объект.СсылкаТитулГрузоотправителяГрузоотправитель;	
		СсылкаТитулГрузоотправителяГрузополучательПриИзменении(Элементы.СсылкаТитулГрузоотправителяГрузополучатель);
	КонецЕсли;
	
	ЗаполнитьСведенияОПереадресовке();
	
КонецПроцедуры

&НаКлиенте
Процедура СсылкаТитулГрузоотправителяСоставительПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ИзмененСоставУчастников = Истина;
	
	НаименованиеСоставителя = Строка(Объект.СсылкаТитулГрузоотправителяСоставитель);
	
	Если ЗначениеЗаполнено(НаименованиеСоставителя) Тогда
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузоотправителяПредставительГрузоотправителя", НаименованиеСоставителя);
	Иначе
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, 
			"ТитулГрузоотправителяПредставительГрузоотправителя");	
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура СсылкаТитулГрузоотправителяЗаказчикПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыПоСсылке(Элемент, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ИныеПолучатели(Команда)
	
	ТолькоПросмотрИныхПолучателей = Элементы.Страницы.ТекущаяСтраница.ТолькоПросмотр
										Или Элементы.Страницы.ТекущаяСтраница <> Элементы.СтраницаСодИнфГО;
		
	Если Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаСодИнфГО Тогда
		ИмяТаблицы = "ТитулГрузоотправителяИдентификаторыИныхПолучателейФайла";	
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаСодИнфПрвПрием Тогда
		ИмяТаблицы = "ТитулПеревозчикаПриемкаИдентификаторыИныхПолучателейФайла";
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаСодИнфГП Тогда
		ИмяТаблицы = "ТитулГрузополучателяИдентификаторыИныхПолучателейФайла";
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаСодПрвВыд Тогда
		ИмяТаблицы = "ТитулПеревозчикаВыдачаИдентификаторыИныхПолучателейФайла";
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаСодИнфЗамен Тогда
		ИмяТаблицы = "ТитулПеревозчикаЗаменыИдентификаторыИныхПолучателейФайла";
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаДопСодИнфЗамен Тогда
		ИмяТаблицы = "ДопТитулПеревозчикаЗаменыИдентификаторыИныхПолучателейФайла";
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаДопСодИнфГП Тогда
		ИмяТаблицы = "ДопТитулГрузополучателяИдентификаторыИныхПолучателейФайла";
	ИначеЕсли Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаДопСодПрвВыд Тогда
		ИмяТаблицы = "ДопТитулПеревозчикаВыдачаИдентификаторыИныхПолучателейФайла";
	Иначе
		ПоказатьПредупреждение(, НСтр("ru='Для текущего титула добавление иных получателей не предусмотрено форматом обмена'"), , );
		Возврат;
	КонецЕсли;
	
	Организация = Неопределено;
	ТипОрганизация = ОбменСГИСЭПДВызовСервера.ПолучитьТипОрганизация();
	Если ТипЗнч(Объект.СсылкаТитулГрузоотправителяПеревозчик) = ТипОрганизация Тогда
		Организация = Объект.СсылкаТитулГрузоотправителяПеревозчик;
	ИначеЕсли ТипЗнч(Объект.СсылкаТитулГрузоотправителяГрузополучатель) = ТипОрганизация Тогда
		Организация = Объект.СсылкаТитулГрузоотправителяГрузополучатель;
	ИначеЕсли ТипЗнч(Объект.СсылкаТитулГрузоотправителяГрузоотправитель) = ТипОрганизация Тогда
		Организация = Объект.СсылкаТитулГрузоотправителяГрузоотправитель;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Организация) = Ложь Тогда
		ПоказатьПредупреждение(, "Сначала нужно выбрать организацию, для которой настроена учетная запись 1С-ЭДО");	
		Возврат;	
	КонецЕсли;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Организация", Организация);
	
	МассивПолучателей = Новый Массив;
	К = 1;
	КлючСтруктуры = ИмяТаблицы + "__" + К + "__ИдентификаторИногоПолучателя";
	ЗначениеРеквизита = Неопределено;
	КонтейнерОтображаемойВерсии = ОбменСГИСЭПДКлиентСервер.КонтейнерОтображаемойВерсииРеквизита(ЭтаФорма, ИмяТаблицы);
	СтруктураВерсииТитула = КонтейнерОтображаемойВерсии.СтруктураРеквизитовЗаполнение[КонтейнерОтображаемойВерсии.ПрефиксТитула][КонтейнерОтображаемойВерсии.НомерВерсии];
	Пока СтруктураВерсииТитула.Свойство(КлючСтруктуры, ЗначениеРеквизита) Цикл
		Если ЗначениеРеквизита <> Объект.ИдентификаторГрузоотправителя
		И ЗначениеРеквизита <> Объект.ИдентификаторГрузополучателя
		И ЗначениеРеквизита <> Объект.ИдентификаторПеревозчика Тогда
			МассивПолучателей.Добавить(ЗначениеРеквизита);	
			К = К + 1;
			КлючСтруктуры = ИмяТаблицы + "__" + К + "__ИдентификаторИногоПолучателя";
		КонецЕсли;
	КонецЦикла;
	
	ПараметрыФормы.Вставить("ВидДокумента", Объект.ВидДокумента);
	ПараметрыФормы.Вставить("ИмяТаблицы", ИмяТаблицы);
	ПараметрыФормы.Вставить("МассивПолучателей", МассивПолучателей);
	ПараметрыФормы.Вставить("ТолькоПросмотр", ТолькоПросмотрИныхПолучателей);
	
	Результат = ОткрытьФормуМодально(
		"Документ.ЭлектроннаяТранспортнаяНакладная.Форма.ИныеПолучатели", ПараметрыФормы, ЭтаФорма);
	ИныеПолучатели_Закрытие(Результат, ПараметрыФормы);
					
КонецПроцедуры

&НаКлиенте
Процедура ИныеПолучатели_Закрытие(Результат, ДополнительныеПараметры) Экспорт
	
	Если ТипЗнч(Результат) = Тип("Массив") Тогда
		ОбменСГИСЭПДКлиентСервер.УдалитьСтрокиТаблицыИзСтруктурыФормы(ЭтаФорма, ДополнительныеПараметры.ИмяТаблицы);
		К = 1;
		Для Каждого ИДПолучателя Из Результат Цикл
			Если ИДПолучателя <> Объект.ИдентификаторГрузоотправителя
			И ИДПолучателя <> Объект.ИдентификаторГрузополучателя
			И ИДПолучателя <> Объект.ИдентификаторПеревозчика Тогда
				КлючКуда = ДополнительныеПараметры.ИмяТаблицы + "__" + К + "__ИдентификаторИногоПолучателя";
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, КлючКуда, ИДПолучателя);
				К = К + 1;
			КонецЕсли;
		КонецЦикла;	
		Модифицированность = Истина;
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура СсылкаТитулГрузоотправителяГрузополучательПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыПоСсылке(Элемент, ЭтаФорма);
	ЗаполнитьСведенияОПереадресовке();
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнениеСпискаСохраненныхАдресов(ЭтаФорма, 
					Объект.СсылкаТитулГрузоотправителяГрузополучатель,
					Элементы.ПредставлениеТитулГрузоотправителяГрузополучательАдресДоставки,
					Элементы.ПредставлениеТитулГрузоотправителяГрузополучательАдресДоставки.СписокВыбора, Истина);
	
КонецПроцедуры


&НаКлиенте
Процедура ПредставлениеТитулГОПредставлениеАдресДоставкиАвтоПодбор(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка)
	
	ОбменСГИСЭПДКлиент.АвтоПодборАдреса(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнениеСпискаСохраненныхАдресов(ЭтаФорма, 
					Объект.СсылкаТитулГрузоотправителяГрузополучатель,
					Элемент,
					ДанныеВыбора);
	
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеТитулГОПредставлениеАдресДоставкиНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбменСГИСЭПДКлиент.ВводАдреса(Элемент.Имя, ЭтаФорма, Объект.СсылкаТитулГрузоотправителяГрузополучатель);
	
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеТитулГОПредставлениеАдресДоставкиОбработкаВыбора(Элемент, Результат, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыАдреса(ЭтаФорма, Результат, Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеТитулГОПредставлениеАдресДоставкиПриИзменении(Элемент)
	
	Если ПустаяСтрока(ПредставлениеТитулГрузоотправителяГрузополучательАдресДоставки) Тогда
		Элементы.ПредставлениеТитулГрузоотправителяГрузополучательАдресДоставки_Ошибка.Видимость = Ложь;
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеТитулПереадресовкаНовыйГПАдресПриИзменении(Элемент)
	
	Если ПустаяСтрока(ЭтаФорма[Элемент.Имя]) Тогда
		Элементы[Элемент.Имя + "_Ошибка"].Видимость = Ложь;
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеТитулПереадресовкаАдресВыгрузкиПриИзменении(Элемент)
	
	Если ПустаяСтрока(ЭтаФорма[Элемент.Имя]) Тогда
		Элементы[Элемент.Имя + "_Ошибка"].Видимость = Ложь;
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеПредставлениеГрузополучательАдресВыгрузкиПриИзменении(Элемент)
		
	Если ПустаяСтрока(ЭтаФорма[Элемент.Имя]) Тогда
		Элементы[Элемент.Имя + "_Ошибка"].Видимость = Ложь;
	КонецЕсли;
		
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяКодМетодаОпределенияМассыГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяЗаявленныеДатаВремяПрибытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяФактическиеДатаВремяУбытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяФактическиеДатаВремяПрибытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузополучателяПричинаОтказаВПриемеГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаПриемкаЗамечанияДатаВремяПрибытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаПриемкаЗамечанияДатаВремяУбытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаПриемкаЗамечанияДатаВремяПостановкиНаПогрузкуПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаПриемкаЗамечанияВОтношенииФактическогоСостояниеГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаПриемкаЗамечанияВОтношенииМассыГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаПриемкаЗамечанияВОтношенииКоличестваГрузовыхМестПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаПриемкаЗамечанияВОтношенииПроведенияПогрузочныхРаботПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаВыдачаДатаВремяПрибытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаВыдачаДатаВремяУбытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаВыдачаДатаИВремяПостановкиНаВыгрузкуПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаВыдачаЗамечанияВОтношенииФактическогоСостоянияГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаВыдачаЗамечанияВОтношенииПроведенияРаботПоВыгрузкеПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПереадресовкаДатаВремяПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПереадресовкаНовыеДатаВремяПодачиПодВыгрузкуПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура СсылкаТитулГрузоотправителяПеревозчикПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыПоСсылке(Элемент, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ХранимыеДанныеТитулГрузоотправителяТранспортноеСредствоНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ХранимыеДанныеТитулГрузоотправителяТранспортноеСредствоПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ЗначениеРеквизита = ЭтаФорма.ХранимыеДанныеТитулГрузоотправителяТранспортноеСредство;
	ГруппаДанных = СтрЗаменить(Элемент.Имя, "ХранимыеДанные", "");
	Если ЗначениеЗаполнено(ЗначениеРеквизита) Тогда
		ВходящийКонтекст = Новый Структура;
		ВходящийКонтекст.Вставить("ЗапретитьИзменение", Ложь);
		ВходящийКонтекст.Вставить("Форма", ЭтаФорма);
		ВходящийКонтекст.Вставить("ГруппаДанных", ГруппаДанных);
		ОбменСГИСЭПДКлиент.ОткрытиеФормыПоГиперссылке_Завершение(ЗначениеРеквизита, ВходящийКонтекст);	
	Иначе
		ОбменСГИСЭПДКлиентСервер.УдалитьРеквизитыПоГруппеДанных(ЭтаФорма, ГруппаДанных);
		ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеЭлементовФормы(ЭтаФорма, СтрЗаменить(Элемент.Имя, "ХранимыеДанные", ""));	
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ХранимыеДанныеТитулГрузоотправителяТранспортноеСредствоАвтоПодбор(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка)
	
	ГруппаДанных = СтрЗаменить(Элемент.Имя, "ХранимыеДанные", "");
	ПараметрыПолученияДанных.Отбор = ОбменСГИСЭПДКлиент.ПолучитьОтборХранимыхДанных(ЭтаФорма, ЭтаФорма, ГруппаДанных);
	ПараметрыПолученияДанных.СпособПоискаСтроки = ПредопределенноеЗначение("СпособПоискаСтрокиПриВводеПоСтроке.ЛюбаяЧасть");
	
КонецПроцедуры

&НаКлиенте
Процедура ХранимыеДанныеТитулГрузоотправителяТранспортноеСредствоОткрытие(Элемент, СтандартнаяОбработка)
	
	Если ТипЗнч(ХранимыеДанныеТитулГрузоотправителяТранспортноеСредство) <> Тип("СправочникСсылка.ХранимыеДанныеЭПД") Тогда
		СтандартнаяОбработка = Ложь;
		ОбменСГИСЭПДКлиент.ВывестиФормуВводаДанных(ЭтаФорма, Элемент.Имя, , Ложь);
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура ПредставлениеПредставлениеГрузополучательАдресВыгрузкиАвтоПодбор(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка)
	
	Элементы.ПредставлениеТитулГрузополучателяАдресВыгрузки.СписокВыбора.Очистить();
	
	ОбменСГИСЭПДКлиент.АвтоПодборАдреса(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнениеСпискаСохраненныхАдресов(ЭтаФорма, 
					Объект.СсылкаТитулГрузоотправителяГрузополучатель,
					Элемент,
					ДанныеВыбора);
					
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеПредставлениеГрузополучательАдресВыгрузкиНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбменСГИСЭПДКлиент.ВводАдреса(Элемент.Имя, ЭтаФорма, Объект.СсылкаТитулГрузоотправителяГрузополучатель);
	
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеПредставлениеГрузополучательАдресВыгрузкиОбработкаВыбора(Элемент, Результат, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыАдреса(ЭтаФорма, Результат, Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура СсылкаТитулПереадресовкаНовыйГрузополучательПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыПоСсылке(Элемент, ЭтаФорма);
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьПредставлениеАдреса("ПредставлениеТитулПереадресовкаНовыйГрузополучательАдрес", ЭтаФорма);
	
	ИзмененСоставУчастников = Истина;
	
	ЗначениеОтбора = ?(ЗначениеЗаполнено(Объект.СсылкаТитулПереадресовкаНовыйГрузополучатель), 
						Объект.СсылкаТитулПереадресовкаНовыйГрузополучатель, Объект.СсылкаТитулГрузоотправителяГрузополучатель);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнениеСпискаСохраненныхАдресов(ЭтаФорма, 
					ЗначениеОтбора,
					Элементы.ПредставлениеТитулПереадресовкаАдресВыгрузки,
					Элементы.ПредставлениеТитулПереадресовкаАдресВыгрузки.СписокВыбора, Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулПереадресовкаОснованиеНаименованиеПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПереадресовкаОснованиеНомерПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПереадресовкаОснованиеДатаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПереадресовкаОснованиеДополнительныеСведенияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры





&НаКлиенте
Процедура СсылкаДопТитулПереадресовкаНовыйГрузополучательПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыПоСсылке(Элемент, ЭтаФорма);
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьПредставлениеАдреса("ПредставлениеДопТитулПереадресовкаНовыйГрузополучательАдрес", ЭтаФорма);
	
	ИзмененСоставУчастников = Истина;
	
	ЗначениеОтбора = ?(ЗначениеЗаполнено(Объект.СсылкаДопТитулПереадресовкаНовыйГрузополучатель), 
						Объект.СсылкаДопТитулПереадресовкаНовыйГрузополучатель, Объект.СсылкаДопТитулГрузоотправителяГрузополучатель);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнениеСпискаСохраненныхАдресов(ЭтаФорма, 
					ЗначениеОтбора,
					Элементы.ПредставлениеДопТитулПереадресовкаАдресВыгрузки,
					Элементы.ПредставлениеДопТитулПереадресовкаАдресВыгрузки.СписокВыбора, Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПереадресовкаОснованиеНаименованиеПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПереадресовкаОснованиеНомерПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПереадресовкаОснованиеДатаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПереадресовкаОснованиеДополнительныеСведенияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры





&НаКлиенте
Процедура ПредставлениеТитулПереадресовкаНовыйГПАдресАвтоПодбор(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка)
	
	ОбменСГИСЭПДКлиент.АвтоПодборАдреса(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка);
	
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеТитулПереадресовкаНовыйГПАдресНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ТекущийГрузополучатель = ТекущийГрузополучатель(Объект);
	ОбменСГИСЭПДКлиент.ВводАдреса(Элемент.Имя, ЭтаФорма, ТекущийГрузополучатель);
	
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеТитулПереадресовкаНовыйГПАдресОбработкаВыбора(Элемент, Результат, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыАдреса(ЭтаФорма, Результат, Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеТитулПереадресовкаАдресВыгрузкиАвтоПодбор(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка)
	
	Элементы.ПредставлениеТитулПереадресовкаАдресВыгрузки.СписокВыбора.Очистить();
	
	ОбменСГИСЭПДКлиент.АвтоПодборАдреса(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка);
	
	ТекущийГрузополучатель = ТекущийГрузополучатель(Объект);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнениеСпискаСохраненныхАдресов(ЭтаФорма, 
					ТекущийГрузополучатель,
					Элемент,
					ДанныеВыбора);
	
КонецПроцедуры

&НаКлиенте
Процедура ВариантПереадресовкиПриИзменении(Элемент)
	
	Если ВариантПереадресовки = 0 Тогда
		Если СтрЗаканчиваетсяНа(Элемент.Имя, "Доп") Тогда
			Если ЗначениеЗаполнено(Объект.СсылкаДопТитулПереадресовкаНовыйГрузополучатель) Тогда
				ТипЗначения = ТипЗнч(Объект.СсылкаДопТитулПереадресовкаНовыйГрузополучатель);
				Если ТипЗначения <> Неопределено Тогда
					Объект.СсылкаДопТитулПереадресовкаНовыйГрузополучатель = Новый(ТипЗначения);
					СсылкаТитулПереадресовкаНовыйГрузополучательПриИзменении(Элементы.СсылкаДопТитулПереадресовкаНовыйГрузополучатель);	
				КонецЕсли;
			КонецЕсли;
		Иначе
			Если ЗначениеЗаполнено(Объект.СсылкаТитулПереадресовкаНовыйГрузополучатель) Тогда
				ТипЗначения = ТипЗнч(Объект.СсылкаТитулПереадресовкаНовыйГрузополучатель);
				Если ТипЗначения <> Неопределено Тогда
					Объект.СсылкаТитулПереадресовкаНовыйГрузополучатель = Новый(ТипЗначения);
					СсылкаТитулПереадресовкаНовыйГрузополучательПриИзменении(Элементы.СсылкаТитулПереадресовкаНовыйГрузополучатель);
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;	
	КонецЕсли;
	
	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма, Элемент.Имя);	

КонецПроцедуры


&НаКлиенте
Процедура ПредставлениеТитулПереадресовкаАдресВыгрузкиНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ТекущийГрузополучатель = ТекущийГрузополучатель(Объект);
	ОбменСГИСЭПДКлиент.ВводАдреса(Элемент.Имя, ЭтаФорма, ТекущийГрузополучатель);
	
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеТитулПереадресовкаАдресВыгрузкиОбработкаВыбора(Элемент, Результат, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыАдреса(ЭтаФорма, Результат, Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура СсылкаТитулПеревозчикаФХЖВалютаСтоимостиПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыПоСсылке(Элемент, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаФХЖСтоимостьПеревозкиБезНалогаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры


&НаКлиенте
Процедура СсылкаТитулГрузоотправителяФХЖБанковскиеРеквизитыПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ЗаполнитьРеквизитыПоСсылке(Элемент, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузоотправителяФХЖГрузоотправительОКПОПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузоотправителяФХЖГрузоотправительКраткоеНаименованиеПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузоотправителяФХЖГрузоотправительСтруктурноеПодразделениеПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПереадресовкаДатаВремяПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПереадресовкаНовыеДатаВремяПодачиПодВыгрузкуПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура НавигацияКартинкаОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага(НавигационнаяСсылкаФорматированнойСтроки, НавигационнаяСсылкаФорматированнойСтроки);
	
КонецПроцедуры


&НаКлиенте
Процедура НавигацияКартинкаДопОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага(НавигационнаяСсылкаФорматированнойСтроки, НавигационнаяСсылкаФорматированнойСтроки);
	
КонецПроцедуры


&НаКлиенте
Процедура Шаг1ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг1", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры


&НаКлиенте
Процедура Шаг2ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг2", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

&НаКлиенте
Процедура Шаг3ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг3", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

&НаКлиенте
Процедура Шаг4ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг4", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

&НаКлиенте
Процедура Шаг5ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг5", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

&НаКлиенте
Процедура Шаг6ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг6", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

&НаКлиенте
Процедура Шаг7ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг7", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

&НаКлиенте
Процедура Шаг8ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг8", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

&НаКлиенте
Процедура Шаг11ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг11", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

&НаСервере
Функция ПодменитьСтраницуДляТестированияФормы(ОтображаемаяСтраница)
	
	Возврат ОтображаемаяСтраница;
	
КонецФункции

&НаСервере
Процедура СохранитьТекущийШагПомощника()
	
	Если ТолькоПросмотр ИЛИ НЕ ЗначениеЗаполнено(Объект.Ссылка) Тогда
		Возврат;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьСтраницыНачало(ОтмечатьТекущий = Истина)

	Если ОтмечатьТекущий = Истина Тогда
		УстановитьВидимостьСтраницы(Элементы.СтраницаСодИнфГО);
	КонецЕсли;
	
	РазместитьНавигацию("ТитулГрузоотправителя", ОтмечатьТекущий);
	
	СохранитьТекущийШагПомощника();

КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьСтраницыТитулПеревозчика()

	УстановитьВидимостьСтраницы(Элементы.СтраницаСодИнфПрвПрием);
	
	РазместитьНавигацию("ТитулПеревозчикаПриемка");
	
	СохранитьТекущийШагПомощника();

КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьСтраницыТитулГрузополучателя()

	УстановитьВидимостьСтраницы(Элементы.СтраницаСодИнфГП);
	
	РазместитьНавигацию("ТитулГрузополучателя");
	
	СохранитьТекущийШагПомощника();
	

КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьСтраницыТитулГрузополучателяДоп()

	УстановитьВидимостьСтраницы(Элементы.СтраницаДопСодИнфГП);
	
	РазместитьНавигациюДоп("ДопТитулГрузополучателя");
	
	СохранитьТекущийШагПомощника();
	

КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьСтраницыТитулПеревозчикаПриРазгрузке()

	УстановитьВидимостьСтраницы(Элементы.СтраницаСодПрвВыд);
	
	РазместитьНавигацию("ТитулПеревозчикаВыдача");
	
	СохранитьТекущийШагПомощника();

КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьСтраницыТитулПеревозчикаПриРазгрузкеДоп()

	УстановитьВидимостьСтраницы(Элементы.СтраницаДопСодПрвВыд);
	
	РазместитьНавигациюДоп("ДопТитулПеревозчикаВыдача");
	
	СохранитьТекущийШагПомощника();

КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьСтраницыТитулПлательщик()

	УстановитьВидимостьСтраницы(Элементы.СтраницаСодФХЖ2);
	
	РазместитьНавигацию("ТитулГрузоотправителяФХЖ");
	
	СохранитьТекущийШагПомощника();

КонецПроцедуры


&НаСервере
Функция ИмяПомощника()

	Возврат "ЭлектроннаяТранспортнаяНакладная";

КонецФункции

&НаСервере
Функция ИмяПомощникаДоп()

	Возврат "ЭлектроннаяТранспортнаяНакладнаяДоп";

КонецФункции

&НаКлиентеНаСервереБезКонтекста
Функция СтатусПереадресовкиДоп(Форма)
	
	Если ЗначениеЗаполнено(Форма.Объект.ДопТитулПереадресовкаИдентификаторФайла) Тогда
		Возврат 2;
	ИначеЕсли Форма.ВводимДопТитулПереадресовки Тогда
		Возврат 1;
	КонецЕсли;
	
	Возврат 0; 
	
КонецФункции

&НаКлиентеНаСервереБезКонтекста
Функция СтатусЗамены(Форма)
	
	Если ЗначениеЗаполнено(Форма.Объект.ТитулПеревозчикаЗаменыИдентификаторФайла) Тогда
		Возврат 2;
	ИначеЕсли Форма.ВводимТитулКорректировкиЭстафета Тогда
		Возврат 1;
	КонецЕсли;
	
	Возврат 0;
	
КонецФункции


&НаКлиентеНаСервереБезКонтекста
Функция ПереадресовкаДоЗамены(Форма)
	
	НомерШагаАДР = 3;
	НомерШагаЗАМ = 4;
	Если СтатусПереадресовки(Форма) > 0 И СтатусЗамены(Форма) > 0 Тогда
		Если ЗначениеЗаполнено(Форма.Объект.ТитулПеревозчикаЗаменыДатаФормированияФайла) 
			И ЗначениеЗаполнено(Форма.Объект.ТитулПереадресовкаДатаФормированияФайла) = Ложь Тогда
			НомерШагаАДР = 4;
			НомерШагаЗАМ = 3;
		ИначеЕсли ЗначениеЗаполнено(Форма.Объект.ТитулПеревозчикаЗаменыДатаФормированияФайла) 
			И ЗначениеЗаполнено(Форма.Объект.ТитулПереадресовкаДатаФормированияФайла) Тогда		
			ДатаВремяПереадресовки = Форма.Объект.ТитулПереадресовкаДатаФормированияФайла 
										+ 60 * 60 * Час(Форма.Объект.ТитулПереадресовкаВремяФормированияФайла)
										+ 60 * Минута(Форма.Объект.ТитулПереадресовкаВремяФормированияФайла)
										+ Секунда(Форма.Объект.ТитулПереадресовкаВремяФормированияФайла);
			ДатаВремяЗамены = Форма.Объект.ТитулПеревозчикаЗаменыДатаФормированияФайла 
										+ 60 * 60 * Час(Форма.Объект.ТитулПеревозчикаЗаменыВремяФормированияФайла)
										+ 60 * Минута(Форма.Объект.ТитулПеревозчикаЗаменыВремяФормированияФайла)
										+ Секунда(Форма.Объект.ТитулПеревозчикаЗаменыВремяФормированияФайла);
			Если ДатаВремяПереадресовки > ДатаВремяЗамены Тогда
				НомерШагаАДР = 4;	
				НомерШагаЗАМ = 3;
			КонецЕсли;
		КонецЕсли;
	ИначеЕсли СтатусПереадресовки(Форма) = 0 И СтатусЗамены(Форма) > 0 Тогда
		НомерШагаАДР = 4;
		НомерШагаЗАМ = 3;
	КонецЕсли; 
	
	Возврат НомерШагаАДР < НомерШагаЗАМ;
	
КонецФункции

&НаКлиентеНаСервереБезКонтекста
Функция СтатусЗаменыДоп(Форма)
	
	Если ЗначениеЗаполнено(Форма.Объект.ДопТитулПеревозчикаЗаменыИдентификаторФайла) Тогда
		Возврат 2;
	ИначеЕсли Форма.ВводимДопТитулКорректировкиЭстафета Тогда
		Возврат 1;
	КонецЕсли;
	
	Возврат 0;
	
КонецФункции

&НаКлиентеНаСервереБезКонтекста
Функция СтатусКорректировкиСтоимости(Форма)
	
	Если ЗначениеЗаполнено(Форма.Объект.ТитулПеревозчикаФХЖИдентификаторФайла) Тогда
		Возврат 2;
	ИначеЕсли Форма.ВводимТитулКорректировкиСтоимости Тогда
		Возврат 1;
	КонецЕсли;
	
	Возврат 0; 
	
КонецФункции

&НаСервере
Функция ОтображаемаяВерсияТитула(СтрокиВерсий, ТитулСтрока)
	
	Если ОтображаемыеВерсииТитулов = Неопределено Тогда
		ОтображаемыеВерсииТитулов = Новый Структура;
		КоличествоВерсий = Макс(СтрокиВерсий.Количество() - 1, 0);
		ОтображаемыеВерсииТитулов.Вставить(ТитулСтрока, КоличествоВерсий);
		Возврат КоличествоВерсий;
	КонецЕсли;
	
	ТекущееЗначениеВерсии = Неопределено;
	ОтображаемыеВерсииТитулов.Свойство(ТитулСтрока, ТекущееЗначениеВерсии);
	
	Если ТекущееЗначениеВерсии = Неопределено Тогда
		КоличествоВерсий = Макс(СтрокиВерсий.Количество() - 1, 0);
		ОтображаемыеВерсииТитулов.Вставить(ТитулСтрока, КоличествоВерсий);
		Возврат КоличествоВерсий;
	Иначе
		Возврат ТекущееЗначениеВерсии;		
	КонецЕсли;
	
КонецФункции

// КонецОбласти


&НаКлиенте
Процедура ТитулГрузоотправителяЭкспедиторПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма, Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулГрузоотправителяОтправлятьQRПриИзменении(Элемент)
	
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОтображениеОтправкиQR();
	
КонецПроцедуры


&НаКлиенте
Процедура ВариантПриемкиПриИзменении(Элемент)

	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма, Элемент.Имя);
	
	КонтейнерОтображаемойВерсии = Неопределено;
	Если ВариантПриемки = 2 Тогда
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
			ЭтаФорма, "ТитулГрузополучателяСодержаниеОперацииПриемГруза", Неопределено, , КонтейнерОтображаемойВерсии);
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
			ЭтаФорма, "ТитулГрузополучателяСодержаниеОперацииОтказВПриемеГруза", 
			"Лицом, управомоченным на получение груза, при указанных обстоятельствах отказано в принятии от перевозчика груза с указанными характеристиками", , КонтейнерОтображаемойВерсии);		
	Иначе
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
			ЭтаФорма, "ТитулГрузополучателяСодержаниеОперацииОтказВПриемеГруза", Неопределено, , КонтейнерОтображаемойВерсии);
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
			ЭтаФорма, "ТитулГрузополучателяСодержаниеОперацииПриемГруза", 
			"Лицом, управомоченным на получение груза, при указанных обстоятельствах принят от перевозчика груз с указанными характеристиками", , КонтейнерОтображаемойВерсии);
	КонецЕсли;
	
	ИзменитьОформлениеКнопок(Новый ФиксированнаяСтруктура("ИмяКнопки, ИдентификаторСтроки"));

	
КонецПроцедуры

&НаКлиенте
Процедура ВариантПриемкиДопПриИзменении(Элемент)
	
	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма, Элемент.Имя);
	
	КонтейнерОтображаемойВерсии = Неопределено;
	Если ВариантПриемкиДоп = 2 Тогда
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
			ЭтаФорма, "ДопТитулГрузополучателяСодержаниеОперацииПриемГруза", Неопределено, , КонтейнерОтображаемойВерсии);
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
			ЭтаФорма, "ДопТитулГрузополучателяСодержаниеОперацииОтказВПриемеГруза", 
			"Лицом, управомоченным на получение груза, при указанных обстоятельствах отказано в принятии от перевозчика груза с указанными характеристиками", , КонтейнерОтображаемойВерсии);		
	Иначе
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
			ЭтаФорма, "ДопТитулГрузополучателяСодержаниеОперацииОтказВПриемеГруза", Неопределено, , КонтейнерОтображаемойВерсии);
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
			ЭтаФорма, "ДопТитулГрузополучателяСодержаниеОперацииПриемГруза", 
			"Лицом, управомоченным на получение груза, при указанных обстоятельствах принят от перевозчика груз с указанными характеристиками", , КонтейнерОтображаемойВерсии);
	КонецЕсли;
	
	ИзменитьОформлениеКнопок(Новый ФиксированнаяСтруктура("ИмяКнопки, ИдентификаторСтроки"));
	
КонецПроцедуры

&НаКлиенте
Процедура ВариантПогрузкиПриИзменении(Элемент)
	
	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма, Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ВариантВыгрузкиПриИзменении(Элемент)
	
	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма, Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаФХЖНалоговаяСтавкаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма, Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаФХЖСуммаНДСПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаФХЖСтоимостьПеревозкиСНалогомПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаФХЖПорядокМеханизмРасчетаПлатыПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры




&НаКлиенте
Процедура ТитулПеревозчикаЗаменыСодержаниеОперацииПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);
	
	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма, Элемент.Имя);
	
	КонтейнерОтображаемойВерсии = Неопределено;
	Если СтрНайти(ТитулПеревозчикаЗаменыСодержаниеОперации, "водител") = 0 Тогда
		ОбменСГИСЭПДКлиентСервер.УдалитьСтрокиТаблицыИзСтруктурыФормы(ЭтаФорма, 
			"ТитулПеревозчикаЗаменыЗаменыВодителей", , КонтейнерОтображаемойВерсии);	
	ИначеЕсли СтрНайти(ТитулПеревозчикаЗаменыСодержаниеОперации, "водителя") > 0 Тогда
		ОбменСГИСЭПДКлиентСервер.УдалитьСтрокиТаблицыИзСтруктурыФормы(ЭтаФорма, 
			"ТитулПеревозчикаЗаменыЗаменыВодителей", 1, КонтейнерОтображаемойВерсии, Истина);
	КонецЕсли;
	
	Если СтрНайти(ТитулПеревозчикаЗаменыСодержаниеОперации, "транспорт") = 0 Тогда
		ОбменСГИСЭПДКлиентСервер.УдалитьСтрокиТаблицыИзСтруктурыФормы(ЭтаФорма, 
			"ТитулПеревозчикаЗаменыТранспортныеСредства", , КонтейнерОтображаемойВерсии);	
	ИначеЕсли СтрНайти(ТитулПеревозчикаЗаменыСодержаниеОперации, "транспортного средства") > 0 Тогда
		ОбменСГИСЭПДКлиентСервер.УдалитьСтрокиТаблицыИзСтруктурыФормы(ЭтаФорма, 
			"ТитулПеревозчикаЗаменыТранспортныеСредства", 1, КонтейнерОтображаемойВерсии, Истина);
	КонецЕсли;
	
	ИзменитьОформлениеКнопок(Новый ФиксированнаяСтруктура("ИмяКнопки, ИдентификаторСтроки"));
	
КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяПричинаОтказаВПриемеГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяФактическиеДатаВремяПрибытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяФактическиеДатаВремяУбытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяЗаявленныеДатаВремяПрибытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяКодМетодаОпределенияМассыГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяОбщееКоличествоПринятыхГрузовыхМестПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяФактическоеСостояниеГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяМассаБруттоПринятогоГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяМассаНеттоПринятогоГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулГрузополучателяОбъемГрузовыхМестПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПеревозчикаВыдачаДатаВремяПрибытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПеревозчикаВыдачаДатаВремяУбытияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПеревозчикаВыдачаДатаИВремяПостановкиНаВыгрузкуПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПеревозчикаВыдачаЗамечанияВОтношенииФактическогоСостоянияГрузаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПеревозчикаВыдачаЗамечанияВОтношенииПроведенияРаботПоВыгрузкеПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры
















&НаКлиенте
Процедура ДопТитулПеревозчикаЗаменыДатаВремяЗаменыПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПеревозчикаЗаменыПричинаЗаменыПроизвольныйТекстПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПеревозчикаЗаменыДокументНаименованиеПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПеревозчикаЗаменыДокументНомерПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПеревозчикаЗаменыДокументДатаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ДопТитулПеревозчикаЗаменыДокументДополнительныеСведенияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры







&НаКлиенте
Процедура ТитулПеревозчикаЗаменыДатаВремяЗаменыПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаЗаменыПричинаЗаменыПроизвольныйТекстПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаЗаменыДокументНаименованиеПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаЗаменыДокументНомерПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаЗаменыДокументДатаПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры

&НаКлиенте
Процедура ТитулПеревозчикаЗаменыДокументДополнительныеСведенияПриИзменении(Элемент)
		
	ПриИзмененииДанныхНаФорме(Элемент.Имя);

КонецПроцедуры







&НаКлиенте
Процедура ВариантПричиныЗаменыПриИзменении(Элемент)
	
	ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма, Элемент.Имя);
	
КонецПроцедуры

&НаКлиенте
Процедура ДокументыОснования(Команда)
	
	ПараметрыФормы = Новый Структура;
	
	МассивДокументов = Новый Массив;
	Для Каждого СтрТаб Из Объект.ДокументыОснования Цикл
		МассивДокументов.Добавить(СтрТаб.ДокументОснование);	
	КонецЦикла;
	
	ПараметрыФормы.Вставить("МассивДокументов", МассивДокументов);
	ПараметрыФормы.Вставить("ТолькоПросмотр", Объект.ТекущийТитул <> ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул1"));
	
	Результат = ОткрытьФормуМодально("Документ.ЭлектроннаяТранспортнаяНакладная.Форма.ДокументыОснования", ПараметрыФормы, ЭтаФорма);
	ДокументыОснование_Закрытие(Результат, ПараметрыФормы);
					
КонецПроцедуры

&НаКлиенте
Процедура ДокументыОснование_Закрытие(Результат, ДополнительныеПараметры) Экспорт
	
	Если ТипЗнч(Результат) = Тип("Массив") Тогда
		Объект.ДокументыОснования.Очистить();
		Для Каждого Документ Из Результат Цикл
			НовСтр = Объект.ДокументыОснования.Добавить();	
			НовСтр.ДокументОснование = Документ;	
		КонецЦикла;	
		Модифицированность = Истина;
		ОбменСГИСЭПДКлиентПереопределяемый.ОбработкаЗаполненияНаФормеЭТрН(ЭтаФорма, Результат);
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Функция ИдентификаторОтправителя()
	
	ТипОрганизация = ОбменСГИСЭПДВызовСервера.ПолучитьТипОрганизация();
	Если Объект.ЭтоВходящий = Истина Тогда
		Если ТипЗнч(Объект.СсылкаТитулГрузоотправителяПеревозчик) = ТипОрганизация Тогда
			Результат = Объект.ИдентификаторПеревозчика;
		Иначе
			Результат = Объект.ИдентификаторГрузополучателя;
		КонецЕсли;
	Иначе
		Результат = Объект.ИдентификаторГрузоотправителя;
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции


&НаКлиенте
Процедура ЗаполнитьУчастников(ЭтоНастройкаПередОтправкой = Ложь)
	
	КлючНастроекОтправки = ОбменСГИСЭПДКлиентСервер.НовыйКлючНастроекОтправки();
	КлючНастроекОтправки.СсылкаНаДокумент = Объект.Ссылка;
	КлючНастроекОтправки.ВидДокумента = Объект.ВидДокумента;
	
	КлючНастроекОтправкиСледующий = ОбменСГИСЭПДКлиентСервер.НовыйКлючНастроекОтправки();
	КлючНастроекОтправки.СсылкаНаДокумент = Объект.Ссылка;
	КлючНастроекОтправкиСледующий.ВидДокумента = Объект.ВидДокумента;
	
	СсылкаГрузополучатель = ТекущийГрузополучатель(Объект);
	
	Если ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяСоставитель) Тогда
		СоставительПервогоТитула = Объект.СсылкаТитулГрузоотправителяСоставитель;
	Иначе
		СоставительПервогоТитула = Объект.СсылкаТитулГрузоотправителяГрузоотправитель;	
	КонецЕсли;

	ТипОрганизация = ОбменСГИСЭПДВызовСервера.ПолучитьТипОрганизация();
	Если Объект.ЭтоВходящий = Истина Тогда
		Если ТипЗнч(Объект.СсылкаТитулГрузоотправителяПеревозчик) = ТипОрганизация Тогда
			КлючНастроекОтправки.Отправитель = Объект.СсылкаТитулГрузоотправителяПеревозчик;
			КлючНастроекОтправки.Получатель = СоставительПервогоТитула;
			КлючНастроекОтправкиСледующий.Отправитель = Объект.СсылкаТитулГрузоотправителяПеревозчик;
			КлючНастроекОтправкиСледующий.Получатель = СсылкаГрузополучатель;
		Иначе
			КлючНастроекОтправки.Отправитель = СсылкаГрузополучатель;
			КлючНастроекОтправки.Получатель = Объект.СсылкаТитулГрузоотправителяПеревозчик;
			КлючНастроекОтправкиСледующий.Отправитель = СсылкаГрузополучатель;
			КлючНастроекОтправкиСледующий.Получатель = СоставительПервогоТитула;
		КонецЕсли;
	Иначе
		КлючНастроекОтправки.Отправитель = СоставительПервогоТитула;
		КлючНастроекОтправки.Получатель = Объект.СсылкаТитулГрузоотправителяПеревозчик; 
		КлючНастроекОтправкиСледующий.Отправитель = СоставительПервогоТитула;
		КлючНастроекОтправкиСледующий.Получатель = СсылкаГрузополучатель;
	КонецЕсли;
	
	НастройкиОтправки = ОбменСГИСЭПДВызовСервера.НастройкиОтправки(КлючНастроекОтправки);
	
	//ПараметрыНастройкиОбменаСКонтрагентом = НастройкиЭДОКлиент.НовыеПараметрыНастройкиОбменаСКонтрагентом();
	//ПараметрыНастройкиОбменаСКонтрагентом.НастройкаОдногоДокумента = Истина;
	
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("КлючНастроекОтправки", КлючНастроекОтправки);
	Если СоставительПервогоТитула <> СсылкаГрузополучатель Тогда
		ДополнительныеПараметры.Вставить("КлючНастроекОтправкиСледующий", КлючНастроекОтправкиСледующий);
	КонецЕсли;
	//ДополнительныеПараметры.Вставить("ПараметрыНастройкиОбменаСКонтрагентом", ПараметрыНастройкиОбменаСКонтрагентом);
	ДополнительныеПараметры.Вставить("ПараметрыЗаписи", Новый Структура);
	ДополнительныеПараметры.Вставить("ИдентификаторОтправителя", ИдентификаторОтправителя());
	ДополнительныеПараметры.Вставить("ЭтоНастройкаПередОтправкой", ЭтоНастройкаПередОтправкой);
	
	ОповещениеОкончаниеНастройки = Новый ОписаниеОповещения("ЗаполнитьУчастников_ПослеНастроек", ЭтаФорма, ДополнительныеПараметры);
	Если НастройкиОтправки = Неопределено И ЭтоНастройкаПередОтправкой = Истина Тогда	
		ЭлектронныеДокументыКлиент.ОбработкаНавигационнойСсылкиВФормеОбъектаИБ(Объект.Ссылка);
	Иначе
		ВыполнитьОбработкуОповещения(ОповещениеОкончаниеНастройки, НастройкиОтправки); 
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ГрузоотправительЯвляетсяГрузополучателемПриИзменении(Элемент)
	
	Элементы.СсылкаТитулГрузоотправителяГрузополучатель.Доступность = Не ГрузоотправительЯвляетсяГрузополучателем;
	Если ГрузоотправительЯвляетсяГрузополучателем И ВариантПоДоверенности = 0 Тогда
		ОграничениеТипаГрузополучателя = ОбменСГИСЭПДКлиентСервер.ПолучитьТипОрганизация();				
	Иначе
		ОграничениеТипаГрузополучателя = ОбменСГИСЭПДКлиентСервер.ПолучитьТипКонтрагент();	
	КонецЕсли;
	
	МассивТипов = Новый Массив;
	МассивТипов.Добавить(ОграничениеТипаГрузополучателя);
	Элементы.СсылкаТитулГрузоотправителяГрузополучатель.ОграничениеТипа = Новый ОписаниеТипов(МассивТипов);
	
	Если ГрузоотправительЯвляетсяГрузополучателем Тогда
		Объект.СсылкаТитулГрузоотправителяГрузополучатель = Объект.СсылкаТитулГрузоотправителяГрузоотправитель;	
		СсылкаТитулГрузоотправителяГрузополучательПриИзменении(Элементы.СсылкаТитулГрузоотправителяГрузополучатель);
	Иначе
		Объект.СсылкаТитулГрузоотправителяГрузополучатель = Неопределено;	
	КонецЕсли;

КонецПроцедуры


&НаКлиентеНаСервереБезКонтекста
Функция ТекущийГрузополучатель(Объект)
	
	Если ЗначениеЗаполнено(Объект.СсылкаДопТитулПереадресовкаНовыйГрузополучатель)
		И ТипЗнч(Объект.СсылкаДопТитулПереадресовкаНовыйГрузополучатель) <> Тип("СправочникСсылка.СтроковыеЗначенияЭПД") Тогда
		СсылкаГрузополучатель = Объект.СсылкаДопТитулПереадресовкаНовыйГрузополучатель;
	ИначеЕсли ЗначениеЗаполнено(Объект.СсылкаТитулПереадресовкаНовыйГрузополучатель)
		И ТипЗнч(Объект.СсылкаТитулПереадресовкаНовыйГрузополучатель) <> Тип("СправочникСсылка.СтроковыеЗначенияЭПД") Тогда
		СсылкаГрузополучатель = Объект.СсылкаТитулПереадресовкаНовыйГрузополучатель;
	Иначе
		СсылкаГрузополучатель = Объект.СсылкаТитулГрузоотправителяГрузополучатель;
	КонецЕсли;
	
	Возврат СсылкаГрузополучатель;
	
КонецФункции

&НаКлиенте
Процедура ЗаполнитьУчастников_ПослеНастроек(Настройка, ДополнительныеПараметры) Экспорт
	
	Если Настройка = Неопределено Тогда
		ЭтаФорма.Доступность = Истина;
		Возврат;
	КонецЕсли;
	
	ТекущийГрузополучатель = ТекущийГрузополучатель(Объект);
	
	Если ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяСоставитель) Тогда
		СоставительПервогоТитула = Объект.СсылкаТитулГрузоотправителяСоставитель;
	Иначе
		СоставительПервогоТитула = Объект.СсылкаТитулГрузоотправителяГрузоотправитель;	
	КонецЕсли;
	
	Если Настройка.Отправитель = СоставительПервогоТитула Тогда
		Объект.ИдентификаторГрузоотправителя = Настройка.ИдентификаторОтправителя;
	КонецЕсли;
	
	Если Настройка.Отправитель = Объект.СсылкаТитулГрузоотправителяПеревозчик Тогда
		Объект.ИдентификаторПеревозчика = Настройка.ИдентификаторОтправителя;
	КонецЕсли;
	
	Если Настройка.Отправитель = ТекущийГрузополучатель Тогда
		Если Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул7")
			И Объект.ИдентификаторГрузополучателя <> Настройка.ИдентификаторОтправителя Тогда
				КлючКуда = "ТитулПереадресовкаИдентификаторыИныхПолучателейФайла__1__ИдентификаторИногоПолучателя"; 
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, КлючКуда, Настройка.ИдентификаторОтправителя);
		Иначе
			Объект.ИдентификаторГрузополучателя = Настройка.ИдентификаторОтправителя;
		КонецЕсли;
	КонецЕсли;
	
	Если Настройка.Получатель = СоставительПервогоТитула Тогда
		Объект.ИдентификаторГрузоотправителя = Настройка.ИдентификаторПолучателя;
	КонецЕсли;
	
	Если Настройка.Получатель = Объект.СсылкаТитулГрузоотправителяПеревозчик Тогда
		Объект.ИдентификаторПеревозчика = Настройка.ИдентификаторПолучателя;
	КонецЕсли;
	
	Если Настройка.Получатель = ТекущийГрузополучатель Тогда
		Если Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул7")
			И Объект.ИдентификаторГрузополучателя <> Настройка.ИдентификаторПолучателя Тогда
				КлючКуда = "ТитулПереадресовкаИдентификаторыИныхПолучателейФайла__1__ИдентификаторИногоПолучателя"; 
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма, КлючКуда, Настройка.ИдентификаторПолучателя);
		Иначе
			Объект.ИдентификаторГрузополучателя = Настройка.ИдентификаторПолучателя;
		КонецЕсли;
	КонецЕсли;	
	
	ЭтоНастройкаПередОтправкой = Неопределено;
	ДополнительныеПараметры.Свойство("ЭтоНастройкаПередОтправкой", ЭтоНастройкаПередОтправкой);
	Если ДополнительныеПараметры <> Неопределено И ДополнительныеПараметры.Свойство("КлючНастроекОтправкиСледующий") = Истина Тогда
		ДополнительныеПараметрыСледующий = Новый Структура;
		Для Каждого КиЗ Из ДополнительныеПараметры Цикл
			Если КиЗ.Ключ <> "КлючНастроекОтправкиСледующий" Тогда
				ДополнительныеПараметрыСледующий.Вставить(КиЗ.Ключ, КиЗ.Значение);	
			КонецЕсли;	
		КонецЦикла;
		ОповещениеОкончаниеНастройки = Новый ОписаниеОповещения("ЗаполнитьУчастников_ПослеНастроек", ЭтаФорма, ДополнительныеПараметрыСледующий);
		
		НастройкиОтправкиСледующий = ОбменСГИСЭПДВызовСервера.НастройкиОтправки(ДополнительныеПараметры.КлючНастроекОтправкиСледующий);
		Если НастройкиОтправкиСледующий = Неопределено И ЭтоНастройкаПередОтправкой = Истина Тогда
			//НастройкиЭДОКлиент.НастроитьОбменСКонтрагентом(ДополнительныеПараметры.КлючНастроекОтправкиСледующий, 
			//													ОповещениеОкончаниеНастройки, 
			//													ДополнительныеПараметры.ПараметрыНастройкиОбменаСКонтрагентом);
			ЭлектронныеДокументыКлиент.ОбработкаНавигационнойСсылкиВФормеОбъектаИБ(Объект.Ссылка);
		Иначе
			ВыполнитьОбработкуОповещения(ОповещениеОкончаниеНастройки, НастройкиОтправкиСледующий);	
		КонецЕсли;
		Возврат;
	КонецЕсли;
																		
	ИзмененСоставУчастников = Ложь;
	
	Если ЭтоНастройкаПередОтправкой = Истина
		И ЗначениеЗаполнено(Объект.ИдентификаторГрузоотправителя)
		И ЗначениеЗаполнено(Объект.ИдентификаторГрузополучателя)
		И ЗначениеЗаполнено(Объект.ИдентификаторПеревозчика) Тогда
			ОтправитьЧерезЭДОПослеЗаписи();
	Иначе
		ЭтаФорма.Доступность = Истина;
		ПараметрыЗаписи = Новый Структура;
		ПараметрыЗаписи.Вставить("НеТребуетсяИдентификацияФайла");
		Записать(ПараметрыЗаписи);
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьИмяФайла(Шаблон, ИдГрузоотправителя, ИдГрузополучателя, ИдПеревозчика, НаличиеДругихПолучателей = Ложь)
	
	ТекущаяДатаСеанса = ТекущаяДатаСеанса();
	
	Результат = Шаблон;
	Результат = СтрЗаменить(Результат, "ИдГО", ИдГрузоотправителя);
	Результат = СтрЗаменить(Результат, "ИдПЕР", ИдПеревозчика);
	Результат = СтрЗаменить(Результат, "ИдГП", ИдГрузополучателя);
	Результат = СтрЗаменить(Результат, "GGGGMMDD", Формат(ТекущаяДатаСеанса, "ДФ=ггггММдд"));
	Результат = СтрЗаменить(Результат, "ГУИДФайла", Строка(Новый УникальныйИдентификатор()));
	Результат = СтрЗаменить(Результат, "НалДр", ?(НаличиеДругихПолучателей = Истина, "1", "0"));
	
	Возврат Результат;
	
КонецФункции

&НаСервере
Функция УстановитьНомерДокумента()
	
	ДокументОбъект = РеквизитФормыВЗначение("Объект");
	ДокументОбъект.УстановитьНовыйНомер();
	
	Возврат ДокументОбъект.Номер;
	
КонецФункции

&НаКлиенте
Процедура ЗаполнитьИдентификациюФайлаОбмена(ИнформацияПоПрефиксамТитула, ИдентификаторОтправителя, Переформировать = Ложь, ОбработкаЗавершения = Неопределено)

	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("ИнформацияПоПрефиксамТитула", ИнформацияПоПрефиксамТитула);
	ДополнительныеПараметры.Вставить("ИдентификаторОтправителя", ИдентификаторОтправителя);
	ДополнительныеПараметры.Вставить("Переформировать", Переформировать);
	ДополнительныеПараметры.Вставить("ОбработкаЗавершения", ОбработкаЗавершения);
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ЗаполнитьИдентификациюФайлаОбмена_ПослеПолученияУИД", ЭтаФорма, ДополнительныеПараметры);
	
	Если ЗначениеЗаполнено(Объект.УИДМинтранс) Тогда
		ЗаполнитьИдентификациюФайлаОбмена_ПослеПолученияУИД(Объект.УИДМинтранс, ДополнительныеПараметры);
	Иначе
		Если Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул1") Тогда
			ОбменСГИСЭПДКлиент.ПолучитьУИДМинтранса(ОписаниеОповещения, Объект.ИдентификаторГрузоотправителя);
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2") Тогда
			ОбменСГИСЭПДКлиент.ПолучитьУИДМинтранса(ОписаниеОповещения, Объект.ИдентификаторПеревозчика, Истина, Объект.Ссылка);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьИдентификациюФайлаОбмена_ПослеПолученияУИД(Результат, ДополнительныеПараметры) Экспорт
	
	Если ЗначениеЗаполнено(Объект.УИДМинтранс) = Ложь Тогда
		Объект.УИДМинтранс = Результат;
	КонецЕсли;
	
	ИнформацияПоПрефиксамТитула = ДополнительныеПараметры.ИнформацияПоПрефиксамТитула;
	ИдентификаторОтправителя = ДополнительныеПараметры.ИдентификаторОтправителя;
	Переформировать = ДополнительныеПараметры.Переформировать;
	
	ТребуетсяЗаполнить = Переформировать = Истина
			Или ОбменСГИСЭПДКлиент.ТребуетсяИдентификацияФайлаТитула(Объект.Ссылка, Объект.ТекущийТитул, ВерсииТитулов);
	
	Если ТребуетсяЗаполнить = Истина Тогда
		КонтейнерОтображаемойВерсии = Неопределено;
		
		ДатаИВремяФормирования = ОбщегоНазначенияКлиент.ДатаСеанса();
		ДатаФормирования = НачалоДня(ДатаИВремяФормирования);
		ВремяФормирования = Дата('00010101') + (ДатаИВремяФормирования - ДатаФормирования);
	
		Если Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул1") Тогда
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяТранспортнаяНакладнаяДата", Объект.Дата, Ложь, КонтейнерОтображаемойВерсии);
			Если ЗначениеЗаполнено(Объект.Ссылка) = Ложь Тогда
				Объект.Номер = УстановитьНомерДокумента();
			КонецЕсли;	
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяТранспортнаяНакладнаяНомер", Объект.Номер, Ложь, КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяСодержаниеОперации", 
				"Лицом, осуществляющим погрузку груза, при указанных обстоятельствах передан водителю груз с указанными характеристиками", , КонтейнерОтображаемойВерсии);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяЗаказНомер", "Без номера", Ложь, КонтейнерОтображаемойВерсии);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяУказанияВОтношенииВыполненияНормПеревозки", "Отсутствуют", Ложь, КонтейнерОтображаемойВерсии);
			
			К = 1;
			КлючСтруктуры = "ТитулГрузоотправителяГрузы__" + К + "__ИдентификаторСтроки";
			ИдентификаторСтроки = Неопределено;
			СтруктураРеквизитовТитула = КонтейнерОтображаемойВерсии.СтруктураРеквизитовЗаполнение[КонтейнерОтображаемойВерсии.ПрефиксТитула][КонтейнерОтображаемойВерсии.НомерВерсии];
			Пока СтруктураРеквизитовТитула.Свойство(КлючСтруктуры, ИдентификаторСтроки) Цикл
				ЗначенияСтроки = Новый Структура("МаркировкаГруза", "Отсутствует");
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеПодчиненнойСтрокиВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяПереченьМаркировокГруза", ИдентификаторСтроки, ЗначенияСтроки, Ложь, КонтейнерОтображаемойВерсии);	
				К = К + 1;
				КлючСтруктуры = "ТитулГрузоотправителяГрузы__" + К + "__ИдентификаторСтроки";
			КонецЦикла;
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяЛицоОсуществляющееПогрузкуЯвляетсяГрузоотправителем", "1", Ложь, КонтейнерОтображаемойВерсии);
			ТитулГрузоотправителяЛицоОсуществляющееПогрузкуЯвляетсяГрузоотправителем = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(
					ЭтаФорма, "ТитулГрузоотправителяЛицоОсуществляющееПогрузкуЯвляетсяГрузоотправителем", , КонтейнерОтображаемойВерсии);
			Если ТитулГрузоотправителяЛицоОсуществляющееПогрузкуЯвляетсяГрузоотправителем = "1"
				И ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяГрузоотправитель) Тогда
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяРеквизитыГрузоотправителяЮЛ_ИНН", ИННКонтрагента(Объект.СсылкаТитулГрузоотправителяГрузоотправитель), , КонтейнерОтображаемойВерсии);
			Иначе
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяРеквизитыГрузоотправителяЮЛ_ИНН", Неопределено, , КонтейнерОтображаемойВерсии);
			КонецЕсли;
			
			Если ТитулГрузоотправителяЛицоОсуществляющееПогрузкуЯвляетсяГрузоотправителем = "1" Тогда
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеОснованиеПолномочий", Неопределено, , КонтейнерОтображаемойВерсии);	
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийНаименование", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийДата", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийНомер", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийИдентификатор", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийДополнительныеСведения", Неопределено, , КонтейнерОтображаемойВерсии);
				
				ОбменСГИСЭПДКлиентСервер.УдалитьСтрокиТаблицыИзСтруктурыФормы(
					ЭтаФорма, "ТитулГрузоотправителяИныеОснованияПолномочийПогрузкиРеквизитыСторон", , КонтейнерОтображаемойВерсии);	
			Иначе
				ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийНаименование =
					ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(
						ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийНаименование", , КонтейнерОтображаемойВерсии);
				Если ЗначениеЗаполнено(ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийНаименование) Тогда
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеОснованиеПолномочий", Неопределено, , КонтейнерОтображаемойВерсии);	
				Иначе
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеОснованиеПолномочий", "Должностные обязанности", Ложь, КонтейнерОтображаемойВерсии);	
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийНаименование", Неопределено, , КонтейнерОтображаемойВерсии);
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийДата", Неопределено, , КонтейнерОтображаемойВерсии);
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийНомер", Неопределено, , КонтейнерОтображаемойВерсии);
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийИдентификатор", Неопределено, , КонтейнерОтображаемойВерсии);
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, "ТитулГрузоотправителяРаботникНаПогрузкеДокументПолномочийДополнительныеСведения", Неопределено, , КонтейнерОтображаемойВерсии);
					
					ОбменСГИСЭПДКлиентСервер.УдалитьСтрокиТаблицыИзСтруктурыФормы(
						ЭтаФорма, "ТитулГрузоотправителяИныеОснованияПолномочийПогрузкиРеквизитыСторон", , КонтейнерОтображаемойВерсии);
				КонецЕсли;
			КонецЕсли;
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяВладелецПунктаПогрузкиЯвляетсяГрузоотправителем", "1", Ложь, КонтейнерОтображаемойВерсии);
			Если ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(
					ЭтаФорма, "ТитулГрузоотправителяВладелецПунктаПогрузкиЯвляетсяГрузоотправителем", , КонтейнерОтображаемойВерсии) = "1"
				И ЗначениеЗаполнено(Объект.СсылкаТитулГрузоотправителяГрузоотправитель) Тогда
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяИнойГрузоотправительЮЛ_ИНН", ИННКонтрагента(Объект.СсылкаТитулГрузоотправителяГрузоотправитель), , КонтейнерОтображаемойВерсии);
			Иначе
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузоотправителяИнойГрузоотправительЮЛ_ИНН", Неопределено, , КонтейнерОтображаемойВерсии);
			КонецЕсли;
			
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2") Тогда 
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаПриемкаСодержаниеОперации", 
					"Груз принят к перевозке водителем, уполномоченным перевозчиком на перевозку груза, от лица, осуществившего погрузку груза в транспортное средство", , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаПриемкаФайлГрузоотправителяИдентификатор",
					Объект.ТитулГрузоотправителяИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаПриемкаФайлГрузоотправителяДатаФормированияФайла", Объект.ТитулГрузоотправителяДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаПриемкаФайлГрузоотправителяВремяФормированияФайла", Объект.ТитулГрузоотправителяВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаПриемкаФайлГрузоотправителяЭлектроннаяПодпись",
					ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул1")), , КонтейнерОтображаемойВерсии);
					
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул3") Тогда	
			Если ВариантПриемки = 2 Тогда
				ПричинаОтказаВПриемеГруза = 
					ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, "ТитулГрузополучателяПричинаОтказаВПриемеГруза", , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.ОчиститьДанныеПоТитулуВСтруктуреФормы(ЭтаФорма, Объект.ТекущийТитул, КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяПричинаОтказаВПриемеГруза", ПричинаОтказаВПриемеГруза, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяОбщееКоличествоПринятыхГрузовыхМест", 0, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяСодержаниеОперацииПриемГруза", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяСодержаниеОперацииОтказВПриемеГруза", 
					"Лицом, управомоченным на получение груза, при указанных обстоятельствах отказано в принятии от перевозчика груза с указанными характеристиками", , КонтейнерОтображаемойВерсии);
				ЗаполнитьПредставленияАдресов(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул3"));	
			Иначе
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяСодержаниеОперацииОтказВПриемеГруза", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяПричинаОтказаВПриемеГруза", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяСодержаниеОперацииПриемГруза", 
					"Лицом, управомоченным на получение груза, при указанных обстоятельствах принят от перевозчика груз с указанными характеристиками", , КонтейнерОтображаемойВерсии);
			КонецЕсли;				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяПредставительГрузополучателя", Строка(Объект.СсылкаТитулГрузоотправителяГрузополучатель), , КонтейнерОтображаемойВерсии);
					
			КонтейнерПервойВерсии = ОбменСГИСЭПДКлиентСервер.СкопироватьИзФиксированногоЗначенияРекурсивно(КонтейнерОтображаемойВерсии);
			КонтейнерПервойВерсии.НомерВерсии = 0;
			КонтейнерПервойВерсии.ПрефиксТитула = "ТитулПеревозчикаПриемка";
			
			ТитулПеревозчикаПриемкаИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаИдентификаторФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаДатаФормированияФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаВремяФормированияФайла", , КонтейнерПервойВерсии);
				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяИдентификаторФайлаПеревозчика", ТитулПеревозчикаПриемкаИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяДатаФормированияФайлаПеревозчика", ТитулПеревозчикаПриемкаДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяВремяФормированияФайлаПеревозчика", ТитулПеревозчикаПриемкаВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулГрузополучателяЭлектроннаяПодписьФайлаПеревозчика",
						ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2"), Истина), , КонтейнерОтображаемойВерсии);
						
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул3") Тогда
			Если ВариантПриемкиДоп = 2 Тогда
				ПричинаОтказаВПриемеГруза = 
					ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, "ДопТитулГрузополучателяПричинаОтказаВПриемеГруза", , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.ОчиститьДанныеПоТитулуВСтруктуреФормы(ЭтаФорма, Объект.ТекущийТитул, КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяПричинаОтказаВПриемеГруза", ПричинаОтказаВПриемеГруза, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяОбщееКоличествоПринятыхГрузовыхМест", 0, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяСодержаниеОперацииПриемГруза", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяСодержаниеОперацииОтказВПриемеГруза", 
					"Лицом, управомоченным на получение груза, при указанных обстоятельствах отказано в принятии от перевозчика груза с указанными характеристиками", , КонтейнерОтображаемойВерсии);
				ЗаполнитьПредставленияАдресов(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул3"));		
			Иначе
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяСодержаниеОперацииОтказВПриемеГруза", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяПричинаОтказаВПриемеГруза", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяСодержаниеОперацииПриемГруза",
					"Лицом, управомоченным на получение груза, при указанных обстоятельствах принят от перевозчика груз с указанными характеристиками", , КонтейнерОтображаемойВерсии);
			КонецЕсли;
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяПредставительГрузополучателя", Строка(Объект.СсылкаТитулГрузоотправителяГрузополучатель), , КонтейнерОтображаемойВерсии);
					
			КонтейнерПервойВерсии = ОбменСГИСЭПДКлиентСервер.СкопироватьИзФиксированногоЗначенияРекурсивно(КонтейнерОтображаемойВерсии);
			КонтейнерПервойВерсии.НомерВерсии = 0;
			КонтейнерПервойВерсии.ПрефиксТитула = "ТитулПеревозчикаПриемка";
			
			ТитулПеревозчикаПриемкаИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаИдентификаторФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаДатаФормированияФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаВремяФормированияФайла", , КонтейнерПервойВерсии);
				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяИдентификаторФайлаПеревозчика", ТитулПеревозчикаПриемкаИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяДатаФормированияФайлаПеревозчика", ТитулПеревозчикаПриемкаДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяВремяФормированияФайлаПеревозчика", ТитулПеревозчикаПриемкаВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулГрузополучателяЭлектроннаяПодписьФайлаПеревозчика",
						ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2"), Истина), , КонтейнерОтображаемойВерсии);
						
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул4") Тогда
			КонтейнерРеквизитовГрузополучателя = ОбменСГИСЭПДКлиентСервер.КонтейнерОтображаемойВерсииРеквизита(ЭтаФорма, "ТитулГрузополучателя");
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаВыдачаСодержаниеОперации", 
					"Груз с указанными характеристиками сдан водителем, уполномоченным перевозчиком на перевозку груза, лицу, управомоченному на получение груза", , КонтейнерОтображаемойВерсии);
			
			ТитулГрузополучателяИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулГрузополучателяИдентификаторФайла", , КонтейнерРеквизитовГрузополучателя);
			ТитулГрузополучателяДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулГрузополучателяДатаФормированияФайла", , КонтейнерРеквизитовГрузополучателя);
			ТитулГрузополучателяВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулГрузополучателяВремяФормированияФайла", , КонтейнерРеквизитовГрузополучателя);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаВыдачаИдентификаторФайлаГрузополучателя", ТитулГрузополучателяИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаВыдачаДатаФормированияФайлаГрузополучателя", ТитулГрузополучателяДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаВыдачаВремяФормированияФайлаГрузополучателя", ТитулГрузополучателяВремяФормированияФайла, , КонтейнерОтображаемойВерсии);				
					
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаВыдачаЭлектроннаяПодписьФайлаГрузополучателя", 
					ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул3")), , КонтейнерОтображаемойВерсии);
					
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул4") Тогда
			КонтейнерРеквизитовГрузополучателя = ОбменСГИСЭПДКлиентСервер.КонтейнерОтображаемойВерсииРеквизита(ЭтаФорма, "ДопТитулГрузополучателя");
			
			ВариантПриемкиДоп = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ДопТитулГрузополучателяСодержаниеОперацииПриемГруза", , КонтейнерРеквизитовГрузополучателя);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаВыдачаСодержаниеОперации", 
					ВариантПриемкиДоп, , КонтейнерОтображаемойВерсии);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаВыдачаИдентификаторФайлаГрузополучателя", Объект.ДопТитулПеревозчикаВыдачаИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаВыдачаДатаФормированияФайлаГрузополучателя", Объект.ДопТитулПеревозчикаВыдачаДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаВыдачаВремяФормированияФайлаГрузополучателя", Объект.ДопТитулПеревозчикаВыдачаВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаВыдачаЭлектроннаяПодписьФайлаГрузополучателя", 
					ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул3")), , КонтейнерОтображаемойВерсии);
					
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул9") Тогда
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулУказаниеПереадресСодержаниеОперации", "Направление указания о переадресовке", , КонтейнерОтображаемойВерсии);	
					
			КонтейнерПервойВерсии = ОбменСГИСЭПДКлиентСервер.СкопироватьИзФиксированногоЗначенияРекурсивно(КонтейнерОтображаемойВерсии);
			КонтейнерПервойВерсии.НомерВерсии = 0;
			КонтейнерПервойВерсии.ПрефиксТитула = "ТитулПеревозчикаПриемка";
			
			ТитулПеревозчикаПриемкаИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаИдентификаторФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаДатаФормированияФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаВремяФормированияФайла", , КонтейнерПервойВерсии);
				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулУказаниеПереадресФайлПеревозчикаПриемкаИдентификатор", ТитулПеревозчикаПриемкаИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулУказаниеПереадресФайлПеревозчикаПриемкаДатаФормированияФайла", ТитулПеревозчикаПриемкаДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулУказаниеПереадресФайлПеревозчикаПриемкаВремяФормированияФайла", ТитулПеревозчикаПриемкаВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулУказаниеПереадресФайлПеревозчикаПриемкаЭлектроннаяПодпись", 
					ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2"), Истина), , КонтейнерОтображаемойВерсии);
		
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул9") Тогда
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулУказаниеПереадресСодержаниеОперации", "Направление указания о переадресовке", , КонтейнерОтображаемойВерсии);	
					
			КонтейнерПервойВерсии = ОбменСГИСЭПДКлиентСервер.СкопироватьИзФиксированногоЗначенияРекурсивно(КонтейнерОтображаемойВерсии);
			КонтейнерПервойВерсии.НомерВерсии = 0;
			КонтейнерПервойВерсии.ПрефиксТитула = "ТитулПеревозчикаВыдача";
			
			ТитулПеревозчикаВыдачаИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаВыдачаИдентификаторФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаВыдачаДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаВыдачаДатаФормированияФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаВыдачаВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаВыдачаВремяФормированияФайла", , КонтейнерПервойВерсии);
				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулУказаниеПереадресФайлПеревозчикаВыдачаИдентификатор", ТитулПеревозчикаВыдачаИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулУказаниеПереадресФайлПеревозчикаВыдачаДатаФормирования", ТитулПеревозчикаВыдачаДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулУказаниеПереадресФайлПеревозчикаВыдачаВремяФормирования", ТитулПеревозчикаВыдачаВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулУказаниеПереадресФайлПеревозчикаВыдачаЭлектроннаяПодпись", 
					ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул4"), Истина), , КонтейнерОтображаемойВерсии);
								
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул7") Тогда
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПереадресовкаФормаПереадресовки", "Электронная", , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПереадресовкаВидДоставкиДокументаОПереадресовке", "Электронное уведомление перевозчика о переадресовке", , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПереадресовкаСодержаниеОперации", "Получение указания о переадресовке", , КонтейнерОтображаемойВерсии);
					
			КонтейнерПервойВерсии = ОбменСГИСЭПДКлиентСервер.СкопироватьИзФиксированногоЗначенияРекурсивно(КонтейнерОтображаемойВерсии);
			КонтейнерПервойВерсии.НомерВерсии = 0;
			КонтейнерПервойВерсии.ПрефиксТитула = "ТитулПеревозчикаПриемка";
			
			ТитулПеревозчикаПриемкаИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаИдентификаторФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаДатаФормированияФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаВремяФормированияФайла", , КонтейнерПервойВерсии);
				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПереадресовкаИдентификаторФайлаПеревозчикаОПриемеГруза", ТитулПеревозчикаПриемкаИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПереадресовкаДатаФайлаИнформацииПеревозчикаОПриемеГруза", ТитулПеревозчикаПриемкаДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПереадресовкаВремяФайлаОбменаПеревозчикаОПриемеГруза", ТитулПеревозчикаПриемкаВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПереадресовкаЭлектроннаяПодписьФайлаПеревозчикаОПриемеГруза", 
					ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2"), Истина), , КонтейнерОтображаемойВерсии);
					
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7") Тогда
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПереадресовкаФормаПереадресовки", "Электронная", , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПереадресовкаВидДоставкиДокументаОПереадресовке", "Электронное уведомление перевозчика о переадресовке", , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПереадресовкаСодержаниеОперации", "Получение указания о переадресовке", , КонтейнерОтображаемойВерсии);
					
			КонтейнерПервойВерсии = ОбменСГИСЭПДКлиентСервер.СкопироватьИзФиксированногоЗначенияРекурсивно(КонтейнерОтображаемойВерсии);
			КонтейнерПервойВерсии.НомерВерсии = 0;
			КонтейнерПервойВерсии.ПрефиксТитула = "ТитулПеревозчикаПриемка";
			
			ТитулПеревозчикаПриемкаИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаИдентификаторФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаДатаФормированияФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаВремяФормированияФайла", , КонтейнерПервойВерсии);
				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПереадресовкаИдентификаторФайлаПеревозчикаОПриемеГруза", ТитулПеревозчикаПриемкаИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПереадресовкаДатаФайлаИнформацииПеревозчикаОПриемеГруза", ТитулПеревозчикаПриемкаДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПереадресовкаВремяФайлаОбменаПеревозчикаОПриемеГруза", ТитулПеревозчикаПриемкаВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПереадресовкаЭлектроннаяПодписьФайлаПеревозчикаОПриемеГруза", 
					ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2"), Истина), , КонтейнерОтображаемойВерсии);
					
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул8") Тогда
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаЗаменыЭлектроннаяПодписьФайлаПеревозчика", 
					ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2"), Истина), , КонтейнерОтображаемойВерсии);
					
			КонтейнерПервойВерсии = ОбменСГИСЭПДКлиентСервер.СкопироватьИзФиксированногоЗначенияРекурсивно(КонтейнерОтображаемойВерсии);
			КонтейнерПервойВерсии.НомерВерсии = 0;
			КонтейнерПервойВерсии.ПрефиксТитула = "ТитулПеревозчикаПриемка";
			
			ТитулПеревозчикаПриемкаИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаИдентификаторФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаДатаФормированияФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаВремяФормированияФайла", , КонтейнерПервойВерсии);
				
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаЗаменыИдентификаторФайлаПеревозчика", ТитулПеревозчикаПриемкаИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаЗаменыДатаФормированияФайлаПеревозчика", ТитулПеревозчикаПриемкаДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаЗаменыВремяФормированияФайлаПеревозчика", ТитулПеревозчикаПриемкаВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
						
			Если ВариантПричиныЗамены = 1 Тогда
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаЗаменыПричинаЗаменыПроизвольныйТекст", Неопределено, , КонтейнерОтображаемойВерсии);
			Иначе
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаЗаменыДокументНаименование", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаЗаменыДокументНомер", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаЗаменыДокументДата", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ТитулПеревозчикаЗаменыДокументДополнительныеСведения", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УдалитьСтрокиТаблицыИзСтруктурыФормы(
					ЭтаФорма, "ТитулПеревозчикаЗаменыДокументРеквизитыСторон", , КонтейнерОтображаемойВерсии);
			КонецЕсли;
			
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул8") Тогда		
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаЗаменыЭлектроннаяПодписьФайлаПеревозчика", 
					ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2"), Истина), , КонтейнерОтображаемойВерсии);
					
			КонтейнерПервойВерсии = ОбменСГИСЭПДКлиентСервер.СкопироватьИзФиксированногоЗначенияРекурсивно(КонтейнерОтображаемойВерсии);
			КонтейнерПервойВерсии.НомерВерсии = 0;
			КонтейнерПервойВерсии.ПрефиксТитула = "ТитулПеревозчикаПриемка";
			
			ТитулПеревозчикаПриемкаИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаИдентификаторФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаДатаФормированияФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаПриемкаВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаПриемкаВремяФормированияФайла", , КонтейнерПервойВерсии);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаЗаменыИдентификаторФайлаПеревозчика", ТитулПеревозчикаПриемкаИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаЗаменыДатаФормированияФайлаПеревозчика", ТитулПеревозчикаПриемкаДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаЗаменыВремяФормированияФайлаПеревозчика", ТитулПеревозчикаПриемкаВремяФормированияФайла, , КонтейнерОтображаемойВерсии);	
					
			Если ВариантПричиныЗаменыДоп = 1 Тогда
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаЗаменыПричинаЗаменыПроизвольныйТекст", Неопределено, , КонтейнерОтображаемойВерсии);
			Иначе
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаЗаменыДокументНаименование", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаЗаменыДокументНомер", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаЗаменыДокументДата", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, "ДопТитулПеревозчикаЗаменыДокументДополнительныеСведения", Неопределено, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УдалитьСтрокиТаблицыИзСтруктурыФормы(
					ЭтаФорма, "ДопТитулПеревозчикаЗаменыДокументРеквизитыСторон", , КонтейнерОтображаемойВерсии);
			КонецЕсли;
			
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул5") Тогда
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаФХЖСодержание", 
				"Вверенный грузоотправителем груз доставлен в пункт назначения и выдан управомоченному на получение груза с учетом приведенных в транспортной накладной обстоятельств перевозки", , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаФХЖПредставительПеревозчика", Строка(Объект.СсылкаТитулГрузоотправителяПеревозчик), , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаФХЖНаименованиеВалютыСтоимости", "Российский рубль", Ложь, КонтейнерОтображаемойВерсии);	
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаФХЖКодВалютыСтоимости", "643", Ложь, КонтейнерОтображаемойВерсии);
				
			КонтейнерПервойВерсии = ОбменСГИСЭПДКлиентСервер.СкопироватьИзФиксированногоЗначенияРекурсивно(КонтейнерОтображаемойВерсии);
			КонтейнерПервойВерсии.НомерВерсии = 0;
			КонтейнерПервойВерсии.ПрефиксТитула = "ТитулПеревозчикаВыдача";
			
			ТитулПеревозчикаВыдачаИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаВыдачаИдентификаторФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаВыдачаДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаВыдачаДатаФормированияФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаВыдачаВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаВыдачаВремяФормированияФайла", , КонтейнерПервойВерсии);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаФХЖИдентификаторФайлаПеревозчика", ТитулПеревозчикаВыдачаИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаФХЖДатаФормированияФайлаПеревозчика", ТитулПеревозчикаВыдачаДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаФХЖВремяФормированияФайлаПеревозчика", ТитулПеревозчикаВыдачаВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаФХЖЭлектроннаяПодписьФайлаПеревозчика", 
				ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул4"), Истина), , КонтейнерОтображаемойВерсии);
				
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул6") Тогда
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяФХЖСодержаниеФактаХозяйственнойЖизни", 
				"Обязательства по доставке груза в пункт назначения и выдаче его  на получение груза лицу исполнены перевозчиком с учетом обстоятельств, приведенных в транспортной накладной", , КонтейнерОтображаемойВерсии);
			
			КонтейнерПервойВерсии = ОбменСГИСЭПДКлиентСервер.СкопироватьИзФиксированногоЗначенияРекурсивно(КонтейнерОтображаемойВерсии);
			КонтейнерПервойВерсии.НомерВерсии = 0;
			КонтейнерПервойВерсии.ПрефиксТитула = "ТитулПеревозчикаФХЖ";
			
			ТитулПеревозчикаФХЖИдентификаторФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаФХЖИдентификаторФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаФХЖДатаФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаФХЖДатаФормированияФайла", , КонтейнерПервойВерсии);
			ТитулПеревозчикаФХЖВремяФормированияФайла = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, 
				"ТитулПеревозчикаФХЖВремяФормированияФайла", , КонтейнерПервойВерсии);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяФХЖПредставительГрузоотправителя", Строка(Объект.СсылкаТитулГрузоотправителяГрузоотправитель), , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяФХЖИдентификаторФайлаПеревозчика", ТитулПеревозчикаФХЖИдентификаторФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяФХЖДатаФайлаПеревозчика", ТитулПеревозчикаФХЖДатаФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяФХЖВремяФайлаПеревозчика", ТитулПеревозчикаФХЖВремяФормированияФайла, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяФХЖЭлектроннаяПодписьФайлаПеревозчика", 
				ПолучитьПодписьТитулаBase64(ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул5")), , КонтейнерОтображаемойВерсии);
		КонецЕсли;
		
		К = 1;
		ИныеПолучатели = Новый Массив;
		КлючОткуда = ИнформацияПоПрефиксамТитула.ВПрограмме + "ИдентификаторыИныхПолучателейФайла__" + К + "__" + "ИдентификаторИногоПолучателя";
		ЗначениеОткуда = Неопределено;
		КонтейнерОтображаемойВерсии = ОбменСГИСЭПДКлиентСервер.КонтейнерОтображаемойВерсииРеквизита(ЭтаФорма, КлючОткуда);
		СтруктураВерсииТитула = КонтейнерОтображаемойВерсии.СтруктураРеквизитовЗаполнение[КонтейнерОтображаемойВерсии.ПрефиксТитула][КонтейнерОтображаемойВерсии.НомерВерсии];
		Пока СтруктураВерсииТитула.Свойство(КлючОткуда, ЗначениеОткуда) Цикл
			ИныеПолучатели.Добавить(ЗначениеОткуда);	
			К = К + 1;
			КлючОткуда = ИнформацияПоПрефиксамТитула.ВПрограмме + "ИдентификаторыИныхПолучателейФайла__" + К + "__" + "ИдентификаторИногоПолучателя";
		КонецЦикла;
		НаличиеИныхПолучателей = ИныеПолучатели.Количество() > 0;
		Объект.ИныеПолучателиСтрока = СтрСоединить(ИныеПолучатели, ",");
		
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ПолеУИД, Объект.УИДМинтранс, , КонтейнерОтображаемойВерсии);
				
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ВерсияПрограммы", ОбменСГИСЭПДКлиентСервер.ВерсияПрограммы(), , КонтейнерОтображаемойВерсии);
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ВерсияФормата", ОбменСГИСЭПДКлиентСервер.ВерсияФормата(), , КонтейнерОтображаемойВерсии);
		
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "КодДокументаПоКНД", ИнформацияПоПрефиксамТитула.КНД, , КонтейнерОтображаемойВерсии);
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "НаименованиеДокументаПоФХЖ", ИнформацияПоПрефиксамТитула.ПоФактХЖ, , КонтейнерОтображаемойВерсии);
				
		ДанныеСертификатаУчетнойЗаписиЭДО = ОбменСГИСЭПДКлиентСервер.ДанныеСертификатаУчетнойЗаписиЭДО(ИдентификаторОтправителя);
		
		Если ИнформацияПоПрефиксамТитула.ВПрограмме = "ТитулПереадресовка"
			Или ИнформацияПоПрефиксамТитула.ВПрограмме = "ДопТитулПереадресовка"
			Или ИнформацияПоПрефиксамТитула.ВПрограмме = "ТитулПеревозчикаФХЖ"
			Или ИнформацияПоПрефиксамТитула.ВПрограмме = "ТитулГрузоотправителяФХЖ" Тогда
			ОбменСГИСЭПДКлиентСервер.УдалитьСтрокиТаблицыИзСтруктурыФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "Подписанты", , КонтейнерОтображаемойВерсии);
			
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "Подписанты__1__КодСтатусаПодписанта", 
				?(ЗначениеЗаполнено(ДанныеСертификатаУчетнойЗаписиЭДО.НомерДоверенности), "2", "1"), , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "Подписанты__1__Фамилия", ДанныеСертификатаУчетнойЗаписиЭДО.Фамилия, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "Подписанты__1__Имя", ДанныеСертификатаУчетнойЗаписиЭДО.Имя, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "Подписанты__1__Отчество", ДанныеСертификатаУчетнойЗаписиЭДО.Отчество, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "Подписанты__1__Должность", ДанныеСертификатаУчетнойЗаписиЭДО.Должность, , КонтейнерОтображаемойВерсии); 
			Если ЗначениеЗаполнено(ДанныеСертификатаУчетнойЗаписиЭДО.НомерДоверенности) Тогда
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "Подписанты__1__ДоверенностьИдентификаторФайла", ДанныеСертификатаУчетнойЗаписиЭДО.НомерДоверенности, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "Подписанты__1__ДоверенностьДата", ДанныеСертификатаУчетнойЗаписиЭДО.ДатаДоверенности, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "Подписанты__1__ДоверенностьНомер", ДанныеСертификатаУчетнойЗаписиЭДО.ПорядковыйНомерДоверенности, , КонтейнерОтображаемойВерсии);	
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "Подписанты__1__СистемаСоСведениямиОбАннулированииДоверенности", ДанныеСертификатаУчетнойЗаписиЭДО.СведенияОбИнформационнойСистеме, , КонтейнерОтображаемойВерсии);
			КонецЕсли;
		Иначе
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантТипПодписи", "1", , КонтейнерОтображаемойВерсии);
			СпособПодтверждения = "1";										
			Если ЗначениеЗаполнено(ДанныеСертификатаУчетнойЗаписиЭДО.НомерДоверенности) Тогда
				СпособПодтверждения = "2";
			КонецЕсли;
					// УДАЛИТЬ для версии 5.02
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантКодСтатуса", СпособПодтверждения, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантСпособПодтвержденияПолномочий", СпособПодтверждения, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантФамилия", ДанныеСертификатаУчетнойЗаписиЭДО.Фамилия, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантИмя", ДанныеСертификатаУчетнойЗаписиЭДО.Имя, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантОтчество", ДанныеСертификатаУчетнойЗаписиЭДО.Отчество, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантДолжность", ДанныеСертификатаУчетнойЗаписиЭДО.Должность, , КонтейнерОтображаемойВерсии);
				// УДАЛИТЬ для версии 5.02
				Если ЗначениеЗаполнено(ДанныеСертификатаУчетнойЗаписиЭДО.НомерДоверенности) Тогда
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантДоверенностьИдентификаторФайла", ДанныеСертификатаУчетнойЗаписиЭДО.НомерДоверенности, , КонтейнерОтображаемойВерсии);
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантДоверенностьДата", ДанныеСертификатаУчетнойЗаписиЭДО.ДатаДоверенности, , КонтейнерОтображаемойВерсии);
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантДоверенностьНомер", ДанныеСертификатаУчетнойЗаписиЭДО.ПорядковыйНомерДоверенности, , КонтейнерОтображаемойВерсии);	
					ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
						ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантСистемаСоСведениямиОбАннулированииДоверенности", ДанныеСертификатаУчетнойЗаписиЭДО.СведенияОбИнформационнойСистеме, , КонтейнерОтображаемойВерсии);
				КонецЕсли;
			Если ЗначениеЗаполнено(ДанныеСертификатаУчетнойЗаписиЭДО.НомерДоверенности) Тогда
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантДоверенностьЭлектроннаяНомер", ДанныеСертификатаУчетнойЗаписиЭДО.НомерДоверенности, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантДоверенностьЭлектроннаяДата", ДанныеСертификатаУчетнойЗаписиЭДО.ДатаДоверенности, , КонтейнерОтображаемойВерсии);
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантДоверенностьЭлектроннаяНомерВнутр", ДанныеСертификатаУчетнойЗаписиЭДО.ПорядковыйНомерДоверенности, , КонтейнерОтображаемойВерсии);	
				ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
					ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ПодписантДоверенностьЭлектроннаяИнформационнаяСистема", ДанныеСертификатаУчетнойЗаписиЭДО.СведенияОбИнформационнойСистеме, , КонтейнерОтображаемойВерсии);
			КонецЕсли;
		КонецЕсли;
		
		ИдентификаторГрузоотправителяДляФайла = Объект.ИдентификаторГрузоотправителя;
		Если Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул9")
			Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул9") Тогда
			Если Объект.Организация = Объект.СсылкаТитулГрузоотправителяГрузоотправитель
				Или Объект.Организация = Объект.СсылкаТитулГрузоотправителяСоставитель Тогда
				ИдентификаторГрузоотправителяДляФайла = Объект.ИдентификаторГрузоотправителя;
			ИначеЕсли Объект.Организация = Объект.СсылкаТитулГрузоотправителяГрузополучатель
				Или Объект.Организация = Объект.СсылкаТитулПереадресовкаНовыйГрузополучатель Тогда
				ИдентификаторГрузоотправителяДляФайла = Объект.ИдентификаторГрузополучателя;
			КонецЕсли;	
		КонецЕсли;
		
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме + "ИдентификаторФайла", ПолучитьИмяФайла(ИнформацияПоПрефиксамТитула.ШаблонИмениФайла, 
																			ИдентификаторГрузоотправителяДляФайла,
																			Объект.ИдентификаторГрузополучателя,
																			Объект.ИдентификаторПеревозчика,
																			НаличиеИныхПолучателей), , КонтейнерОтображаемойВерсии);
		
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма,
			ИнформацияПоПрефиксамТитула.ВПрограмме + "ДатаФормированияФайла",
			ДатаФормирования, ,	
			КонтейнерОтображаемойВерсии);
			
		ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(ЭтаФорма,
			ИнформацияПоПрефиксамТитула.ВПрограмме + "ВремяФормированияФайла",
			ВремяФормирования, ,	
			КонтейнерОтображаемойВерсии);
	КонецЕсли;
		
	// Проверим заполнение
	Если ОбменСГИСЭПДКлиент.ЗаполнитьТаблицуОшибокЭПД(ЭтаФорма, ОшибкиЗаполнения, Истина) = Истина Тогда	
		Элементы.ГруппаОшибки.Видимость = Истина;
		Элементы.НадписьОшибки.Заголовок = "Ошибки заполнения (" + Строка(ОшибкиЗаполнения.Количество()) + ")";
		Если ТребуетсяЗаполнить = Истина Тогда
			ОчиститьИдФайлТекущегоТитула();
		КонецЕсли;
	Иначе
		Элементы.НадписьОшибки.Заголовок = "Ошибки заполнения";
	КонецЕсли;
	
	Если ДополнительныеПараметры.Свойство("ОбработкаЗавершения") 
		И ДополнительныеПараметры.ОбработкаЗавершения <> Неопределено Тогда
		ВыполнитьОбработкуОповещения(ДополнительныеПараметры.ОбработкаЗавершения);
	КонецЕсли;
		
КонецПроцедуры

&НаКлиенте
Процедура ИсправитьТитул(Команда)
	
	ВводимИсправление = Истина;
	ОбменСГИСЭПДКлиентСервер.УстановитьДоступностьЭлементовЭТрН(ЭтаФорма);
	УстановитьТекущийШагПомощника();
		
КонецПроцедуры


&НаСервере
Функция ИННКонтрагента(Контрагент)
	
	Возврат ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Контрагент, "ИНН");
	
КонецФункции

&НаКлиенте
Процедура ОтправитьУОУ(Команда)
	
	Текст = "";
	Если ВвестиСтроку(Текст, "Текст запроса уточнения (отклонения)", , Истина) Тогда
		ОтправитьУОУ_ПослеВводаТекстаУточнения(Текст);  
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьУОУ_ПослеВводаТекстаУточнения(Текст) Экспорт
	
	Если ЗначениеЗаполнено(Текст) = Ложь Тогда
		Возврат;
	КонецЕсли;
	
	Если Объект.ТекущийПолученныйТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул1") Тогда
		Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ОткП");
	ИначеЕсли Объект.ТекущийПолученныйТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул3") Тогда
		Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ОткТ3");
	ИначеЕсли Объект.ТекущийПолученныйТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул5") Тогда
		Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ОткГО");	
	КонецЕсли;
	ПараметрыЗаписи = Новый Структура;
	ПараметрыЗаписи.Вставить("НеТребуетсяИдентификацияФайла");
	Записать(ПараметрыЗаписи);
	
	НаборДействий = "";
	
	ДействиеОтклонить = "Отклонить";
	
	ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий, ДействиеОтклонить);
	ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий,
					"Подписать");
	ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий,
					"ПодготовитьКОтправке");
	ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий,
					"Отправить");
	
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("ЭтоИсправление", Ложь);
	ДополнительныеПараметры.Вставить("ОповещениеУспешногоЗавершения",
		Новый ОписаниеОповещения("ПослеВыполненияДействийПоЭДО_ОбработкаОшибки", ЭтаФорма));

	Оповещение = Новый ОписаниеОповещения("ПослеВыполненияДействийПоЭДО", ЭтаФорма, ДополнительныеПараметры);  
	
	СообщениеЭД = ОбменСГИСЭПДВызовСервера.ПолучитьСообщениеТитула(Объект.Ссылка, Объект.ТекущийПолученныйТитул);

	МассивЭД = Новый Массив;
	МассивЭД.Добавить(СообщениеЭД);  
	
	//СоответствтиеЭД = ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьСоответствиеВладельцевИЭД(Ссылки);
	//МассивЭД = Новый Массив;
	//МассивЭД.Добавить(СоответствтиеЭД.Получить(Объект.Ссылка));
	
	НужноОбновитьСостояниеЭД = Ложь;
	//ЭлектронныеДокументыСлужебныйКлиент.ОбработатьЭД(Ссылки, НаборДействий);  
	Результат = ЭлектронныеДокументыКлиентСервер.СформироватьПодписатьИОтправитьСлужебныеЭД(
					МассивЭД, 
					ПредопределенноеЗначение("Перечисление.ВидыЭД.УведомлениеОбУточнении"),
					Текст);
	
	ВыполнитьОбработкуОповещения(Оповещение);
	
	
КонецПроцедуры


&НаСервере
Функция ПолучитьПодписьТитулаBase64(ТипЭлементаРегламента, ПерваяВерсия = Ложь) 
	
	ПодписьBase64 = "";
	
	СообщениеТитула = ОбменСГИСЭПД.ПолучитьСообщениеТитула(Объект.Ссылка, ТипЭлементаРегламента, , ПерваяВерсия);
	
	Если ЗначениеЗаполнено(СообщениеТитула) Тогда
		УстановленныеПодписи = ОбменСГИСЭПД.УстановленныеПодписи(СообщениеТитула);
		Для Каждого ОписаниеПодписи Из УстановленныеПодписи Цикл
			ПодписьBase64 = Base64Строка(ОписаниеПодписи.Подпись);
			Прервать;
		КонецЦикла;
	КонецЕсли;
	
	Возврат ПодписьBase64;
	
КонецФункции

&НаКлиенте
Процедура ОтправитьЧерезЭДО(Команда)
		
	ЭтаФорма.Доступность = Ложь;
	
	Если ЗначениеЗаполнено(Объект.ИдентификаторГрузоотправителя) = Ложь
		Или ЗначениеЗаполнено(Объект.ИдентификаторГрузополучателя) = Ложь
		Или ЗначениеЗаполнено(Объект.ИдентификаторПеревозчика) = Ложь
		Или ИзмененСоставУчастников = Истина Тогда
		ЗаполнитьУчастников(Истина);
	Иначе
		ОтправитьЧерезЭДОПослеЗаписи();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьЧерезЭДОПослеЗаписи(Повторно = Ложь)
	
	Если Объект.ИдентификаторПеревозчика = Объект.ИдентификаторГрузоотправителя
		Или Объект.ИдентификаторПеревозчика = Объект.ИдентификаторГрузополучателя Тогда
		Доступность = Истина;
		ПоказатьПредупреждение(, НСтр("ru='Документ не отправлен. 
			|Идентификатор перевозчика не должен совпадать с идентификатором грузоотправителя или грузополучателя.'"));
		Возврат;	
	КонецЕсли;
	
	ДанныеСостоянияЭДО = ОбменСГИСЭПДВызовСервера.ДанныеСостоянияЭДОДляФормыОбъектаУчета(Объект.Ссылка);
	
	ЭтоИсправление = Ложь;
	КонтейнерОтображаемойВерсии = Неопределено;
	Если ВводимИсправление Или ДанныеСостоянияЭДО.ПредставлениеСостояния = "Требуется уточнение" Тогда
		Если Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул1") Тогда
			ТекущийНомерИсправления = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, "ТитулГрузоотправителяНомерИсправления", 0, КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяНомерИсправления", ТекущийНомерИсправления + 1, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузоотправителяДатаИсправления", ОбщегоНазначенияКлиент.ДатаСеанса(), , КонтейнерОтображаемойВерсии);
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул3") Тогда
			ТекущийНомерИсправления = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, "ТитулГрузополучателяНомерИсправления", 0, КонтейнерОтображаемойВерсии);	
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузополучателяНомерИсправления", ТекущийНомерИсправления + 1, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулГрузополучателяДатаИсправления", ОбщегоНазначенияКлиент.ДатаСеанса(), , КонтейнерОтображаемойВерсии);
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул3") Тогда
			ТекущийНомерИсправления = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, "ДопТитулГрузополучателяНомерИсправления", 0, КонтейнерОтображаемойВерсии);	
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ДопТитулГрузополучателяНомерИсправления", ТекущийНомерИсправления + 1, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ДопТитулГрузополучателяДатаИсправления", ОбщегоНазначенияКлиент.ДатаСеанса(), , КонтейнерОтображаемойВерсии);
		ИначеЕсли Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул5") Тогда
			ТекущийНомерИсправления = ОбменСГИСЭПДКлиентСервер.ПолучитьЗначениеРеквизитаИзСтруктурыФормы(ЭтаФорма, "ТитулПеревозчикаФХЖНомерИсправления", 0, КонтейнерОтображаемойВерсии);	
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаФХЖНомерИсправления", ТекущийНомерИсправления + 1, , КонтейнерОтображаемойВерсии);
			ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
				ЭтаФорма, "ТитулПеревозчикаФХЖДатаИсправления", ОбщегоНазначенияКлиент.ДатаСеанса(), , КонтейнерОтображаемойВерсии);
		КонецЕсли;
		ЭтоИсправление = Истина;
		Повторно = Истина;	
	КонецЕсли;
	
	Если Повторно = Истина Тогда
		ТитулыПоДокументу = ОбменСГИСЭПДВызовСервера.ПолучитьТитулыПоДокументу(Объект.Ссылка, Истина);
		ВерсииТитуловЗаписанные = ОбменСГИСЭПДВызовСервера.ПолучитьВерсииТитуловДокумента(Объект, Объект.Организация);
		ОбменСГИСЭПДКлиентСервер.УстановитьТекущийДоступныйТитулЭТрН(Объект, ТитулыПоДокументу, ВерсииТитуловЗаписанные, , Истина);
	КонецЕсли;
	ИнформацияПоПрефиксамТитула = ОбменСГИСЭПДКлиентСервер.ПрефиксТитулаПоЭлементуРегламентаЭДО(Объект.ТекущийТитул); 
	
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("ДанныеСостоянияЭДО", ДанныеСостоянияЭДО);
	ДополнительныеПараметры.Вставить("ЭтоИсправление", ЭтоИсправление);
	ДополнительныеПараметры.Вставить("Повторно", Повторно);
	ОписаниеОповещения = Новый ОписаниеОповещения("ОтправитьЧерезЭДОПослеЗаписи_Завершение", ЭтаФорма, ДополнительныеПараметры);

	ЗаполнитьИдентификациюФайлаОбмена(ИнформацияПоПрефиксамТитула, ИдентификаторОтправителя(), Повторно, ОписаниеОповещения);	
	
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьЧерезЭДОПослеЗаписи_Завершение(Результат, ДополнительныеПарамтеры) Экспорт
	
	ДанныеСостоянияЭДО = ДополнительныеПарамтеры.ДанныеСостоянияЭДО;
	Повторно = ДополнительныеПарамтеры.Повторно;
	ЭтоИсправление = ДополнительныеПарамтеры.ЭтоИсправление;
	
	ПараметрыЗаписи = Новый Структура;
	ПараметрыЗаписи.Вставить("НеТребуетсяИдентификацияФайла");
	Записать(ПараметрыЗаписи);
	
	Если ЗначениеЗаполнено(Объект.ТекущийТитул) = Ложь Тогда
		Доступность = Истина;
		Возврат;
	КонецЕсли;
	
	Если ОшибкиЗаполнения.Количество() > 0 Тогда	
		Элементы.ГруппаОшибки.Видимость = Истина;
		Элементы.НадписьОшибки.Заголовок = "Ошибки заполнения (" + Строка(ОшибкиЗаполнения.Количество()) + ")";
		Доступность = Истина;
		ПоказатьПредупреждение(, НСтр("ru='Документ не отправлен, обнаружены ошибки заполнения. Исправьте ошибки и повторите попытку'"));
		Возврат;
	Иначе
		Элементы.НадписьОшибки.Заголовок = "Ошибки заполнения";
	КонецЕсли;
	
	НаборДействий = "";		
	
	Если Повторно = Истина 
		Или ДанныеСостоянияЭДО.ПредставлениеСостояния = "Требуется повторная отправка" 
		Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул7")
		Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7")
		Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул8")
		Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул8")
		Или ЗначениеЗаполнено(ОбменСГИСЭПДКлиентСервер.ПолучитьСообщениеТитула(Объект.Ссылка, Объект.ТекущийТитул)) = Ложь Тогда
			Если Объект.ЭтоВходящий = Ложь И ДанныеСостоянияЭДО.СуществуетАктуальныйДокумент = Ложь Тогда
				ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий, "Сформировать");
			Иначе
				ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий,
					"Утвердить"); // СформироватьОтвет
			КонецЕсли;	   
			
			ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий,
				"Подписать");
			ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий,
				"ПодготовитьКОтправке");  
	Иначе		
		Если ДанныеСостоянияЭДО.ПредставлениеСостояния <> "Требуется подготовка к отправке" 
			И ДанныеСостоянияЭДО.ПредставлениеСостояния <> "Требуется отправка" Тогда
				ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий, 
					"Подписать");
		КонецЕсли;
		
		Если ДанныеСостоянияЭДО.ПредставлениеСостояния <> "Требуется отправка" Тогда
			ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий,
				"ПодготовитьКОтправке");
		КонецЕсли;		
	КонецЕсли;
	
	ОбменСГИСЭПДКлиентСервер.ДобавитьДействие(НаборДействий,
		"Отправить");
	
	ДополнительныеПараметрыУспешногоЗавершения = Новый Структура;
	ДополнительныеПараметрыУспешногоЗавершения.Вставить("НаборДействий", НаборДействий);
	ДополнительныеПараметрыУспешногоЗавершения.Вставить("ЭтоИсправление", ЭтоИсправление);
	
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("ЭтоИсправление", ЭтоИсправление);
	ДополнительныеПараметры.Вставить("ОповещениеУспешногоЗавершения",
		Новый ОписаниеОповещения("ПослеВыполненияДействийПоЭДО", ЭтаФорма, 
									ДополнительныеПараметрыУспешногоЗавершения, 
									"ПослеВыполненияДействийПоЭДО_ОбработкаОшибки", ЭтаФорма));

	Оповещение = Новый ОписаниеОповещения("ПослеВыполненияДействийПоЭДО", ЭтаФорма, ДополнительныеПараметры);
	
	Ссылки = Новый Массив;
	Ссылки.Добавить(Объект.Ссылка);
	НужноОбновитьСостояниеЭД = Ложь;
	ЭлектронныеДокументыСлужебныйКлиент.ОбработатьЭД(Ссылки, НаборДействий);
	
	ВыполнитьОбработкуОповещения(Оповещение);	
	
КонецПроцедуры


&НаКлиенте
Процедура ОшибкиЗаполненияВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ТекущиеДанные = ОшибкиЗаполнения.НайтиПоИдентификатору(ВыбраннаяСтрока);
	ЭтаФорма.ПереходыПоОшибкам = ТекущиеДанные.Описание.Переходы;
	ОбменСГИСЭПДКлиент.ПоказатьОшибкуЗаполнения(ЭтаФорма, ТекущиеДанные, ИдентификаторОтправителя());

КонецПроцедуры


&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	
	Если ЗначениеЗаполнено(Объект.ТекущийТитул) = Ложь Тогда
		Возврат;
	КонецЕсли;
	
	Если ПараметрыЗаписи.Свойство("НеТребуетсяИдентификацияФайла") = Ложь Тогда
		ЗаполнитьУчастников();
		ИнформацияПоПрефиксамТитула = ОбменСГИСЭПДКлиентСервер.ПрефиксТитулаПоЭлементуРегламентаЭДО(Объект.ТекущийТитул);
		ЗаполнитьИдентификациюФайлаОбмена(ИнформацияПоПрефиксамТитула, ИдентификаторОтправителя());	
	КонецЕсли;
	
КонецПроцедуры


&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	// СтандартныеПодсистемы.УправлениеДоступом
	Если ОбменСГИСЭПД.ПодсистемаСуществует("СтандартныеПодсистемы.УправлениеДоступом") Тогда
		МодульУправлениеДоступом = ОбщегоНазначенияКлиентСервер.ОбщийМодуль("УправлениеДоступом");
		МодульУправлениеДоступом.ПослеЗаписиНаСервере(ЭтаФорма, ТекущийОбъект, ПараметрыЗаписи);
	КонецЕсли;
	// Конец СтандартныеПодсистемы.УправлениеДоступом
	
КонецПроцедуры


&НаКлиенте
Процедура ОтправитьЧерезЭДОПовторно(Команда)
	
	ЭтаФорма.Доступность = Ложь;
	
	ОтправитьЧерезЭДОПослеЗаписи(Истина);
	
КонецПроцедуры


&НаКлиенте
Процедура ПослеВыполненияДействийПоЭДО(Результат, ДополнительныеПараметры) Экспорт
	
	ЭтаФорма.Доступность = Истина;
	//ДействиеОтправить = ПредопределенноеЗначение("Перечисление.ДействияПоЭДО.Отправить");
	//КоличествоОтправлено = Результат.ОбработаноПоДействиям.Получить(ДействиеОтправить);
	
	Если НужноОбновитьСостояниеЭД = Истина Тогда
		//КоличествоОтправлено <> Неопределено И КоличествоОтправлено > 0 Тогда
		Если ДополнительныеПараметры.ЭтоИсправление Тогда
			ОбменСГИСЭПДВызовСервера.ОтметитьИсправлениеДокумента(Объект.Ссылка);	
		КонецЕсли;
		ПараметрыЗаписи = Новый Структура;
		ПараметрыЗаписи.Вставить("НеТребуетсяИдентификацияФайла");
		Записать(ПараметрыЗаписи);
		
		ОтображаемыеВерсииТитулов = Неопределено;
		
		ТекстОповещения = НСтр("ru = 'Титул """ + Объект.ТекущийТитул + """ отправлен'");		
		ЗаголовокОповещения = НСтр("ru = 'Электронные документы'");	
		ДействиеПриНажатии = Неопределено;
		КартинкаОповещения = БиблиотекаКартинок.ЭмблемаСервиса1СЭДО;
		
		ПодключитьОбработчикОжидания("ОбновлениеДоступностиЭлементов", 2, Истина);
		
		#Если Не МобильноеПриложениеКлиент Тогда
		ПоказатьОповещениеПользователя(ЗаголовокОповещения, ДействиеПриНажатии, ТекстОповещения, КартинкаОповещения);
		#КонецЕсли
	//Иначе
	//	ЭтаФорма.Доступность = Истина;
	//КонецЕсли;
	
	//Если ДополнительныеПараметры.НаборДействий.Получить(ПредопределенноеЗначение("Перечисление.ДействияПоЭДО.ОтправитьВАрхив")) = Истина Тогда
	//	Закрыть();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеВыполненияДействийПоЭДО_ОбработкаОшибки(ИнформацияОбОшибке, СтандартнаяОбработка, ДополнительныеПараметры) Экспорт
	
	ОчиститьИдФайлТекущегоТитула(Истина);
	
	ПодключитьОбработчикОжидания("ОбновлениеДоступностиЭлементов", 2, Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьИдФайлТекущегоТитула(Записать = Ложь)
	
	ЭтаФорма.Доступность = Истина;
	
	ИнформацияПоПрефиксамТитула = ОбменСГИСЭПДКлиентСервер.ПрефиксТитулаПоЭлементуРегламентаЭДО(Объект.ТекущийТитул);
	
	ОбменСГИСЭПДКлиентСервер.УстановитьЗначениеРеквизитаВСтруктуреФормы(
		ЭтаФорма, 
		ИнформацияПоПрефиксамТитула.ВПрограмме + "ИдентификаторФайла", 
		Неопределено);
	
	Если Записать = Истина Тогда
		ПараметрыЗаписи = Новый Структура;
		ПараметрыЗаписи.Вставить("НеТребуетсяИдентификацияФайла");
		Записать(ПараметрыЗаписи);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОбновлениеДоступностиЭлементов()
	
	ВводимДопТитулКорректировкиЭстафета = Ложь;
	ВводимДопТитулПереадресовки = Ложь;
	ВводимТитулКорректировкиСтоимости = Ложь;
	ВводимТитулКорректировкиЭстафета = Ложь;
	ВводимТитулПереадресовки = Ложь;

	ПредыдущийТекущийТитул = Объект.ТекущийТитул;
	ОбменСГИСЭПДКлиентСервер.УстановитьДоступностьЭлементовЭТрН(ЭтаФорма);
	
	Прочитать();
	
	ЭтаФорма.Доступность = Истина;
	УстановитьТекущийШагПомощника(ПредыдущийТекущийТитул);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "ОбновитьСостояниеЭД" Тогда
		НужноОбновитьСостояниеЭД = Истина;	
	ИначеЕсли ИмяСобытия = "ОтметитьОбязательныеНеЗаполненныеЭлементыФормы" Тогда
		Если УникальныйИдентификатор <> Параметр Тогда
			Возврат;
		КонецЕсли;
		ОтметитьОбязательныеНеЗаполненныеЭлементыФормы(Параметр);
	ИначеЕсли ИмяСобытия = "ИзменитьОформлениеКнопокФормы" Тогда
		Если УникальныйИдентификатор <> Параметр.УникальныйИдентификаторОбновляемойФормы Тогда
			Возврат;
		КонецЕсли;
		ИзменитьОформлениеКнопок(Параметр);	
		Если Параметр.ИмяКнопки = "ЗаполнитьТитулГрузоотправителяВодители" Тогда
			ОтображениеОтправкиQR(Истина);	
		КонецЕсли;
	ИначеЕсли СтрНачинаетсяС(ИмяСобытия, "Запись_") И Источник <> Неопределено Тогда
		Если Источник = Объект.СсылкаТитулГрузоотправителяГрузоотправитель Тогда
			СсылкаТитулГрузоотправителяГрузоотправительПриИзменении(Элементы.СсылкаТитулГрузоотправителяГрузоотправитель);
		ИначеЕсли Источник = Объект.СсылкаТитулГрузоотправителяГрузополучатель Тогда
			СсылкаТитулГрузоотправителяГрузополучательПриИзменении(Элементы.СсылкаТитулГрузоотправителяГрузополучатель);
		ИначеЕсли Источник = Объект.СсылкаТитулГрузоотправителяПеревозчик Тогда
			СсылкаТитулГрузоотправителяПеревозчикПриИзменении(Элементы.СсылкаТитулГрузоотправителяПеревозчик);
		ИначеЕсли Источник = ХранимыеДанныеТитулГрузоотправителяТранспортноеСредство Тогда
			ХранимыеДанныеТитулГрузоотправителяТранспортноеСредствоПриИзменении(Элементы.ХранимыеДанныеТитулГрузоотправителяТранспортноеСредство);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервереБезКонтекста
Функция ИзменитьОформлениеКнопокНаСервере(Знач СтруктураСТекущимиДаннымиРеквизитов,
	ИмяКнопки = Неопределено,
	ИдентификаторСтроки = Неопределено,
	Знач СтруктураДанныхОбъекта,
	Знач СтруктураСДаннымиФормыДляОформленияКнопок)
	
	НовыйАдресВХранилище = ОбменСГИСЭПД.ЗапуститьИзменениеОформленияКнопок(СтруктураСДаннымиФормыДляОформленияКнопок,
		СтруктураСТекущимиДаннымиРеквизитов, ИмяКнопки, ИдентификаторСтроки, СтруктураДанныхОбъекта);

	Результат = ОбменСГИСЭПД.ОбработатьРезультатИзмененияОформленияКнопок(НовыйАдресВХранилище);
	
	Возврат Результат;
	
КонецФункции


&НаСервере
Функция ПолучитьПочтуВодителей(МассивВодители)
	
	Результат = Новый Массив;
	
	Если МассивВодители.Количество() = 0 Тогда
		Возврат Результат;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("МассивВодители", МассивВодители);
	Запрос.Текст = "ВЫБРАТЬ
	|	ВЫРАЗИТЬ(ХранимыеДанныеЭПДДанные.Значение КАК СТРОКА(150)) КАК Почта
	|ИЗ
	|	Справочник.ХранимыеДанныеЭПД КАК ХранимыеДанныеЭПД
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ХранимыеДанныеЭПД.Данные КАК ХранимыеДанныеЭПДДанные
	|		ПО ХранимыеДанныеЭПД.Ссылка = ХранимыеДанныеЭПДДанные.Ссылка
	|		И ХранимыеДанныеЭПДДанные.Имя = ""Почта""
	|ГДЕ
	|	ХранимыеДанныеЭПД.Ссылка В (&МассивВодители)";
	
	РезультатЗапроса = Запрос.Выполнить();
	Если РезультатЗапроса.Пустой() = Ложь Тогда
		Выборка = РезультатЗапроса.Выбрать();
		Пока Выборка.Следующий() Цикл
			Если ЗначениеЗаполнено(Выборка.Почта) Тогда
				Результат.Добавить(Выборка.Почта);
			КонецЕсли;	
		КонецЦикла;
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

&НаСервере
Процедура ИнициализироватьИсправительнуюВерсиюТитулаПриНеобходимости()
	
	ДанныеСостоянияЭДО = ОбменСГИСЭПДВызовСервера.ДанныеСостоянияЭДОДляФормыОбъектаУчета(Объект.Ссылка);
	
	ЭтоИсправление = ДанныеСостоянияЭДО.ПредставлениеСостояния = "Требуется повторная отправка"
					Или ДанныеСостоянияЭДО.ПредставлениеСостояния = "Требуется уточнение"
					Или ДанныеСостоянияЭДО.ПредставлениеСостояния = "Требуется повторная отправка";
	
	Если ЭтоИсправление = Истина Тогда
		Отбор = Новый Структура("Титул", Объект.ТекущийТитул);
		СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии, ИдентификаторФайла");
		СтрокиВерсий.Сортировать("НомерВерсии");
		
		ТекущийНомерВерсии = -1;
		ТекущаяВерсияЗафиксирована = Ложь;
		Для Каждого СтрокаВерсии Из СтрокиВерсий Цикл
			Если СтрокаВерсии.НомерВерсии > ТекущийНомерВерсии Тогда
				ТекущийНомерВерсии = СтрокаВерсии.НомерВерсии;
				ТекущаяВерсияЗафиксирована = ЗначениеЗаполнено(СтрокаВерсии.ИдентификаторФайла);	
			КонецЕсли;	
		КонецЦикла;
		
		Если ТекущаяВерсияЗафиксирована = Истина Тогда
			ИнформацияПоПрефиксамТитула = ОбменСГИСЭПДКлиентСервер.ПрефиксТитулаПоЭлементуРегламентаЭДО(Объект.ТекущийТитул);
			КонтейнерОтображаемойВерсии = ОбменСГИСЭПДКлиентСервер.КонтейнерОтображаемойВерсииРеквизита(ЭтаФорма, ИнформацияПоПрефиксамТитула.ВПрограмме);
			СтруктураВерсииТитула = КонтейнерОтображаемойВерсии.СтруктураРеквизитовЗаполнение[КонтейнерОтображаемойВерсии.ПрефиксТитула][КонтейнерОтображаемойВерсии.НомерВерсии];
			КонтейнерОтображаемойВерсии.СтруктураРеквизитовЗаполнение[КонтейнерОтображаемойВерсии.ПрефиксТитула].Добавить(СтруктураВерсииТитула);
			КонтейнерОтображаемойВерсии.НомерВерсии = КонтейнерОтображаемойВерсии.НомерВерсии + 1;
			СтруктураРеквизитов = ОбменСГИСЭПДКлиентСервер.СкопироватьВФиксированноеЗначенияРекурсивно(КонтейнерОтображаемойВерсии.СтруктураРеквизитовЗаполнение);
				
			НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, ИнформацияПоПрефиксамТитула.ВПрограмме);
			
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, ИнформацияПоПрефиксамТитула.ВПрограмме, 1);	
			
			НоваяВерсия = ВерсииТитулов.Добавить();
			НоваяВерсия.НомерВерсии = НомерВерсии + 1;
			НоваяВерсия.Титул = Объект.ТекущийТитул;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры







// Область Навигация

&НаКлиентеНаСервереБезКонтекста
Процедура ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, ТитулСтрока, Инкремент)
	
	Если Инкремент = 0 Тогда
		Возврат;
	КонецЕсли;
	
	Если ОтображаемыеВерсииТитулов = Неопределено Тогда
		ОтображаемыеВерсииТитулов = Новый Структура;
	Иначе
		ТекущееЗначениеВерсии = Неопределено;
		ОтображаемыеВерсииТитулов.Свойство(ТитулСтрока, ТекущееЗначениеВерсии);
		Если ТекущееЗначениеВерсии <> Неопределено Тогда
			ОтображаемыеВерсииТитулов.Вставить(ТитулСтрока, ТекущееЗначениеВерсии + Инкремент);
		КонецЕсли;	
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура Шаг9ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг9", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

&НаКлиенте
Процедура Шаг10ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг10", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

&НаКлиенте
Процедура Шаг12ОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылкаФорматированнойСтроки, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	ОбработатьИзменениеШага("Шаг12", НавигационнаяСсылкаФорматированнойСтроки);

КонецПроцедуры

// КонецОбласти



// Область НавигацияПоСтраницам

&НаКлиентеНаСервереБезКонтекста
Функция ВсегоШагов(Форма)
	
	ВсегоШагов = 4;
	ВсегоШагов = ВсегоШагов + ?(СтатусПереадресовки(Форма) > 0, 1, 0);
	ВсегоШагов = ВсегоШагов + ?(СтатусЗамены(Форма) > 0, 1, 0);
	ВсегоШагов = ВсегоШагов + ?(СтатусКорректировкиСтоимости(Форма) > 0, 2, 0);
	
	Возврат ВсегоШагов;
	
КонецФункции

&НаКлиентеНаСервереБезКонтекста
Функция ВсегоШаговДоп(Форма)
	
	ВсегоШагов = 3;
	ВсегоШагов = ВсегоШагов + ?(СтатусЗаменыДоп(Форма) > 0, 1, 0);
	
	Возврат ВсегоШагов;
	
КонецФункции

&НаСервере
Процедура УстановитьВидимостьСтраницы(ОтображаемаяСтраница)
	
	ОтображаемаяСтраницаЦелевая = ПодменитьСтраницуДляТестированияФормы(ОтображаемаяСтраница);

	// Чтобы не отрастали лишние скролл-бары по высоте из-за разного числа элементов
	// на разных страницах, оставляем видимость только у одной - отображаемой страницы.
	
	Для каждого СтраницаЭТрН Из Элементы.Страницы.ПодчиненныеЭлементы Цикл
		СтраницаЭТрН.Видимость = (СтраницаЭТрН = ОтображаемаяСтраницаЦелевая);
	КонецЦикла;

	Элементы.Страницы.ТекущаяСтраница  = ОтображаемаяСтраницаЦелевая;
	
	ОбменСГИСЭПД.ПодготовитьФормуДляОтметкиОбязательныхПолей(ЭтаФорма);
	
КонецПроцедуры

&НаСервере
Процедура УстановитьТекущийШагПомощника(ПредыдущийТекущийТитул = Неопределено)
	
	ТитулСтраницы = ?(ЗначениеЗаполнено(Объект.ТекущийТитул), Объект.ТекущийТитул, ПредыдущийТекущийТитул);
	
	НачатьСПервойСтраницы = ТолькоПросмотр ИЛИ НЕ ЗначениеЗаполнено(Объект.Ссылка);

	Если НачатьСПервойСтраницы Тогда
		
		УстановитьВидимостьСтраницыНачалоДоп(Ложь);
		УстановитьВидимостьСтраницыНачало();
		
	Иначе
		
		Если ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2") Тогда
			
			УстановитьВидимостьСтраницыНачалоДоп(Ложь);
			УстановитьВидимостьСтраницыТитулПеревозчика(); 
			
		ИначеЕсли ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул7") Тогда
			
			УстановитьВидимостьСтраницыНачалоДоп(Ложь);
			УстановитьВидимостьСтраницыТитулПереадресовки();
				
		ИначеЕсли ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул8") Тогда
			
			УстановитьВидимостьСтраницыНачалоДоп(Ложь);
			УстановитьВидимостьСтраницыТитулКорректировкиЭстафета();
			
		ИначеЕсли ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул3") Тогда
			
			УстановитьВидимостьСтраницыНачалоДоп(Ложь);
			УстановитьВидимостьСтраницыТитулГрузополучателя();
			
		ИначеЕсли ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул4") Тогда

			УстановитьВидимостьСтраницыНачалоДоп(Ложь);
			УстановитьВидимостьСтраницыТитулПеревозчикаПриРазгрузке();
			
		ИначеЕсли ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул5") Тогда
	
			УстановитьВидимостьСтраницыНачалоДоп(Ложь);
			УстановитьВидимостьСтраницыТитулПлатеж();
		
		ИначеЕсли ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул6") Тогда

			УстановитьВидимостьСтраницыНачалоДоп(Ложь);
			УстановитьВидимостьСтраницыТитулПлательщик();
			
		ИначеЕсли ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7") Тогда

			УстановитьВидимостьСтраницыНачало(Ложь);
			УстановитьВидимостьСтраницыНачалоДоп();
		
		ИначеЕсли ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул8") Тогда

			УстановитьВидимостьСтраницыНачало(Ложь);
			УстановитьВидимостьСтраницыТитулКорректировкиЭстафетаДоп();
			
		ИначеЕсли ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул3") Тогда

			УстановитьВидимостьСтраницыНачало(Ложь);
			УстановитьВидимостьСтраницыТитулГрузополучателяДоп();
			
		ИначеЕсли ТитулСтраницы = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул4") Тогда

			УстановитьВидимостьСтраницыНачало(Ложь);
			УстановитьВидимостьСтраницыТитулПеревозчикаПриРазгрузкеДоп();			
			
		Иначе
			
			УстановитьВидимостьСтраницыНачалоДоп(Ложь);
			УстановитьВидимостьСтраницыНачало();
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры


&НаСервере
Процедура УстановитьВидимостьСтраницыТитулПереадресовки()
	
	ВводимДопТитулКорректировкиЭстафета = Ложь;
	ВводимДопТитулПереадресовки = Ложь;
	ВводимТитулКорректировкиСтоимости = Ложь;
	ВводимТитулКорректировкиЭстафета = Ложь;
	ВводимТитулПереадресовки = Объект.ТекущийТитул = Перечисления.ТипыЭлементовВерсииЭД.ЭТрН_Титул7;

	УстановитьВидимостьСтраницы(Элементы.СтраницаСодИнфПА);
	
	РазместитьНавигацию("ТитулПереадресовка");
	
	СохранитьТекущийШагПомощника();
		
КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьСтраницыНачалоДоп(ОтмечатьТекущий = Истина)
	
	Если ОтмечатьТекущий = Истина Тогда
		ВводимДопТитулКорректировкиЭстафета = Ложь;
		ВводимДопТитулПереадресовки = Объект.ТекущийТитул = Перечисления.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7;
		ВводимТитулКорректировкиСтоимости = Ложь;
		ВводимТитулКорректировкиЭстафета = Ложь;
		ВводимТитулПереадресовки = Ложь;
		УстановитьВидимостьСтраницы(Элементы.СтраницаДопСодИнфПА);
	КонецЕсли;
	
	НавигацияПомощникаДоп = НавигацияПомощникаДоп();
	ЕстьДопТитулы = Ложь;
	Для Каждого СтруктруаШага Из НавигацияПомощникаДоп Цикл
		Если СтруктруаШага.Значение.Выполнен Или СтруктруаШага.Значение.Доступен Тогда
			ЕстьДопТитулы = Истина;
			Прервать;
		КонецЕсли;	
	КонецЦикла;
	
	РазместитьНавигациюДоп(?(ЕстьДопТитулы, "ДопТитулПереадресовка", ""), ОтмечатьТекущий);
	
	СохранитьТекущийШагПомощника();
		
КонецПроцедуры


&НаСервере
Процедура УстановитьВидимостьСтраницыТитулКорректировкиЭстафета()
	
	ВводимДопТитулКорректировкиЭстафета = Ложь;
	ВводимДопТитулПереадресовки = Ложь;
	ВводимТитулКорректировкиСтоимости = Ложь;
	ВводимТитулКорректировкиЭстафета = Объект.ТекущийТитул = Перечисления.ТипыЭлементовВерсииЭД.ЭТрН_Титул8;
	ВводимТитулПереадресовки = Ложь;
	
	УстановитьВидимостьСтраницы(Элементы.СтраницаСодИнфЗамен);
	
	РазместитьНавигацию("ТитулПеревозчикаЗамены");
	
	СохранитьТекущийШагПомощника();
	
КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьСтраницыТитулКорректировкиЭстафетаДоп()
	
	ВводимДопТитулКорректировкиЭстафета = Объект.ТекущийТитул = Перечисления.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул8;
	ВводимДопТитулПереадресовки = Ложь;
	ВводимТитулКорректировкиСтоимости = Ложь;
	ВводимТитулКорректировкиЭстафета = Ложь;
	ВводимТитулПереадресовки = Ложь;
	
	УстановитьВидимостьСтраницы(Элементы.СтраницаДопСодИнфЗамен);
	
	РазместитьНавигациюДоп("ДопТитулПеревозчикаЗамены");
	
	СохранитьТекущийШагПомощника();
	
КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьСтраницыТитулПлатеж()
	
	ВводимДопТитулКорректировкиЭстафета = Ложь;
	ВводимДопТитулПереадресовки = Ложь;
	ВводимТитулКорректировкиСтоимости = Объект.ТекущийТитул = Перечисления.ТипыЭлементовВерсииЭД.ЭТрН_Титул5;
	ВводимТитулКорректировкиЭстафета = Ложь;
	ВводимТитулПереадресовки = Ложь;

	УстановитьВидимостьСтраницы(Элементы.СтраницаСодФХЖ1);
	
	РазместитьНавигацию("ТитулПеревозчикаФХЖ");
	
	СохранитьТекущийШагПомощника();

КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Функция СтатусПереадресовки(Форма)
	
	Если ЗначениеЗаполнено(Форма.Объект.ТитулПереадресовкаИдентификаторФайла) Тогда
		Возврат 2;
	ИначеЕсли Форма.ВводимТитулПереадресовки Тогда
		Возврат 1;
	КонецЕсли;
	
	Возврат 0; 
	
КонецФункции

&НаСервере
Функция НавигацияПомощника()
	
	ВсегоШагов = ВсегоШагов(ЭтаФорма);
	
	СтруктураНавигации = Новый Структура;
	СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(1), СтруктураШагаНачало(1));
	СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(2), СтруктураШагаПогрузка(2));
	
	СдвигШаговСКонца = 0;
	Если СтатусКорректировкиСтоимости(ЭтаФорма) > 0 Тогда
		СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(ВсегоШагов - 1), СтруктураШагаПлатеж(ВсегоШагов - 1));
		СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(ВсегоШагов), СтруктураШагаПлательщик(ВсегоШагов));
		СдвигШаговСКонца = 2;	
	КонецЕсли;
	
	Если СтатусПереадресовки(ЭтаФорма) > 0 Тогда
		НомерШага = ?(ПереадресовкаДоЗамены(ЭтаФорма), 3, 4);
		СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(НомерШага), СтруктураШагаПереадресовки(НомерШага));	
	КонецЕсли;
	
	Если СтатусЗамены(ЭтаФорма) > 0 Тогда
		НомерШага = ?(ПереадресовкаДоЗамены(ЭтаФорма), 4, 3);
		СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(НомерШага), СтруктураШагаКорректировкаЭстафета(НомерШага));	
	КонецЕсли;	
	
	НомерШага = ВсегоШагов - СдвигШаговСКонца - 1;
	СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(НомерШага), СтруктураШагаПриемка(НомерШага));
	
	НомерШага = ВсегоШагов - СдвигШаговСКонца;
	СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(НомерШага), СтруктураШагаРазгрузка(НомерШага));
	
	Для Каждого КиЗ Из СтруктураНавигации Цикл
		Титул = ОбменСГИСЭПДКлиентСервер.ТитулПоПрефиксу("Документ.ЭлектроннаяТранспортнаяНакладная", КиЗ.Значение.СтруктураПараметровФормы.НавигацияПараметрФормы);
		ШагВыполнен = Ложь;
		Для Каждого СтрВерсия Из ВерсииТитулов Цикл
			Если СтрВерсия.Титул = Титул И СтрВерсия.ИдентификаторФайла <> "" Тогда
				ШагВыполнен = Истина;
				Прервать;
			КонецЕсли;
		КонецЦикла;
		
		КиЗ.Значение.Выполнен = ШагВыполнен; 	
		КиЗ.Значение.Доступен = КиЗ.Значение.Доступен Или КиЗ.Значение.Выполнен;
	КонецЦикла;
	
	Возврат СтруктураНавигации;
	
КонецФункции

&НаСервере
Функция НавигацияПомощникаДоп()
	
	ВсегоШагов = ВсегоШаговДоп(ЭтаФорма);
	
	СдвигШагов = 8;
	
	СтруктураНавигации = Новый Структура;
	СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(СдвигШагов + 1), СтруктураШагаПереадресовкиДоп(СдвигШагов + 1));
	
	Если СтатусЗаменыДоп(ЭтаФорма) > 0 Тогда
		НомерШага = СдвигШагов + ВсегоШагов - 2;
		СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(НомерШага), СтруктураШагаКорректировкаЭстафетаДоп(НомерШага));	
	КонецЕсли;	
	
	НомерШага = СдвигШагов + ВсегоШагов - 1;
	СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(НомерШага), СтруктураШагаПриемкаДоп(НомерШага));
	
	НомерШага = СдвигШагов + ВсегоШагов;
	СтруктураНавигации.Вставить(НавигацияПомощниковСВозвратомЭПД.ИмяШага(НомерШага), СтруктураШагаРазгрузкаДоп(НомерШага));
	
	Для Каждого КиЗ Из СтруктураНавигации Цикл
		Титул = ОбменСГИСЭПДКлиентСервер.ТитулПоПрефиксу("Документ.ЭлектроннаяТранспортнаяНакладная", КиЗ.Значение.СтруктураПараметровФормы.НавигацияПараметрФормы);
		ШагВыполнен = Ложь;
		Для Каждого СтрВерсия Из ВерсииТитулов Цикл
			Если СтрВерсия.Титул = Титул И СтрВерсия.ИдентификаторФайла <> "" Тогда
				ШагВыполнен = Истина;
				Прервать;
			КонецЕсли;
		КонецЦикла;
		
		КиЗ.Значение.Выполнен = ШагВыполнен;	
	КонецЦикла;
	
	Возврат СтруктураНавигации;
	
КонецФункции

&НаСервере
Функция СтруктураШагаНачало(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул1"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощника();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Оформление'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ТитулГрузоотправителя";
	СтруктураШага.Выполнен = ЗначениеЗаполнено(Объект.ТитулГрузоотправителяИдентификаторФайла); 
	СтруктураШага.Доступен = Истина;
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ТитулГрузоотправителя");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Функция СтруктураШагаПогрузка(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощника();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Погрузка'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ТитулПеревозчикаПриемка";
	СтруктураШага.Выполнен = ЗначениеЗаполнено(Объект.ТитулПеревозчикаПриемкаИдентификаторФайла);
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул2");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ТитулПеревозчикаПриемка");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Функция СтруктураШагаПереадресовки(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул7"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощника();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Переадресовка'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ТитулПереадресовка";
	СтруктураШага.Выполнен = СтатусПереадресовки(ЭтаФорма) = 2;
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул7");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ТитулПереадресовка");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Функция СтруктураШагаПереадресовкиДоп(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощникаДоп();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Переадресовка
											|(возврат)'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ДопТитулПереадресовка";
	СтруктураШага.Выполнен = СтатусПереадресовкиДоп(ЭтаФорма) = 2;
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул7");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ДопТитулПереадресовка");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Функция СтруктураШагаКорректировкаЭстафета(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул8"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощника();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Замена'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ТитулПеревозчикаЗамены";
	СтруктураШага.Выполнен = СтатусЗамены(ЭтаФорма) = 2;
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул8");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ТитулПеревозчикаЗамены");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Функция СтруктураШагаКорректировкаЭстафетаДоп(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул8"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощникаДоп();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Замена
											|(возврат)'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ДопТитулПеревозчикаЗамены";
	СтруктураШага.Выполнен = СтатусЗаменыДоп(ЭтаФорма) = 2;
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул8");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ДопТитулПеревозчикаЗамены");
	Возврат СтруктураШага;
	
КонецФункции


&НаСервере
Функция СтруктураШагаПриемка(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул3"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощника();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Приемка'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ТитулГрузополучателя";
	СтруктураШага.Выполнен = ЗначениеЗаполнено(Объект.ТитулГрузополучателяИдентификаторФайла); 
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул3");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ТитулГрузополучателя");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Функция СтруктураШагаПриемкаДоп(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул3"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощникаДоп();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Приемка
											|(возврат)'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ДопТитулГрузополучателя";
	СтруктураШага.Выполнен = ЗначениеЗаполнено(Объект.ДопТитулГрузополучателяИдентификаторФайла); 
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул3");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ДопТитулГрузополучателя");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Функция СтруктураШагаРазгрузка(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул4"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощника();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Разгрузка'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ТитулПеревозчикаВыдача";
	СтруктураШага.Выполнен = ЗначениеЗаполнено(Объект.ТитулПеревозчикаВыдачаИдентификаторФайла);
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул4");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ТитулПеревозчикаВыдача");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Функция СтруктураШагаРазгрузкаДоп(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул4"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощникаДоп();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Разгрузка
											|(возврат)'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ДопТитулПеревозчикаВыдача";
	СтруктураШага.Выполнен = ЗначениеЗаполнено(Объект.ДопТитулПеревозчикаВыдачаИдентификаторФайла);
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_ДопТитул4");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ДопТитулПеревозчикаВыдача");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Функция СтруктураШагаПлатеж(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул5"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощника();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Согласование
											|оплаты'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ТитулПеревозчикаФХЖ";
	СтруктураШага.Выполнен = ЗначениеЗаполнено(Объект.ТитулПеревозчикаФХЖИдентификаторФайла);
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул5");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ТитулПеревозчикаФХЖ");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Функция СтруктураШагаПлательщик(НомерШага)
	
	Отбор = Новый Структура("Титул", ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул6"));
	СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
	
	СтруктураШага                = НавигацияПомощниковСВозвратомЭПД.НовыйСтруктураШага();
	СтруктураШага.ИмяПомощника   = ИмяПомощника();
	СтруктураШага.НомерШага      = НомерШага;
	СтруктураШага.ТекстНавигации = НСтр("ru='Подтверждение оплаты'");
	СтруктураШага.СтруктураПараметровФормы.НавигацияПараметрФормы = "ТитулГрузоотправителяФХЖ";
	СтруктураШага.Выполнен = ЗначениеЗаполнено(Объект.ТитулГрузоотправителяФХЖИдентификаторФайла); 
	СтруктураШага.Доступен = СтруктураШага.Выполнен Или Объект.ТекущийТитул = ПредопределенноеЗначение("Перечисление.ТипыЭлементовВерсииЭД.ЭТрН_Титул6");
	СтруктураШага.КоличествоВерсий = Макс(СтрокиВерсий.Количество(), 1);
	СтруктураШага.НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, "ТитулГрузоотправителяФХЖ");
	Возврат СтруктураШага;
	
КонецФункции

&НаСервере
Процедура ЗаполнитьРеквизитыПоследнейВерсии(Титул = Неопределено)
	
	СтрокиВерсий = ВерсииТитулов.Выгрузить();
	СтрокиВерсий.Сортировать("Титул, НомерВерсии Убыв");
	
	ОбработанныеТитулы = Новый Массив;
	Для Каждого СтрокаВерсии Из СтрокиВерсий Цикл
		Если Титул <> Неопределено И СтрокаВерсии.Титул <> Титул Тогда
			Продолжить;
		КонецЕсли;
		Если ОбработанныеТитулы.Найти(СтрокаВерсии.Титул) <> Неопределено Тогда
			Если Титул = Неопределено Тогда
				Продолжить;
			Иначе
				Прервать;
			КонецЕсли;
		КонецЕсли;
		СтрокиВерсий.Сортировать("НомерВерсии Убыв");
		НомерВерсии = СтрокиВерсий[0].НомерВерсии;
		
		РеквизитыТекущейВерсииТитула = ОбменСГИСЭПД.ПолучитьВерсиюТитулаДокумента(СтруктураРеквизитов, СтрокаВерсии.Титул, НомерВерсии);
		ОбменСГИСЭПД.ЗаполнитьРеквизитыПоВерсии(ЭтаФорма, СтрокаВерсии.Титул, НомерВерсии, РеквизитыТекущейВерсииТитула);

		ОбработанныеТитулы.Добавить(СтрокаВерсии.Титул);
	КонецЦикла;  
	
	Если Титул <> Неопределено И ОбработанныеТитулы.Количество() = 0 Тогда
		ОбменСГИСЭПД.ЗаполнитьРеквизитыПоВерсии(ЭтаФорма, Титул, 0, Новый Структура);	
	КонецЕсли;
	
	ЗаполнитьПредставленияАдресов(Титул);
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьРеквизитыОтображаемойВерсии(ВыбранныйТитулСтрока, ОтмечатьТекущий)
	
	ВыбранныйТитул = ОбменСГИСЭПДКлиентСервер.ТитулПоПрефиксу("Документ.ЭлектроннаяТранспортнаяНакладная", ВыбранныйТитулСтрока); 
	
	Если ЗначениеЗаполнено(ВыбранныйТитул) Тогда
		Отбор = Новый Структура("Титул", ВыбранныйТитул);
		СтрокиВерсий = ВерсииТитулов.Выгрузить(Отбор, "НомерВерсии");
		СтрокиВерсий.Сортировать("НомерВерсии");	
		НомерВерсии = ОтображаемаяВерсияТитула(СтрокиВерсий, ВыбранныйТитулСтрока);
		
		РеквизитыТекущейВерсииТитула = ОбменСГИСЭПД.ПолучитьВерсиюТитулаДокумента(СтруктураРеквизитов, ВыбранныйТитул, НомерВерсии);
		ОбменСГИСЭПД.ЗаполнитьРеквизитыПоВерсии(ЭтаФорма, ВыбранныйТитул, НомерВерсии, РеквизитыТекущейВерсииТитула);
		ЗаполнитьПредставленияАдресов(ВыбранныйТитул);
		Если ОтмечатьТекущий = Истина Тогда
			СтруктураСТекущимиДанными = ОбменСГИСЭПДКлиентСервер.ПолучитьСтруктуруПоТитулуИВерсии(ЭтаФорма);
			СтруктураДанныхОбъекта = Неопределено;
			СтруктураСДаннымиФормыДляОформленияКнопок = ОбменСГИСЭПДКлиентСервер.СтруктураСДаннымиФормыДляОформленияКнопок(ЭтаФорма);
			
			Результат = ИзменитьОформлениеКнопокНаСервере(СтруктураСТекущимиДанными,
				Неопределено,
				Неопределено,
				СтруктураДанныхОбъекта,
				СтруктураСДаннымиФормыДляОформленияКнопок);
				
			Если Результат.Успешно Тогда
				ЭтаФорма.АдресДереваСоответствийИтаблицыКнопок = Результат.НовыйАдресВХранилище;	
				МассивОформления = Результат.МассивОформления;
				ОбменСГИСЭПДКлиентСервер.ОформлениеКнопокНаФорме(ЭтаФорма, СтруктураСТекущимиДанными, МассивОформления);	
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура РазместитьНавигацию(ВыбранныйТитулСтрока, ОтмечатьТекущий = Истина)

	НавигацияПараметрФормы = ВыбранныйТитулСтрока;
	
	ЗаполнитьРеквизитыОтображаемойВерсии(ВыбранныйТитулСтрока, ОтмечатьТекущий);

	СтруктураНавигацииПомощника = НавигацияПомощника();
	НавигацияПомощниковСВозвратомЭПД.РазместитьНавигацию(ЭтаФорма, СтруктураНавигацииПомощника, Параметры, , , ОтмечатьТекущий);

КонецПроцедуры

&НаСервере
Процедура РазместитьНавигациюДоп(ВыбранныйТитулСтрока, ОтмечатьТекущий = Истина)

	НавигацияПараметрФормы = ВыбранныйТитулСтрока;
	
	ЗаполнитьРеквизитыОтображаемойВерсии(ВыбранныйТитулСтрока, ОтмечатьТекущий);

	СтруктураНавигацииПомощника = НавигацияПомощникаДоп();
	СдвигДопНавигации = 3;
	СдвигДопНавигации = СдвигДопНавигации + ?(СтатусПереадресовки(ЭтаФорма) > 0, 1, 0) + ?(СтатусЗамены(ЭтаФорма) > 0, 1, 0);
	НавигацияПомощниковСВозвратомЭПД.РазместитьНавигацию(ЭтаФорма, СтруктураНавигацииПомощника, Параметры, СдвигДопНавигации, "Доп", ОтмечатьТекущий);

КонецПроцедуры

&НаКлиенте
Процедура ОбработатьИзменениеШага(ИмяШага, НавигационнаяСсылка)
	
	ИнкриментВерсии = 0;
	Если НавигационнаяСсылка = "Влево" Тогда
		ИнкриментВерсии = -1;
	ИначеЕсли НавигационнаяСсылка = "Вправо" Тогда
		ИнкриментВерсии = 1;
	КонецЕсли;
	
	Если ИмяШага = "Шаг9" Или ИмяШага = "Шаг10" Или ИмяШага = "Шаг11" Или ИмяШага = "Шаг12" Тогда
		ВсегоШагов = ВсегоШаговДоп(ЭтаФорма);	
		Если ИмяШага = "Шаг9" Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ДопТитулПереадресовка", ИнкриментВерсии);
			УстановитьВидимостьСтраницыНачалоДоп();
		ИначеЕсли ИмяШага = "Шаг10" И СтатусЗаменыДоп(ЭтаФорма) > 0 Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ДопТитулПеревозчикаЗамены", ИнкриментВерсии);
			УстановитьВидимостьСтраницыТитулКорректировкиЭстафетаДоп();
		ИначеЕсли ИмяШага = "Шаг" + Строка(8 + ВсегоШагов - 1) Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ДопТитулГрузополучателя", ИнкриментВерсии);
			УстановитьВидимостьСтраницыТитулГрузополучателяДоп();
		ИначеЕсли ИмяШага = "Шаг" + Строка(8 + ВсегоШагов) Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ДопТитулПеревозчикаВыдача", ИнкриментВерсии);
			УстановитьВидимостьСтраницыТитулПеревозчикаПриРазгрузкеДоп();
		КонецЕсли;
		УстановитьВидимостьСтраницыНачало(Ложь);
	Иначе 
		ВсегоШагов = ВсегоШагов(ЭтаФорма);
		
		Если ИмяШага = "Шаг1" Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ТитулГрузоотправителя", ИнкриментВерсии);
			УстановитьВидимостьСтраницыНачало();
		ИначеЕсли ИмяШага = "Шаг2" Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ТитулПеревозчикаПриемка", ИнкриментВерсии);
			УстановитьВидимостьСтраницыТитулПеревозчика();
		ИначеЕсли ИмяШага = "Шаг" + Строка(?(ПереадресовкаДоЗамены(ЭтаФорма), 3, 4)) И СтатусПереадресовки(ЭтаФорма) > 0 Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ТитулПереадресовка", ИнкриментВерсии);
			УстановитьВидимостьСтраницыТитулПереадресовки();
		ИначеЕсли ИмяШага = "Шаг" + Строка(?(ПереадресовкаДоЗамены(ЭтаФорма), 4, 3)) И СтатусЗамены(ЭтаФорма) > 0 Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ТитулПеревозчикаЗамены", ИнкриментВерсии);
			УстановитьВидимостьСтраницыТитулКорректировкиЭстафета();	
		ИначеЕсли ИмяШага = "Шаг" + Строка(ВсегоШагов - 1 - ?(СтатусКорректировкиСтоимости(ЭтаФорма) > 0, 2, 0)) Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ТитулГрузополучателя", ИнкриментВерсии);
			УстановитьВидимостьСтраницыТитулГрузополучателя();
		ИначеЕсли ИмяШага = "Шаг" + Строка(ВсегоШагов - ?(СтатусКорректировкиСтоимости(ЭтаФорма) > 0, 2, 0)) Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ТитулПеревозчикаВыдача", ИнкриментВерсии);
			УстановитьВидимостьСтраницыТитулПеревозчикаПриРазгрузке();
		ИначеЕсли ИмяШага = "Шаг" + Строка(ВсегоШагов - 1) И СтатусКорректировкиСтоимости(ЭтаФорма) > 0 Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ТитулПеревозчикаФХЖ", ИнкриментВерсии);
			УстановитьВидимостьСтраницыТитулПлатеж();
		ИначеЕсли ИмяШага = "Шаг" + Строка(ВсегоШагов) И СтатусКорректировкиСтоимости(ЭтаФорма) = 2 Тогда
			ИнкрементироватьОтображаемуюВерсиюТитула(ОтображаемыеВерсииТитулов, "ТитулГрузоотправителяФХЖ", ИнкриментВерсии);
			УстановитьВидимостьСтраницыТитулПлательщик();
		КонецЕсли;
		УстановитьВидимостьСтраницыНачалоДоп(Ложь);
	КонецЕсли;
	
	Если ИнкриментВерсии <> 0 Тогда
		ОбменСГИСЭПДКлиентСервер.ИзменитьОформлениеФормы(ЭтаФорма);
	КонецЕсли;
	
	Элементы.ФормаИныеПолучатели.Видимость = Истина;
	Если Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаСодФХЖ1
		Или Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаСодФХЖ2
		Или Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаСодИнфПА
		Или Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаДопСодИнфПА Тогда
			Элементы.ФормаИныеПолучатели.Видимость = Ложь;
	КонецЕсли;
	
КонецПроцедуры

// Область ОбъектыОбязательныеДляЗаполнения

&НаКлиенте
Процедура ИзменитьОформлениеКнопок(Параметр) Экспорт

	Если Не ЭтаФорма.НачальноеОформлениеВыполнено Тогда
		ЭтаФорма.ТребуетсяДополнительноеОформлениеКнопок = Истина;
		Если ЭтаФорма.СтруктураДополнительногоОформленияКнопок <> Неопределено Тогда
			ЭтаФорма.СтруктураДополнительногоОформленияКнопок = 
				Новый ФиксированнаяСтруктура("ИмяКнопки, ИдентификаторСтроки");
		Иначе
			ЭтаФорма.СтруктураДополнительногоОформленияКнопок = Параметр;
		КонецЕсли;
		Возврат;
	КонецЕсли;
	
	СтруктураСТекущимиДаннымиРеквизитов = ОбменСГИСЭПДКлиентСервер.ПолучитьСтруктуруПоТитулуИВерсии(ЭтаФорма);
	СтруктураДанныхОбъекта = Неопределено;
	СтруктураСДаннымиФормыДляОформленияКнопок = 
		ОбменСГИСЭПДКлиентСервер.СтруктураСДаннымиФормыДляОформленияКнопок(ЭтаФорма);
	
	Результат = ИзменитьОформлениеКнопокНаСервере(СтруктураСТекущимиДаннымиРеквизитов,
		Параметр.ИмяКнопки,
		Параметр.ИдентификаторСтроки,
		СтруктураДанныхОбъекта,
		СтруктураСДаннымиФормыДляОформленияКнопок);
		
	Если Результат.Успешно Тогда
		ЭтаФорма.АдресДереваСоответствийИтаблицыКнопок = Результат.НовыйАдресВХранилище;	
		МассивОформления = Результат.МассивОформления;
		ОбменСГИСЭПДКлиентСервер.ОформлениеКнопокНаФорме(ЭтаФорма,
			СтруктураСТекущимиДаннымиРеквизитов, МассивОформления);	
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОтметитьОбязательныеНеЗаполненныеЭлементыФормы(Параметр)
	
	СтруктураСТекущимиДаннымиРеквизитов = ОбменСГИСЭПДКлиентСервер.ПолучитьСтруктуруПоТитулуИВерсии(ЭтаФорма);
	ОтметитьОбязательныеНеЗаполненныеЭлементыФормыНаСервере(СтруктураСТекущимиДаннымиРеквизитов);
	
КонецПроцедуры

&НаСервере
Процедура ОтметитьОбязательныеНеЗаполненныеЭлементыФормыНаСервере(Знач СтруктураСТекущимиДанными)
	
	ОбменСГИСЭПД.ОтметитьОбязательныеНеЗаполненныеЭлементыФормы(ЭтаФорма, СтруктураСТекущимиДанными);
	
КонецПроцедуры

// КонецОбласти
